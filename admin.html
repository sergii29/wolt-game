<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>–ê–¥–º–∏–Ω–∫–∞ ‚Äî –†–µ–∂–∏–º –ë–æ–≥–∞</title>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<!-- –¢–≤–æ—è –±–∞–∑–∞ -->
<script src="database.js"></script>

<style>
body {
  background:#0e0e0e;
  color:#fff;
  font-family:Arial, sans-serif;
  padding:10px;
}
.card {
  border:1px solid #333;
  border-radius:8px;
  padding:12px;
  margin-bottom:14px;
}
h2 {
  margin:0 0 10px;
  font-size:18px;
}
input, select, button {
  width:100%;
  padding:8px;
  margin:4px 0;
  background:#1c1c1c;
  color:#fff;
  border:1px solid #444;
  border-radius:4px;
}
button {
  background:#2b2b2b;
  font-weight:bold;
}
.status-online { color:#4caf50; }
.status-offline { color:#f44336; }
pre {
  background:#000;
  padding:6px;
  max-height:200px;
  overflow:auto;
}
</style>
</head>

<body>

<!-- –ò–ì–†–û–ö–ò -->
<div class="card">
  <h2>üë§ –ò–≥—Ä–æ–∫–∏ (–±–∞–ª–∞–Ω—Å, —ç–Ω–µ—Ä–≥–∏—è, –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ)</h2>

  <select id="playerSelect"></select>
  <div id="playerStatus"></div>

  <input id="pBalance" type="number" placeholder="–ë–∞–ª–∞–Ω—Å (PLN)">
  <input id="pEnergy" type="number" placeholder="–≠–Ω–µ—Ä–≥–∏—è">
  <input id="pMood" type="number" placeholder="–ù–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ">

  <button onclick="savePlayer()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–≥—Ä–æ–∫–∞</button>
</div>

<!-- –≠–ö–û–ù–û–ú–ò–ö–ê -->
<div class="card">
  <h2>üåç –≠–∫–æ–Ω–æ–º–∏–∫–∞ (—Ä–µ–∂–∏–º –±–æ–≥–∞)</h2>

  <input id="inflation" type="number" placeholder="–ò–Ω—Ñ–ª—è—Ü–∏—è (%)" value="5">
  <input id="bankTrust" type="number" placeholder="–î–æ–≤–µ—Ä–∏–µ –±–∞–Ω–∫–∞" value="100">

  <button onclick="saveEconomy()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —ç–∫–æ–Ω–æ–º–∏–∫—É</button>
</div>

<!-- –î–û–°–¢–ê–í–ö–ê -->
<div class="card">
  <h2>üö¥ –¢–∞—Ä–∏—Ñ—ã –¥–æ—Å—Ç–∞–≤–∫–∏</h2>

  <input id="delBase" type="number" placeholder="–ë–∞–∑–æ–≤–∞—è —Ü–µ–Ω–∞ –¥–æ—Å—Ç–∞–≤–∫–∏" value="6">
  <input id="delKm" type="number" placeholder="–¶–µ–Ω–∞ –∑–∞ –∫–º" value="2">

  <button onclick="saveDelivery()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ç–∞—Ä–∏—Ñ—ã</button>
</div>

<!-- –¶–ï–õ–ò -->
<div class="card">
  <h2>üéØ –ó–∞—Ä–∞–±–∞—Ç—ã–≤–∞–π –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ (—Ü–µ–ª–∏)</h2>

  <input id="goalTime" type="number" placeholder="–í—Ä–µ–º—è (–º–∏–Ω—É—Ç—ã)" value="35">
  <input id="goalCount" type="number" placeholder="–ö–æ–ª-–≤–æ –¥–æ—Å—Ç–∞–≤–æ–∫" value="12">
  <input id="goalBonus" type="number" placeholder="–ë–æ–Ω—É—Å (PLN)" value="50">

  <button onclick="saveGoal()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ü–µ–ª—å</button>
</div>

<!-- –ú–ê–ì–ê–ó–ò–ù -->
<div class="card">
  <h2>üõí –ú–∞–≥–∞–∑–∏–Ω</h2>

  <select id="shopItem"></select>
  <input id="shopPrice" type="number" placeholder="–¶–µ–Ω–∞ —Ç–æ–≤–∞—Ä–∞">
  <input id="shopEnergy" type="number" placeholder="–≠–Ω–µ—Ä–≥–∏—è –æ—Ç —Ç–æ–≤–∞—Ä–∞">

  <button onclick="saveShop()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ç–æ–≤–∞—Ä</button>
</div>

<!-- –õ–û–ì–ò -->
<div class="card">
  <h2>üìú –õ–æ–≥–∏ (–∫—Ç–æ —á—Ç–æ –º–µ–Ω—è–ª)</h2>
  <button onclick="loadLogs()">üîÑ –û–±–Ω–æ–≤–∏—Ç—å</button>
  <pre id="logBox"></pre>
</div>

<script>
let currentPlayer = null;
let currentItem = null;

/* –ò–ì–†–û–ö–ò */
db.ref("players").on("value", snap => {
  playerSelect.innerHTML = "";
  snap.forEach(p => {
    const o = document.createElement("option");
    o.value = p.key;
    o.textContent = p.key;
    playerSelect.appendChild(o);
  });
  if (playerSelect.value) loadPlayer();
});

playerSelect.onchange = loadPlayer;

function loadPlayer(){
  currentPlayer = playerSelect.value;
  db.ref("players/"+currentPlayer).once("value").then(s=>{
    const d = s.val() || {};
    pBalance.value = d.balance ?? 0;
    pEnergy.value = d.energy ?? 0;
    pMood.value = d.mood ?? 0;

    if (d.online) {
      playerStatus.innerHTML = "–°—Ç–∞—Ç—É—Å: <span class='status-online'>–æ–Ω–ª–∞–π–Ω</span>";
    } else {
      playerStatus.innerHTML = "–°—Ç–∞—Ç—É—Å: <span class='status-offline'>–æ—Ñ—Ñ–ª–∞–π–Ω</span>";
    }
  });
}

function savePlayer(){
  if (!currentPlayer) return;
  const after = {
    balance:+pBalance.value,
    energy:+pEnergy.value,
    mood:+pMood.value
  };
  db.ref("players/"+currentPlayer).update(after);
  addLog("–ò–∑–º–µ–Ω—ë–Ω –∏–≥—Ä–æ–∫ "+currentPlayer, after);
}

/* –≠–ö–û–ù–û–ú–ò–ö–ê */
db.ref("economy").once("value").then(s=>{
  const d = s.val() || {};
  inflation.value = d.inflation ?? 5;
  bankTrust.value = d.bankTrust ?? 100;
});

function saveEconomy(){
  const data = {
    inflation:+inflation.value,
    bankTrust:+bankTrust.value
  };
  db.ref("economy").update(data);
  addLog("–≠–∫–æ–Ω–æ–º–∏–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∞", data);
}

/* –î–û–°–¢–ê–í–ö–ê */
db.ref("delivery").once("value").then(s=>{
  const d = s.val() || {};
  delBase.value = d.basePrice ?? 6;
  delKm.value = d.pricePerKm ?? 2;
});

function saveDelivery(){
  const data = {
    basePrice:+delBase.value,
    pricePerKm:+delKm.value
  };
  db.ref("delivery").update(data);
  addLog("–¢–∞—Ä–∏—Ñ—ã –¥–æ—Å—Ç–∞–≤–∫–∏ –∏–∑–º–µ–Ω–µ–Ω—ã", data);
}

/* –¶–ï–õ–ò */
function saveGoal(){
  const data = {
    time:+goalTime.value,
    deliveries:+goalCount.value,
    bonus:+goalBonus.value
  };
  db.ref("goals/daily").set(data);
  addLog("–¶–µ–ª—å –∏–∑–º–µ–Ω–µ–Ω–∞", data);
}

/* –ú–ê–ì–ê–ó–ò–ù */
db.ref("shop/products").on("value", snap=>{
  shopItem.innerHTML="";
  snap.forEach(p=>{
    const o=document.createElement("option");
    o.value=p.key;
    o.textContent=p.key;
    shopItem.appendChild(o);
  });
});

shopItem.onchange=()=>{
  currentItem=shopItem.value;
  db.ref("shop/products/"+currentItem).once("value").then(s=>{
    const d=s.val()||{};
    shopPrice.value=d.price??0;
    shopEnergy.value=d.energy??0;
  });
};

function saveShop(){
  const data = {
    price:+shopPrice.value,
    energy:+shopEnergy.value
  };
  db.ref("shop/products/"+currentItem).update(data);
  addLog("–¢–æ–≤–∞—Ä –∏–∑–º–µ–Ω—ë–Ω "+currentItem, data);
}

/* –õ–û–ì–ò */
function addLog(action, data){
  db.ref("adminLogs").push({
    time:new Date().toLocaleString(),
    action,
    data
  });
}

function loadLogs(){
  db.ref("adminLogs").limitToLast(30).once("value").then(s=>{
    logBox.textContent="";
    s.forEach(l=>{
      logBox.textContent +=
        l.val().time+" ‚Äî "+l.val().action+"\n";
    });
  });
}
</script>

</body>
</html>
