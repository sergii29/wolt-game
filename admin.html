<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>WOLT :: GOD CONTROL PANEL</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

    <style>
        /* –°–¢–ò–õ–ò: –¢–ï–ú–ù–´–ô –ö–ò–ë–ï–†–ü–ê–ù–ö */
        body { background: #0f0f0f; color: #e0e0e0; font-family: 'Segoe UI', monospace; margin: 0; display: flex; height: 100vh; overflow: hidden; }
        
        /* –õ–ï–í–û–ï –ú–ï–ù–Æ (–°–ü–ò–°–û–ö) */
        .sidebar { width: 320px; background: #050505; border-right: 1px solid #333; display: flex; flex-direction: column; }
        .sidebar-head { padding: 20px; background: #111; border-bottom: 2px solid #00e676; font-size: 18px; font-weight: bold; color: #00e676; letter-spacing: 1px; }
        .user-list { flex: 1; overflow-y: auto; }
        
        .user-row { padding: 15px; border-bottom: 1px solid #222; cursor: pointer; display: flex; justify-content: space-between; align-items: center; transition: 0.2s; }
        .user-row:hover { background: #1a1a1a; }
        .user-row.active { background: #002200; border-left: 4px solid #00e676; }
        
        .u-info { font-size: 12px; color: #888; margin-top: 4px; }
        .status-dot { width: 10px; height: 10px; border-radius: 50%; background: #444; }
        .status-dot.on { background: #00e676; box-shadow: 0 0 8px #00e676; }

        /* –ü–†–ê–í–ê–Ø –ß–ê–°–¢–¨ (–†–ï–î–ê–ö–¢–û–†) */
        .main { flex: 1; display: flex; flex-direction: column; background: #141414; }
        .toolbar { padding: 15px 30px; background: #111; border-bottom: 1px solid #333; display: flex; justify-content: space-between; align-items: center; }
        .content { flex: 1; overflow-y: auto; padding: 30px; display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; align-content: start; }

        /* –ö–ê–†–¢–û–ß–ö–ò */
        .card { background: #1e1e1e; border: 1px solid #333; border-radius: 8px; padding: 20px; height: fit-content; }
        .card h3 { margin-top: 0; font-size: 14px; text-transform: uppercase; color: #aaa; border-bottom: 1px solid #333; padding-bottom: 10px; margin-bottom: 15px; display: flex; justify-content: space-between; }
        
        /* –≠–õ–ï–ú–ï–ù–¢–´ –§–û–†–ú–´ */
        .form-group { margin-bottom: 12px; }
        label { display: block; font-size: 11px; color: #777; margin-bottom: 4px; }
        input[type="number"], input[type="text"], select { width: 100%; background: #000; border: 1px solid #444; color: #fff; padding: 8px; border-radius: 4px; box-sizing: border-box; font-family: monospace; }
        input:focus { border-color: #00e676; outline: none; }
        
        input[type="range"] { width: 100%; margin: 5px 0; }
        .range-val { float: right; font-weight: bold; color: #fff; }

        /* –ö–ù–û–ü–ö–ò */
        button { border: none; padding: 10px 15px; border-radius: 4px; cursor: pointer; font-weight: bold; font-size: 12px; text-transform: uppercase; transition: 0.2s; }
        .btn-save { background: #00e676; color: #000; padding: 10px 30px; font-size: 14px; }
        .btn-save:hover { background: #00c853; box-shadow: 0 0 15px rgba(0,230,118,0.3); }
        
        .btn-act { width: 100%; margin-top: 5px; background: #333; color: #fff; border: 1px solid #555; }
        .btn-act:hover { background: #444; border-color: #fff; }
        
        .btn-danger { background: #d32f2f; color: #fff; width: 100%; }
        .btn-danger:hover { background: #b71c1c; }

        /* –ó–ê–ì–õ–£–®–ö–ê */
        #empty-state { display: flex; justify-content: center; align-items: center; height: 100%; color: #444; font-size: 20px; font-weight: bold; }
    </style>
</head>
<body>

    <div class="sidebar">
        <div class="sidebar-head">ONLINE DATABASE</div>
        <div class="user-list" id="userList">
            <div style="padding:20px; color:#666">–ó–∞–≥—Ä—É–∑–∫–∞ –∏–≥—Ä–æ–∫–æ–≤...</div>
        </div>
    </div>

    <div class="main">
        <div class="toolbar">
            <div id="selected-user-info">
                <span style="font-size:18px; font-weight:bold; color:#fff" id="display-id">–í–´–ë–ï–†–ò–¢–ï –ò–ì–†–û–ö–ê</span>
                <div style="font-size:12px; color:#666" id="display-device">---</div>
            </div>
            <button class="btn-save" onclick="saveUser()">–°–û–•–†–ê–ù–ò–¢–¨ –í–°–Å</button>
        </div>

        <div id="editor-content" class="content" style="opacity:0.2; pointer-events:none">
            
            <div class="card" style="border-top: 3px solid #ffd700">
                <h3>üí∞ –§–∏–Ω–∞–Ω—Å—ã & –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h3>
                <div class="form-group"><label>–ë–ê–õ–ê–ù–° (PLN)</label><input type="number" id="val-balance"></div>
                <div class="form-group"><label>–†–ï–ô–¢–ò–ù–ì (0.0 - 5.0)</label><input type="number" step="0.1" max="5" id="val-rating"></div>
                <div class="form-group"><label>–û–ü–´–¢ (–í—Å–µ–≥–æ –∑–∞–∫–∞–∑–æ–≤)</label><input type="number" id="val-xp"></div>
                <div class="form-group"><label>–ü–†–û–ë–ï–ì (–ö–ú)</label><input type="number" id="val-dist"></div>
                <button class="btn-act" onclick="cheatMoney()">+10,000 PLN</button>
            </div>

            <div class="card" style="border-top: 3px solid #f44336">
                <h3>‚ù§Ô∏è –ó–¥–æ—Ä–æ–≤—å–µ (Needs) <span onclick="maxNeeds()" style="cursor:pointer; font-size:10px; color:#2196f3">[MAX ALL]</span></h3>
                <div class="form-group">
                    <label>–≠–ù–ï–†–ì–ò–Ø <span class="range-val" id="disp-energy">0</span></label>
                    <input type="range" min="0" max="100" id="val-energy" oninput="upd(this, 'disp-energy')">
                </div>
                <div class="form-group">
                    <label>–í–û–î–ê <span class="range-val" id="disp-water">0</span></label>
                    <input type="range" min="0" max="100" id="val-water" oninput="upd(this, 'disp-water')">
                </div>
                <div class="form-group">
                    <label>–ù–ê–°–¢–†–û–ï–ù–ò–ï <span class="range-val" id="disp-mood">0</span></label>
                    <input type="range" min="0" max="100" id="val-mood" oninput="upd(this, 'disp-mood')">
                </div>
            </div>

            <div class="card" style="border-top: 3px solid #9c27b0">
                <h3>üéí –û–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ (Items) <span onclick="repairItems()" style="cursor:pointer; font-size:10px; color:#2196f3">[REPAIR]</span></h3>
                <div class="form-group">
                    <label>–í–ï–õ–û–°–ò–ü–ï–î <span class="range-val" id="disp-bike">0</span></label>
                    <input type="range" min="0" max="100" id="val-bike" oninput="upd(this, 'disp-bike')">
                </div>
                <div class="form-group">
                    <label>–°–£–ú–ö–ê <span class="range-val" id="disp-bag">0</span></label>
                    <input type="range" min="0" max="100" id="val-bag" oninput="upd(this, 'disp-bag')">
                </div>
                <div class="form-group">
                    <label>–¢–ï–õ–ï–§–û–ù <span class="range-val" id="disp-phone">0</span></label>
                    <input type="range" min="0" max="100" id="val-phone" oninput="upd(this, 'disp-phone')">
                </div>
            </div>

            <div class="card" style="border-top: 3px solid #00e676">
                <h3>üöñ –¢–∞–∫—Å–∏ –ë–∏–∑–Ω–µ—Å</h3>
                <div class="form-group">
                    <label>–õ–ò–¶–ï–ù–ó–ò–Ø</label>
                    <select id="val-license">
                        <option value="false">‚ùå –ù–ï–¢ –õ–ò–¶–ï–ù–ó–ò–ò</option>
                        <option value="true">‚úÖ –õ–ò–¶–ï–ù–ó–ò–Ø –ê–ö–¢–ò–í–ù–ê</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>–¢–†–ê–ù–°–ü–û–†–¢</label>
                    <select id="val-vehicle">
                        <option value="null">üö≤ –í–µ–ª–æ—Å–∏–ø–µ–¥ (–°—Ç–∞–Ω–¥–∞—Ä—Ç)</option>
                        <option value="cyber_taxi">üöñ Cyber Taxi 2077</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>–î–ï–¢–ê–õ–ò (–ß–∏–ø / –î–≤–∏–≥ / –°–ø–ª–∞–≤)</label>
                    <div style="display:grid; grid-template-columns: 1fr 1fr 1fr; gap: 5px;">
                        <input type="number" id="part-chip" placeholder="Chip">
                        <input type="number" id="part-eng" placeholder="Eng">
                        <input type="number" id="part-aly" placeholder="Aly">
                    </div>
                </div>
                <button class="btn-act" onclick="giveFullParts()">üéÅ –í—ã–¥–∞—Ç—å –≤—Å–µ –¥–µ—Ç–∞–ª–∏</button>
            </div>

            <div class="card" style="border-top: 3px solid #2196f3">
                <h3>üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å</h3>
                <div class="form-group">
                    <label>–ü–ê–†–û–õ–¨ –ò–ì–†–û–ö–ê (–ü—É—Å—Ç–æ = –í—Ö–æ–¥ –±–µ–∑ –ø–∞—Ä–æ–ª—è)</label>
                    <input type="text" id="val-pass" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–æ–≤—ã–π –ø–∞—Ä–æ–ª—å...">
                </div>
                <button class="btn-act" style="background:#0277bd" onclick="saveUser()">–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ü–∞—Ä–æ–ª—å</button>
                <div style="margin-top:20px; border-top:1px solid #333; padding-top:10px">
                    <button class="btn-danger" onclick="wipeUser()">‚ò†Ô∏è –£–î–ê–õ–ò–¢–¨ –ê–ö–ö–ê–£–ù–¢</button>
                </div>
            </div>

            <div class="card" style="border-top: 3px solid #fff">
                <h3>üåç –ì–ª–æ–±–∞–ª—å–Ω—ã–π –ú–∏—Ä</h3>
                <div class="form-group">
                    <label>–ò–ù–§–õ–Ø–¶–ò–Ø (–ú–Ω–æ–∂–∏—Ç–µ–ª—å —Ü–µ–Ω)</label>
                    <input type="number" step="0.1" id="global-inf">
                </div>
                <button class="btn-act" onclick="saveInflation()">–ü—Ä–∏–º–µ–Ω–∏—Ç—å –∫–æ –≤—Å–µ–º</button>
            </div>

        </div>
    </div>

<script>
    // 1. –ö–û–ù–§–ò–ì
    const firebaseConfig = {
        apiKey: "AIzaSyChrQMyO2soPgoEHq_f3aYs5Cs19q3sWEk",
        authDomain: "warszawa-courier.firebaseapp.com",
        databaseURL: "https://warszawa-courier-default-rtdb.europe-west1.firebasedatabase.app",
        projectId: "warszawa-courier",
        storageBucket: "warszawa-courier.firebasestorage.app",
        messagingSenderId: "295860613508",
        appId: "1:295860613508:web:86fe8364377d6875612dd1",
        measurementId: "G-TGSCHBVLX2"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    let users = {};
    let currentId = null;

    // 2. –°–õ–£–®–ê–¢–ï–õ–ò (REALTIME)
    db.ref('users').on('value', snap => {
        users = snap.val() || {};
        renderList();
        if(currentId && users[currentId]) populateForm(currentId);
    });

    db.ref('config/inflation').on('value', snap => {
        document.getElementById('global-inf').value = snap.val() || 1.0;
    });

    // 3. –û–¢–†–ò–°–û–í–ö–ê –°–ü–ò–°–ö–ê
    function renderList() {
        const container = document.getElementById('userList');
        container.innerHTML = '';
        
        const now = Date.now();
        const ids = Object.keys(users);
        
        if(ids.length === 0) {
            container.innerHTML = '<div style="padding:20px; color:#444">–ë–∞–∑–∞ –ø—É—Å—Ç–∞...</div>';
            return;
        }

        ids.forEach(id => {
            const u = users[id];
            const isOnline = (now - (u._last_seen || 0)) < 15000; // 15 sec timeout
            
            const el = document.createElement('div');
            el.className = `user-row ${id === currentId ? 'active' : ''}`;
            el.onclick = () => selectUser(id);
            el.innerHTML = `
                <div>
                    <div style="font-weight:bold; color:#fff">${id}</div>
                    <div class="u-info">${Math.floor(u.balance||0)} PLN ‚Ä¢ Rating ${u.stats?.rating||0}</div>
                </div>
                <div class="status-dot ${isOnline ? 'on' : ''}"></div>
            `;
            container.appendChild(el);
        });
    }

    // 4. –í–´–ë–û–† –ò –ó–ê–ü–û–õ–ù–ï–ù–ò–ï
    function selectUser(id) {
        currentId = id;
        renderList(); // –û–±–Ω–æ–≤–∏—Ç—å –ø–æ–¥—Å–≤–µ—Ç–∫—É
        
        const area = document.getElementById('editor-content');
        area.style.opacity = '1';
        area.style.pointerEvents = 'all';
        
        document.getElementById('display-id').innerText = id;
        document.getElementById('display-device').innerText = users[id]._device || "Unknown Device";

        populateForm(id);
    }

    function populateForm(id) {
        const u = users[id];
        
        // 1. Stats
        document.getElementById('val-balance').value = u.balance;
        document.getElementById('val-rating').value = u.stats?.rating || 0;
        document.getElementById('val-xp').value = u.stats?.total_deliveries || 0;
        document.getElementById('val-dist').value = u.stats?.distance || 0;
        
        // 2. Needs
        setRg('val-energy', 'disp-energy', u.needs?.energy);
        setRg('val-water', 'disp-water', u.needs?.water);
        setRg('val-mood', 'disp-mood', u.needs?.mood);
        
        // 3. Items
        setRg('val-bike', 'disp-bike', u.items?.bike);
        setRg('val-bag', 'disp-bag', u.items?.bag);
        setRg('val-phone', 'disp-phone', u.items?.phone);

        // 4. Taxi
        document.getElementById('val-license').value = (u.taxi?.license || false).toString();
        document.getElementById('val-vehicle').value = u.taxi?.vehicle || "null";
        
        document.getElementById('part-chip').value = u.inventory?.part_chip || 0;
        document.getElementById('part-eng').value = u.inventory?.part_engine || 0;
        document.getElementById('part-aly').value = u.inventory?.part_alloy || 0;

        // 5. Pass
        document.getElementById('val-pass').value = u.password || "";
    }

    // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è –¥–ª—è –ø–æ–ª–∑—É–Ω–∫–æ–≤
    function setRg(inpId, txtId, val) {
        const v = val !== undefined ? val : 100;
        document.getElementById(inpId).value = v;
        document.getElementById(txtId).innerText = v;
    }
    function upd(el, txtId) { document.getElementById(txtId).innerText = el.value; }


    // 5. –°–û–•–†–ê–ù–ï–ù–ò–ï
    function saveUser() {
        if(!currentId) return;
        const u = JSON.parse(JSON.stringify(users[currentId])); // Clone

        // –°–æ–±–∏—Ä–∞–µ–º –¥–∞–Ω–Ω—ã–µ
        u.balance = parseFloat(document.getElementById('val-balance').value);
        if(!u.stats) u.stats = {};
        u.stats.rating = parseFloat(document.getElementById('val-rating').value);
        u.stats.total_deliveries = parseInt(document.getElementById('val-xp').value);
        u.stats.distance = parseFloat(document.getElementById('val-dist').value);

        if(!u.needs) u.needs = {};
        u.needs.energy = parseInt(document.getElementById('val-energy').value);
        u.needs.water = parseInt(document.getElementById('val-water').value);
        u.needs.mood = parseInt(document.getElementById('val-mood').value);

        if(!u.items) u.items = {};
        u.items.bike = parseInt(document.getElementById('val-bike').value);
        u.items.bag = parseInt(document.getElementById('val-bag').value);
        u.items.phone = parseInt(document.getElementById('val-phone').value);

        if(!u.taxi) u.taxi = {};
        u.taxi.license = (document.getElementById('val-license').value === 'true');
        const veh = document.getElementById('val-vehicle').value;
        u.taxi.vehicle = (veh === 'null') ? null : veh;

        if(!u.inventory) u.inventory = {};
        u.inventory.part_chip = parseInt(document.getElementById('part-chip').value);
        u.inventory.part_engine = parseInt(document.getElementById('part-eng').value);
        u.inventory.part_alloy = parseInt(document.getElementById('part-aly').value);

        const pass = document.getElementById('val-pass').value;
        if(pass.trim() === "") delete u.password; else u.password = pass;

        // –û—Ç–ø—Ä–∞–≤–∫–∞
        db.ref('users/' + currentId).set(u)
            .then(() => alert('–î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã!'))
            .catch(e => alert('–û—à–∏–±–∫–∞: ' + e));
    }

    // 6. –ë–´–°–¢–†–´–ï –î–ï–ô–°–¢–í–ò–Ø
    function cheatMoney() { 
        document.getElementById('val-balance').value = parseFloat(document.getElementById('val-balance').value) + 10000;
        saveUser();
    }
    function maxNeeds() {
        setRg('val-energy', 'disp-energy', 100);
        setRg('val-water', 'disp-water', 100);
        setRg('val-mood', 'disp-mood', 100);
    }
    function repairItems() {
        setRg('val-bike', 'disp-bike', 100);
        setRg('val-bag', 'disp-bag', 100);
        setRg('val-phone', 'disp-phone', 100);
    }
    function giveFullParts() {
        document.getElementById('part-chip').value = 1;
        document.getElementById('part-eng').value = 1;
        document.getElementById('part-aly').value = 1;
        saveUser();
    }
    function wipeUser() {
        if(confirm('–¢–û–ß–ù–û –£–î–ê–õ–ò–¢–¨ –ò–ì–†–û–ö–ê? –≠–¢–û –ù–ï–û–ë–†–ê–¢–ò–ú–û.')) {
            db.ref('users/' + currentId).remove();
            document.getElementById('editor-content').style.opacity = '0.2';
            document.getElementById('editor-content').style.pointerEvents = 'none';
            currentId = null;
        }
    }

    function saveInflation() {
        const val = parseFloat(document.getElementById('global-inf').value);
        db.ref('config/inflation').set(val);
        alert('–ò–Ω—Ñ–ª—è—Ü–∏—è –º–∏—Ä–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∞: x' + val);
    }

</script>
</body>
</html>
