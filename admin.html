<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GOD MODE v7.0: ROCKET PLANNER</title>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body { background: #f0f2f5; font-family: 'Segoe UI', sans-serif; padding: 15px; font-size: 13px; color: #1c1e21; }
        
        /* HEADER & TABS */
        .header { background: white; padding: 15px; border-radius: 8px; margin-bottom: 15px; display: flex; justify-content: space-between; align-items: center; }
        .status { font-weight: bold; color: #ccc; } .status.on { color: #00c853; }
        .nav { display: flex; gap: 5px; margin-bottom: 20px; overflow-x: auto; padding-bottom: 5px; }
        .nav-btn { flex: 1; padding: 10px; background: white; border: 1px solid #ddd; border-radius: 6px; cursor: pointer; font-weight: bold; min-width: 90px; }
        .nav-btn.active { background: #1877f2; color: white; border-color: #1877f2; }
        .view { display: none; } .view.active { display: block; }

        /* CARDS */
        .card { background: white; padding: 15px; border-radius: 8px; margin-bottom: 10px; border: 1px solid #ddd; }
        .card h3 { margin: 0 0 10px 0; font-size: 14px; text-transform: uppercase; color: #1877f2; border-bottom: 1px solid #eee; padding-bottom: 5px; }
        .row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; }
        input { width: 80px; padding: 6px; text-align: center; border: 1px solid #ccc; border-radius: 4px; }
        
        .btn { width: 100%; padding: 12px; border: none; border-radius: 6px; font-weight: bold; color: white; cursor: pointer; margin-top: 5px; }
        .btn-green { background: #42b72a; } .btn-blue { background: #1877f2; } .btn-red { background: #fa3e3e; }

        /* ROCKET PLANNER STYLES */
        .rk-editor { background: #e3f2fd; padding: 15px; border-radius: 8px; border: 1px solid #90caf9; margin-bottom: 15px; }
        .rk-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 10px; }
        .rk-full { width: 100%; box-sizing: border-box; text-align: left; }
        .rk-label { font-size: 11px; color: #555; display: block; margin-bottom: 3px; font-weight: bold; }
        
        .bonus-item { background: white; border: 1px solid #eee; padding: 10px; border-radius: 6px; margin-bottom: 5px; display: flex; justify-content: space-between; align-items: center; }
        .bonus-badge { padding: 2px 6px; border-radius: 4px; font-size: 10px; font-weight: bold; color: white; }
        .bg-active { background: #00c853; } .bg-future { background: #ff9800; } .bg-ended { background: #9e9e9e; }

        /* OTHER STYLES (Simple) */
        .p-card { background: white; padding: 10px; border-radius: 6px; margin-bottom: 5px; border-left: 4px solid #ccc; cursor: pointer; display: flex; justify-content: space-between; }
        .p-card.on { border-left-color: #42b72a; }
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 99; justify-content: center; align-items: center; }
        .modal.open { display: flex; }
        .modal-box { background: white; width: 90%; max-width: 400px; padding: 20px; border-radius: 10px; max-height: 90vh; overflow-y: auto; }
    </style>
</head>
<body>

<div class="header">
    <h2 style="margin:0">GOD MODE <small>v7.0</small></h2>
    <div id="status" class="status">OFFLINE</div>
</div>

<div class="nav">
    <button class="nav-btn active" onclick="tab('rocket')">üöÄ –†–∞–∫–µ—Ç–∞</button>
    <button class="nav-btn" onclick="tab('players')">üë• –ò–≥—Ä–æ–∫–∏</button>
    <button class="nav-btn" onclick="tab('tariffs')">üí∏ –¢–∞—Ä–∏—Ñ—ã</button>
    <button class="nav-btn" onclick="tab('system')">‚öôÔ∏è –°–∏—Å—Ç–µ–º–∞</button>
</div>

<div id="rocket" class="view active">
    
    <div class="card">
        <h3>üõ† –°–æ–∑–¥–∞—Ç—å –ê–∫—Ü–∏—é</h3>
        <div class="rk-editor">
            <div style="margin-bottom:10px">
                <span class="rk-label">–ù–∞–∑–≤–∞–Ω–∏–µ –∞–∫—Ü–∏–∏ (–ó–∞–≥–æ–ª–æ–≤–æ–∫)</span>
                <input type="text" id="rk-title" class="rk-full" placeholder='–ù–∞–ø—Ä–∏–º–µ—Ä: "–í–µ—á–µ—Ä–Ω–∏–π –∂–æ—Ä"'>
            </div>
            
            <div class="rk-grid">
                <div>
                    <span class="rk-label">–¢–∏–ø —Ü–µ–ª–∏</span>
                    <select id="rk-type" class="rk-full" style="padding:6px; border-radius:4px; border:1px solid #ccc">
                        <option value="orders">–°–¥–µ–ª–∞—Ç—å –∑–∞–∫–∞–∑–æ–≤</option>
                        <option value="money">–ó–∞—Ä–∞–±–æ—Ç–∞—Ç—å –¥–µ–Ω–µ–≥</option>
                    </select>
                </div>
                <div>
                    <span class="rk-label">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ (–¶–µ–ª—å)</span>
                    <input type="number" id="rk-target" class="rk-full" placeholder="10">
                </div>
            </div>

            <div style="margin-bottom:10px">
                <span class="rk-label">–ù–∞–≥—Ä–∞–¥–∞ (PLN)</span>
                <input type="number" id="rk-reward" class="rk-full" placeholder="500">
            </div>

            <div class="rk-grid">
                <div>
                    <span class="rk-label">–ù–∞—á–∞–ª–æ (–î–∞—Ç–∞ –∏ –í—Ä–µ–º—è)</span>
                    <input type="datetime-local" id="rk-start" class="rk-full">
                </div>
                <div>
                    <span class="rk-label">–ö–æ–Ω–µ—Ü (–î–∞—Ç–∞ –∏ –í—Ä–µ–º—è)</span>
                    <input type="datetime-local" id="rk-end" class="rk-full">
                </div>
            </div>
            
            <button class="btn btn-blue" onclick="createBonus()">–î–û–ë–ê–í–ò–¢–¨ –í –†–ê–°–ü–ò–°–ê–ù–ò–ï</button>
        </div>
    </div>

    <div class="card">
        <h3>üìÖ –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –ë–æ–Ω—É—Å–æ–≤</h3>
        <div id="bonus-list">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
    </div>
</div>

<div id="players" class="view">
    <input type="text" id="search" placeholder="üîç –ü–æ–∏—Å–∫..." onkeyup="renderPlayers()" style="width:100%; padding:10px; box-sizing:border-box; margin-bottom:10px">
    <div id="p-list">Loading...</div>
</div>

<div id="tariffs" class="view">
    <div class="card">
        <h3>–≠–∫–æ–Ω–æ–º–∏–∫–∞</h3>
        <div class="row"><label>–ë–∞–∑–æ–≤–∞—è –ø–æ–¥–∞—á–∞</label><input type="number" id="basePickupPay"></div>
        <div class="row"><label>–û–ø–ª–∞—Ç–∞ –∑–∞ –ö–ú</label><input type="number" id="perKmPay"></div>
        <div class="row"><label>–ú–Ω–æ–∂–∏—Ç–µ–ª—å –¢–ê–ö–°–ò</label><input type="number" id="taxiMulti"></div>
    </div>
    <button class="btn btn-green" onclick="saveConfig()">–°–û–•–†–ê–ù–ò–¢–¨</button>
</div>

<div id="system" class="view">
    <div class="card">
        <h3>–°–±—Ä–æ—Å</h3>
        <button class="btn btn-red" onclick="if(confirm('–£–¥–∞–ª–∏—Ç—å –≤—Å–µ –±–æ–Ω—É—Å—ã?')) db.ref('bonuses/list').remove()">–û–ß–ò–°–¢–ò–¢–¨ –†–ê–°–ü–ò–°–ê–ù–ò–ï –ê–ö–¶–ò–ô</button>
    </div>
</div>

<div id="modal" class="modal">
    <div class="modal-box">
        <h2 id="m-name">–ò–≥—Ä–æ–∫</h2>
        <div class="card">
            <h3>–ë–∞–ª–∞–Ω—Å</h3>
            <input type="number" id="m-bal" style="width:100%">
        </div>
        <div style="display:flex; gap:5px">
            <button class="btn" style="background:#ffc107; color:black" onclick="giveTaxi()">üéÅ –î–ê–¢–¨ –¢–ê–ö–°–ò</button>
            <button class="btn btn-red" onclick="banUser()">–ë–ê–ù</button>
        </div>
        <button class="btn btn-green" onclick="saveUser()">–°–û–•–†–ê–ù–ò–¢–¨</button>
        <button class="btn" style="background:#ccc; color:#333" onclick="closeModal()">–ó–ê–ö–†–´–¢–¨</button>
    </div>
</div>

<script>
    const fb = { apiKey: "AIzaSyChrQMyO2soPgoEHq_f3aYs5Cs19q3sWEk", authDomain: "warszawa-courier.firebaseapp.com", databaseURL: "https://warszawa-courier-default-rtdb.europe-west1.firebasedatabase.app", projectId: "warszawa-courier", storageBucket: "warszawa-courier.firebasestorage.app", messagingSenderId: "295860613508", appId: "1:295860613508:web:86fe8364377d6875612dd1" };
    firebase.initializeApp(fb);
    const db = firebase.database();
    
    let players = {}, bonuses = [];
    let activeId = null;

    db.ref('.info/connected').on('value', s => {
        document.getElementById('status').innerText = s.val() ? 'ONLINE' : 'OFFLINE';
        document.getElementById('status').className = s.val() ? 'status on' : 'status';
    });

    // LISTENERS
    db.ref('players').on('value', s => { players = s.val() || {}; renderPlayers(); });
    db.ref('config').on('value', s => {
        const c = s.val() || {};
        const set = (id, v) => { if(document.getElementById(id)) document.getElementById(id).value = v; };
        set('basePickupPay', c.basePickupPay||4); set('perKmPay', c.perKmPay||1.5); set('taxiMulti', c.taxiMulti||4);
    });
    
    // NEW: LISTEN TO BONUS LIST
    db.ref('bonuses/list').on('value', s => {
        const data = s.val() || {};
        bonuses = Object.entries(data).map(([k,v]) => ({id:k, ...v}));
        renderBonuses();
    });

    // --- ROCKET LOGIC ---
    function createBonus() {
        const title = document.getElementById('rk-title').value;
        const target = parseInt(document.getElementById('rk-target').value);
        const reward = parseFloat(document.getElementById('rk-reward').value);
        const start = new Date(document.getElementById('rk-start').value).getTime();
        const end = new Date(document.getElementById('rk-end').value).getTime();
        const type = document.getElementById('rk-type').value;

        if(!title || !target || !reward || !start || !end) {
            alert("–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è!"); return;
        }
        if(end <= start) {
            alert("–î–∞—Ç–∞ –∫–æ–Ω—Ü–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –ø–æ–∑–∂–µ –Ω–∞—á–∞–ª–∞!"); return;
        }

        const newBonus = {
            title, target, reward, startTime: start, endTime: end, type
        };

        db.ref('bonuses/list').push(newBonus).then(() => {
            alert("–ê–∫—Ü–∏—è –¥–æ–±–∞–≤–ª–µ–Ω–∞ –≤ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ!");
            // –û—á–∏—Å—Ç–∫–∞ –ø–æ–ª–µ–π
            document.getElementById('rk-title').value = '';
        });
    }

    function deleteBonus(id) {
        if(confirm("–£–¥–∞–ª–∏—Ç—å —ç—Ç—É –∞–∫—Ü–∏—é?")) db.ref('bonuses/list/'+id).remove();
    }

    function renderBonuses() {
        const c = document.getElementById('bonus-list');
        c.innerHTML = '';
        const now = Date.now();

        // –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ –≤—Ä–µ–º–µ–Ω–∏ –Ω–∞—á–∞–ª–∞
        bonuses.sort((a,b) => a.startTime - b.startTime);

        bonuses.forEach(b => {
            let status = '';
            let badgeClass = '';
            
            if (now < b.startTime) {
                status = '‚è≥ –°–∫–æ—Ä–æ'; badgeClass = 'bg-future';
            } else if (now >= b.startTime && now <= b.endTime) {
                status = 'üî• –ê–∫—Ç–∏–≤–Ω–∞'; badgeClass = 'bg-active';
            } else {
                status = 'üèÅ –ó–∞–≤–µ—Ä—à–µ–Ω–∞'; badgeClass = 'bg-ended';
            }

            const startStr = new Date(b.startTime).toLocaleString();
            const endStr = new Date(b.endTime).toLocaleString();

            c.innerHTML += `
            <div class="bonus-item">
                <div style="flex:1">
                    <div style="font-weight:bold; font-size:14px">${b.title} <span class="bonus-badge ${badgeClass}">${status}</span></div>
                    <div style="font-size:11px; color:#666">–¶–µ–ª—å: ${b.target} (${b.type==='orders'?'–ó–∞–∫–∞–∑–æ–≤':'–î–µ–Ω–µ–≥'}) | –ù–∞–≥—Ä–∞–¥–∞: ${b.reward} PLN</div>
                    <div style="font-size:10px; color:#888; margin-top:2px">–°: ${startStr} <br>–ü–æ: ${endStr}</div>
                </div>
                <button onclick="deleteBonus('${b.id}')" style="background:none; border:none; color:red; font-weight:bold; cursor:pointer; font-size:16px">‚úï</button>
            </div>`;
        });
        
        if(bonuses.length === 0) c.innerHTML = '<div style="text-align:center; color:#999; padding:20px">–ù–µ—Ç –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∞–∫—Ü–∏–π</div>';
    }

    // --- PLAYERS & TABS ---
    function tab(id) {
        document.querySelectorAll('.view').forEach(e=>e.classList.remove('active'));
        document.querySelectorAll('.nav-btn').forEach(e=>e.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        event.target.classList.add('active');
    }

    function renderPlayers() {
        const list = document.getElementById('p-list');
        const term = document.getElementById('search').value.toLowerCase();
        list.innerHTML = '';
        
        const arr = Object.entries(players).map(([k,v]) => ({id:k, ...v}));
        const filtered = arr.filter(p => (p.name||'Guest').toLowerCase().includes(term));
        
        filtered.sort((a,b) => (b.balance||0) - (a.balance||0));

        filtered.forEach(p => {
            const online = (Date.now() - (p.lastSeen||0) < 15000);
            list.innerHTML += `<div class="p-card ${online?'on':''}" onclick="edit('${p.id}')">
                <div><b>${p.name||'Anon'}</b><br><small>${p.id}</small></div>
                <div style="text-align:right"><b>${(p.balance||0).toFixed(2)}</b><br><small>${online?'ON':'OFF'}</small></div>
            </div>`;
        });
    }

    function edit(id) {
        activeId = id; const p = players[id];
        document.getElementById('modal').classList.add('open');
        document.getElementById('m-name').innerText = p.name;
        document.getElementById('m-bal').value = p.balance||0;
    }
    function closeModal() { document.getElementById('modal').classList.remove('open'); activeId = null; }
    function saveUser() {
        if(!activeId) return;
        db.ref('players/'+activeId).update({ balance: parseFloat(document.getElementById('m-bal').value) });
        closeModal();
    }
    function giveTaxi() {
        if(confirm('–î–∞—Ç—å —Ç–∞–∫—Å–∏?')) db.ref('players/'+activeId+'/taxi').update({ unlocked:true, vehicle:'tesla', licenses:{driver:true, insurance:true, taxi:true} });
    }
    function banUser() {
        if(activeId) db.ref('players/'+activeId).update({ isBanned: !players[activeId].isBanned });
        closeModal();
    }
    
    function saveConfig() {
        const get = (id) => parseFloat(document.getElementById(id).value);
        db.ref('config').update({ basePickupPay: get('basePickupPay'), perKmPay: get('perKmPay'), taxiMulti: get('taxiMulti') });
        alert('–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ');
    }
</script>
</body>
</html>

