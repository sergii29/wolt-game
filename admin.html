<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WOLT ADMIN</title>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
    <style>
        body { background: #121212; color: white; font-family: monospace; display: flex; height: 100vh; margin: 0; }
        .sidebar { width: 300px; border-right: 1px solid #333; overflow-y: auto; }
        .main { flex: 1; padding: 20px; overflow-y: auto; }
        .player-row { padding: 10px; border-bottom: 1px solid #333; cursor: pointer; display: flex; justify-content: space-between; }
        .player-row:hover { background: #222; }
        .player-row.active { background: #004d40; border-left: 5px solid #00e676; }
        .online-dot { color: #00e676; } .offline-dot { color: #555; }
        .card { background: #1e1e1e; padding: 15px; margin-bottom: 15px; border-radius: 8px; border: 1px solid #333; }
        h3 { margin-top: 0; color: #aaa; border-bottom: 1px solid #333; padding-bottom: 5px; }
        button { padding: 10px; background: #333; color: white; border: none; cursor: pointer; margin-right: 5px; border-radius: 4px; }
        button:hover { background: #555; }
        .btn-green { background: #1b5e20; }
        .btn-red { background: #b71c1c; }
    </style>
</head>
<body>

<div class="sidebar" id="list">–ó–∞–≥—Ä—É–∑–∫–∞...</div>

<div class="main" id="details">
    <h1>–í—ã–±–µ—Ä–∏—Ç–µ –∏–≥—Ä–æ–∫–∞</h1>
</div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyChrQMyO2soPgoEHq_f3aYs5Cs19q3sWEk",
        authDomain: "warszawa-courier.firebaseapp.com",
        databaseURL: "https://warszawa-courier-default-rtdb.europe-west1.firebasedatabase.app",
        projectId: "warszawa-courier",
        storageBucket: "warszawa-courier.firebasestorage.app",
        messagingSenderId: "295860613508",
        appId: "1:295860613508:web:86fe8364377d6875612dd1"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    let players = {};
    let users = {}; // –¢—É—Ç –ø–∞—Ä–æ–ª–∏
    let currentId = null;

    // –ß–∏—Ç–∞–µ–º –∏–≥—Ä–æ–∫–æ–≤
    db.ref('players').on('value', s => {
        players = s.val() || {};
        renderList();
        if(currentId) renderDetails(currentId);
    });

    // –ß–∏—Ç–∞–µ–º –ø–∞—Ä–æ–ª–∏
    db.ref('users_lookup').on('value', s => {
        users = s.val() || {};
        if(currentId) renderDetails(currentId);
    });

    function renderList() {
        let html = '';
        const now = Date.now();
        // –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞: –°–Ω–∞—á–∞–ª–∞ –æ–Ω–ª–∞–π–Ω
        Object.keys(players).sort((a,b) => (players[b].lastSeen||0) - (players[a].lastSeen||0)).forEach(id => {
            const p = players[id];
            const isOnline = (now - (p.lastSeen || 0)) < 60000;
            html += `
                <div class="player-row ${id===currentId?'active':''}" onclick="currentId='${id}'; renderDetails('${id}'); renderList()">
                    <div>
                        <span class="${isOnline?'online-dot':'offline-dot'}">‚óè</span> 
                        ${p.name || 'No Name'}
                    </div>
                    <div>${Math.floor(p.balance||0)}</div>
                </div>
            `;
        });
        document.getElementById('list').innerHTML = html;
    }

    function renderDetails(id) {
        const p = players[id];
        if(!p) return;

        // –ü–æ–∏—Å–∫ –ø–∞—Ä–æ–ª—è
        let authInfo = '<span style="color:#888">–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ Telegram</span>';
        const userEntry = Object.values(users).find(u => u.playerId === id);
        if(userEntry) {
            authInfo = `
                <div style="background:#000; padding:10px; border:1px solid #333; font-family:monospace">
                    LOGIN: <b style="color:#fff">${userEntry.login}</b><br>
                    PASS:  <b style="color:#00e676">${userEntry.pass}</b>
                </div>`;
        }

        document.getElementById('details').innerHTML = `
            <h2>${p.name} <span style="font-size:12px; color:#666">${id}</span></h2>
            
            <div class="card">
                <h3>üîë –î–∞–Ω–Ω—ã–µ –≤—Ö–æ–¥–∞ (Android/Web)</h3>
                ${authInfo}
            </div>

            <div class="card">
                <h3>üí∞ –ë–∞–ª–∞–Ω—Å: ${p.balance} PLN</h3>
                <button class="btn-green" onclick="send('${id}', 'balance', ${(p.balance||0)+1000})">+1000</button>
                <button class="btn-green" onclick="send('${id}', 'balance', ${(p.balance||0)+50000})">+50K</button>
                <button class="btn-red" onclick="send('${id}', 'balance', 0)">–û–±–Ω—É–ª–∏—Ç—å</button>
            </div>

            <div class="card">
                <h3>‚ö° –î–µ–π—Å—Ç–≤–∏—è</h3>
                <button class="btn-green" onclick="giveCyber('${id}')">–í—ã–¥–∞—Ç—å Cyber-X</button>
                <button class="btn-green" onclick="heal('${id}')">–í—ã–ª–µ—á–∏—Ç—å</button>
                <button class="btn-red" onclick="send('${id}', 'isBanned', ${!p.isBanned})">${p.isBanned?'–†–ê–ó–ë–ê–ù–ò–¢–¨':'–ó–ê–ë–ê–ù–ò–¢–¨'}</button>
            </div>
        `;
    }

    // –û—Ç–ø—Ä–∞–≤–∫–∞ –∫–æ–º–∞–Ω–¥
    window.send = function(id, path, val) {
        db.ref('players/'+id+'/adminInbox').push({ type: 'SET_VAR', path: path, value: val });
    };

    window.giveCyber = function(id) {
        send(id, 'taxi.vehicle', 'cyber_x');
        send(id, 'taxi.active', true);
        alert('–ú–∞—à–∏–Ω–∞ –≤—ã–¥–∞–Ω–∞!');
    };
    
    window.heal = function(id) {
        send(id, 'needs.energy', 100);
        send(id, 'needs.water', 100);
        send(id, 'needs.mood', 100);
        alert('–í—ã–ª–µ—á–µ–Ω!');
    };

</script>
</body>
</html>
