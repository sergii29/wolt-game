<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WOLT ADMIN | FIX MODE</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

    <style>
        :root { --bg: #121212; --panel: #1e1e1e; --border: #333; --text: #e0e0e0; --accent: #00e676; }
        body { margin: 0; padding: 0; font-family: monospace; background: var(--bg); color: var(--text); height: 100vh; display: flex; }
        
        .sidebar { width: 300px; background: var(--panel); border-right: 1px solid var(--border); display: flex; flex-direction: column; }
        .sidebar-header { padding: 15px; border-bottom: 1px solid var(--border); font-weight: bold; color: var(--accent); }
        .search-box input { width: 90%; background: #333; border: none; padding: 8px; color: white; margin: 10px; }
        .player-list { flex: 1; overflow-y: auto; }
        .player-item { padding: 10px; border-bottom: 1px solid #333; cursor: pointer; }
        .player-item:hover { background: #333; }
        .player-item.active { background: #333; border-left: 3px solid var(--accent); }

        .main { flex: 1; padding: 20px; overflow-y: auto; }
        .card-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 15px; }
        .card { background: var(--panel); border: 1px solid var(--border); padding: 15px; border-radius: 8px; }
        .card h3 { margin-top: 0; color: #888; font-size: 14px; text-transform: uppercase; }
        
        .btn { padding: 8px 15px; border: none; border-radius: 4px; cursor: pointer; font-weight: bold; color: white; width: 100%; margin-top: 5px; }
        .btn-green { background: #00e676; color: black; }
        .btn-red { background: #ff3d00; }
        .btn-blue { background: #2979ff; }
        
        .raw-data { background: #000; padding: 10px; font-size: 10px; color: #0f0; margin-top: 20px; white-space: pre-wrap; display: none; }
    </style>
</head>
<body>

<div class="sidebar">
    <div class="sidebar-header">ADMIN PANEL (FIXED)</div>
    <div class="search-box"><input type="text" id="search" placeholder="–ü–æ–∏—Å–∫..." oninput="renderList()"></div>
    <div class="player-list" id="player-list">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
</div>

<div class="main">
    <div id="no-selection">–í—ã–±–µ—Ä–∏—Ç–µ –∏–≥—Ä–æ–∫–∞ —Å–ª–µ–≤–∞</div>
    <div id="player-details" style="display:none;"></div>
</div>

<script>
    // 1. –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø (–¢–í–û–Ø)
    const firebaseConfig = {
      apiKey: "AIzaSyChrQMyO2soPgoEHq_f3aYs5Cs19q3sWEk",
      authDomain: "warszawa-courier.firebaseapp.com",
      databaseURL: "https://warszawa-courier-default-rtdb.europe-west1.firebasedatabase.app",
      projectId: "warszawa-courier",
      storageBucket: "warszawa-courier.firebasestorage.app",
      messagingSenderId: "295860613508",
      appId: "1:295860613508:web:86fe8364377d6875612dd1",
      measurementId: "G-TGSCHBVLX2"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    
    let playersData = {};
    let selectedId = null;

    // 2. –ó–ê–ì–†–£–ó–ö–ê –î–ê–ù–ù–´–•
    db.ref('users').on('value', snapshot => {
        playersData = snapshot.val() || {};
        renderList();
        if(selectedId && playersData[selectedId]) {
            renderPlayerDetails(playersData[selectedId], selectedId);
        }
    });

    // 3. –°–ü–ò–°–û–ö –ò–ì–†–û–ö–û–í
    function renderList() {
        const filter = document.getElementById('search').value.toLowerCase();
        const container = document.getElementById('player-list');
        container.innerHTML = '';

        Object.entries(playersData).forEach(([id, user]) => {
            // –ü—ã—Ç–∞–µ–º—Å—è –Ω–∞–π—Ç–∏ —Ö–æ—Ç—å –∫–∞–∫–æ–µ-—Ç–æ –∏–º—è
            const name = user.firstName || user.username || user.name || '–ë–µ–∑ –∏–º–µ–Ω–∏';
            
            if(name.toLowerCase().includes(filter) || id.toLowerCase().includes(filter)) {
                const div = document.createElement('div');
                div.className = `player-item ${id === selectedId ? 'active' : ''}`;
                div.innerHTML = `<b>${name}</b><br><small style="color:#777">${id}</small>`;
                div.onclick = () => { selectedId = id; renderList(); document.getElementById('no-selection').style.display='none'; document.getElementById('player-details').style.display='block'; renderPlayerDetails(user, id); };
                container.appendChild(div);
            }
        });
    }

    // 4. –î–ï–¢–ê–õ–ò –ò–ì–†–û–ö–ê (–£–ú–ù–ê–Ø –§–£–ù–ö–¶–ò–Ø)
    function renderPlayerDetails(data, id) {
        // –ò—â–µ–º –±–∞–ª–∞–Ω—Å –≤–æ –≤—Å–µ—Ö –≤–æ–∑–º–æ–∂–Ω—ã—Ö –ø–æ–ª—è—Ö
        const balance = data.balance !== undefined ? data.balance : (data.money || 0);
        // –ò—â–µ–º –∏–º—è
        const name = data.firstName || data.username || data.name || '–ù–µ —É–∫–∞–∑–∞–Ω–æ';
        // –ò—â–µ–º –¥–æ—Å—Ç–∞–≤–∫–∏
        const deliveries = data.totalDeliveries || data.deliveries || data.orders || 0;
        
        const taxi = data.taxi || {};
        const inv = data.inventory || {};

        let invHtml = '';
        for(let k in inv) if(inv[k] > 0) invHtml += `<div>${k}: <b>${inv[k]}</b></div>`;

        document.getElementById('player-details').innerHTML = `
            <h2 style="margin-top:0">${name} <span style="font-size:14px; color:#777">(${id})</span></h2>
            
            <div class="card-grid">
                <div class="card">
                    <h3>–§–∏–Ω–∞–Ω—Å—ã & –°—Ç–∞—Ç–∞</h3>
                    <div style="font-size:24px; color:#00e676">${Number(balance).toFixed(2)} PLN</div>
                    <div>–î–æ—Å—Ç–∞–≤–æ–∫: <b>${deliveries}</b></div>
                    <div style="margin-top:10px">
                        <button class="btn btn-blue" onclick="setBalancePrompt('${id}')">‚úèÔ∏è –ò–∑–º–µ–Ω–∏—Ç—å –ë–∞–ª–∞–Ω—Å</button>
                    </div>
                </div>

                <div class="card" style="border-color:#ff9100">
                    <h3>–¢–∞–∫—Å–∏ –°–æ—Å—Ç–æ—è–Ω–∏–µ</h3>
                    <div>–ú–∞—à–∏–Ω–∞ —Å–æ–±—Ä–∞–Ω–∞: <b>${taxi.isCarAssembled ? '–î–ê' : '–ù–ï–¢'}</b></div>
                    <div>–ó–¥–æ—Ä–æ–≤—å–µ: <b>${taxi.health||0}%</b></div>
                    <div>–ë–µ–Ω–∑–∏–Ω: <b>${taxi.fuel||0}%</b></div>
                </div>

                <div class="card" style="border-color:#d500f9">
                    <h3>üîß –ì–∞—Ä–∞–∂ Cyber X</h3>
                    <button class="btn btn-green" onclick="giveFullPack('${id}')">üéÅ –í—ã–¥–∞—Ç—å –§—É–ª–ª (–ú–∞—à–∏–Ω–∞+55–∑+–ë–µ–Ω–∑)</button>
                    <button class="btn btn-red" onclick="resetCar('${id}')">üóë –°–±—Ä–æ—Å–∏—Ç—å –º–∞—à–∏–Ω—É</button>
                </div>

                <div class="card">
                    <h3>–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å</h3>
                    <div style="font-size:12px">${invHtml || '–ü—É—Å—Ç–æ'}</div>
                </div>
            </div>

            <div style="margin-top:20px;">
                <button onclick="document.getElementById('raw-${id}').style.display='block'" style="background:#333; color:#aaa; border:none; cursor:pointer; padding:5px;">üîç –ü–æ–∫–∞–∑–∞—Ç—å —Å—ã—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ –ë–î</button>
                <div id="raw-${id}" class="raw-data">${JSON.stringify(data, null, 2)}</div>
            </div>
        `;
    }

    // 5. –§–£–ù–ö–¶–ò–ò
    function setBalancePrompt(uid) {
        const val = prompt("–í–≤–µ–¥–∏—Ç–µ –Ω–æ–≤—ã–π –±–∞–ª–∞–Ω—Å (PLN):");
        if(val) db.ref('users/'+uid).update({ balance: parseFloat(val) }).then(()=>alert('–ë–∞–ª–∞–Ω—Å –æ–±–Ω–æ–≤–ª–µ–Ω!'));
    }

    function giveFullPack(uid) {
        if(!confirm("–í—ã–¥–∞—Ç—å –¥–µ—Ç–∞–ª–∏, —Å–æ–±—Ä–∞—Ç—å –º–∞—à–∏–Ω—É, –Ω–∞–ª–∏—Ç—å –±–µ–Ω–∑–∏–Ω –∏ –¥–∞—Ç—å 55 –∑–∞–∫–∞–∑–æ–≤?")) return;
        db.ref('users/'+uid).update({
            'inventory/part_engine': 1,
            'inventory/part_chip': 1,
            'inventory/part_alloy': 1,
            'inventory/part_tire': 4,
            'inventory/part_battery': 5,
            'inventory/fuel_canister': 10,
            'totalDeliveries': 55,       // –û–ü–´–¢
            'taxi/isCarAssembled': false, // –ß—Ç–æ–±—ã –∫–Ω–æ–ø–∫–∞ "–°–æ–±—Ä–∞—Ç—å" –±—ã–ª–∞ –∞–∫—Ç–∏–≤–Ω–∞
            'taxi/health': 100,
            'taxi/fuel': 100
        }).then(()=>alert("‚úÖ –í—ã–¥–∞–Ω–æ! –ü—Ä–æ–≤–µ—Ä—å –≤ –∏–≥—Ä–µ."));
    }

    function resetCar(uid) {
        if(!confirm("–£–¥–∞–ª–∏—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å –º–∞—à–∏–Ω—ã?")) return;
        db.ref('users/'+uid).update({
            'taxi/isCarAssembled': false,
            'taxi/active': false,
            'inventory/part_engine': 0,
            'inventory/part_chip': 0,
            'inventory/part_alloy': 0
        }).then(()=>alert("‚úÖ –°–±—Ä–æ—à–µ–Ω–æ."));
    }
</script>

</body>
</html>
