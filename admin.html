<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>WOLT ADMIN PANEL</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <style>
        body { background: #111; color: #eee; font-family: 'Segoe UI', monospace; display: flex; height: 100vh; margin: 0; }
        
        /* SIDEBAR */
        .sidebar { width: 300px; background: #000; border-right: 1px solid #333; display: flex; flex-direction: column; }
        .head { padding: 15px; background: #1a1a1a; border-bottom: 2px solid #00e676; font-weight: bold; color: #00e676; }
        .list { flex: 1; overflow-y: auto; }
        .user-row { padding: 15px; border-bottom: 1px solid #222; cursor: pointer; display: flex; justify-content: space-between; align-items: center; }
        .user-row:hover { background: #222; }
        .user-row.active { background: #003300; border-left: 4px solid #00e676; }
        .dot { width: 8px; height: 8px; background: #555; border-radius: 50%; }
        .dot.on { background: #00e676; box-shadow: 0 0 5px #00e676; }

        /* MAIN */
        .main { flex: 1; padding: 20px; overflow-y: auto; background: #141414; display: flex; flex-direction: column; }
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; }
        
        .card { background: #1e1e1e; padding: 20px; border: 1px solid #333; border-radius: 5px; }
        .card h3 { margin-top: 0; border-bottom: 1px solid #444; padding-bottom: 10px; color: #aaa; font-size: 14px; }
        
        label { display: block; color: #666; font-size: 11px; margin-top: 10px; }
        input, select { width: 100%; padding: 8px; background: #000; border: 1px solid #444; color: #fff; box-sizing: border-box; }
        
        .pass-view { font-size: 22px; color: #ff3d00; border: 1px dashed #ff3d00; padding: 10px; text-align: center; font-weight: bold; background: #220000; }
        
        .history-box { height: 200px; overflow-y: auto; background: #000; border: 1px solid #333; padding: 5px; font-size: 11px; }
        .log-row { padding: 4px; border-bottom: 1px solid #222; display: flex; justify-content: space-between; }
        .plus { color: #00e676; } .minus { color: #ff3d00; }

        button { width: 100%; padding: 10px; margin-top: 5px; cursor: pointer; border: none; font-weight: bold; border-radius: 3px; }
        .btn-green { background: #00c853; color: #000; }
        .btn-red { background: #d32f2f; color: #fff; }
        .btn-act { background: #333; color: #fff; border: 1px solid #555; }
        .btn-act:hover { background: #555; }
    </style>
</head>
<body>

    <div class="sidebar">
        <div class="head">–ò–ì–†–û–ö–ò (DATABASE)</div>
        <div class="list" id="u-list">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
    </div>

    <div class="main" id="panel" style="opacity:0.2; pointer-events:none">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px">
            <h1 id="u-name" style="margin:0; color:#fff">USER</h1>
            <button class="btn-green" style="width:auto; padding:10px 30px" onclick="saveAll()">–°–û–•–†–ê–ù–ò–¢–¨ –í–°–Å</button>
        </div>

        <div class="grid">
            <div class="card" style="border-top: 2px solid #ff3d00">
                <h3>üîê –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–¨</h3>
                <label>–¢–ï–ö–£–©–ò–ô –ü–ê–†–û–õ–¨</label>
                <div class="pass-view" id="v-pass">---</div>
                <label>–°–ú–ï–ù–ò–¢–¨ –ü–ê–†–û–õ–¨</label>
                <input type="text" id="i-pass" placeholder="–ù–æ–≤—ã–π –ø–∞—Ä–æ–ª—å...">
                <button class="btn-act" onclick="setPass()">–£–°–¢–ê–ù–û–í–ò–¢–¨</button>
                <div style="margin-top:20px; border-top:1px solid #333; padding-top:10px">
                    <button class="btn-red" onclick="wipe()">‚ò†Ô∏è –£–î–ê–õ–ò–¢–¨ –ò–ì–†–û–ö–ê</button>
                </div>
            </div>

            <div class="card" style="border-top: 2px solid #ffd700">
                <h3>üí∞ –§–ò–ù–ê–ù–°–´ (PLN)</h3>
                <label>–ë–ê–õ–ê–ù–°</label>
                <input type="number" id="v-bal" style="font-size:20px; font-weight:bold; color:#ffd700">
                <div style="display:grid; grid-template-columns: 1fr 1fr; gap:5px; margin-top:10px">
                    <button class="btn-act" onclick="bonus(1000)">+1000</button>
                    <button class="btn-act" onclick="bonus(5000)">+5000</button>
                    <button class="btn-act" style="color:red" onclick="bonus(-500)">-500</button>
                    <button class="btn-act" style="color:red" onclick="bonus(-1000)">-1000</button>
                </div>
            </div>

            <div class="card" style="border-top: 2px solid #00e676">
                <h3>üéÆ –°–¢–ê–¢–´ –ò –£–°–õ–£–ì–ò</h3>
                <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px">
                    <div><label>–†–ï–ô–¢–ò–ù–ì</label><input type="number" id="v-rate"></div>
                    <div><label>–û–ü–´–¢</label><input type="number" id="v-xp"></div>
                </div>
                <label>–õ–ò–¶–ï–ù–ó–ò–Ø –¢–ê–ö–°–ò</label>
                <select id="v-lic"><option value="false">–ù–ï–¢</option><option value="true">–ï–°–¢–¨</option></select>
                <label>–ú–ê–®–ò–ù–ê</label>
                <select id="v-car"><option value="null">–í–ï–õ–û–°–ò–ü–ï–î</option><option value="cyber_taxi">CYBER TAXI</option></select>
                <label>–î–ï–¢–ê–õ–ò (–ß–∏–ø/–î–≤–∏–≥/–°–ø–ª–∞–≤)</label>
                <div style="display:flex; gap:5px">
                    <input type="number" id="p1"><input type="number" id="p2"><input type="number" id="p3">
                </div>
            </div>

            <div class="card" style="grid-column: 1 / -1">
                <h3>üìú –ò–°–¢–û–†–ò–Ø –î–ï–ô–°–¢–í–ò–ô (LOGS)</h3>
                <div class="history-box" id="h-box"></div>
            </div>
        </div>
    </div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyChrQMyO2soPgoEHq_f3aYs5Cs19q3sWEk",
        authDomain: "warszawa-courier.firebaseapp.com",
        databaseURL: "https://warszawa-courier-default-rtdb.europe-west1.firebasedatabase.app",
        projectId: "warszawa-courier",
        storageBucket: "warszawa-courier.firebasestorage.app",
        messagingSenderId: "295860613508",
        appId: "1:295860613508:web:86fe8364377d6875612dd1",
        measurementId: "G-TGSCHBVLX2"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    let users = {};
    let cur = null;

    // 1. –°–ü–ò–°–û–ö –ò–ì–†–û–ö–û–í
    db.ref('users').on('value', snap => {
        users = snap.val() || {};
        const list = document.getElementById('u-list');
        list.innerHTML = '';
        const now = Date.now();

        Object.keys(users).forEach(id => {
            const u = users[id];
            const online = (now - (u._last_seen || 0)) < 15000;
            const div = document.createElement('div');
            div.className = `user-row ${id===cur?'active':''}`;
            div.onclick = () => selectUser(id);
            div.innerHTML = `
                <div><b>${id}</b><div style="font-size:10px; color:#888">${Math.floor(u.balance)} PLN</div></div>
                <div class="dot ${online?'on':''}"></div>
            `;
            list.appendChild(div);
        });
        
        if(cur && users[cur]) updateForm(users[cur]);
    });

    // 2. –í–´–ë–û–† –ò–ì–†–û–ö–ê
    function selectUser(id) {
        cur = id;
        document.getElementById('panel').style.opacity = '1';
        document.getElementById('panel').style.pointerEvents = 'all';
        document.getElementById('u-name').innerText = id;
        
        // –ò—Å—Ç–æ—Ä–∏—è
        db.ref('history/'+id).limitToLast(50).on('value', snap => {
            const box = document.getElementById('h-box');
            box.innerHTML = '';
            const data = snap.val();
            if(data) {
                Object.values(data).reverse().forEach(log => {
                    const cls = log.amount >= 0 ? 'plus' : 'minus';
                    const sign = log.amount > 0 ? '+' : '';
                    box.innerHTML += `
                        <div class="log-row">
                            <span>${new Date(log.time).toLocaleTimeString()} - ${log.reason}</span>
                            <span class="${cls}">${sign}${log.amount}</span>
                        </div>`;
                });
            } else box.innerHTML = '<div style="padding:10px; color:#666">–ù–µ—Ç –∑–∞–ø–∏—Å–µ–π</div>';
        });

        updateForm(users[id]);
    }

    function updateForm(u) {
        document.getElementById('v-pass').innerText = u.password;
        document.getElementById('v-bal').value = u.balance;
        document.getElementById('v-rate').value = u.stats?.rating || 0;
        document.getElementById('v-xp').value = u.stats?.total_deliveries || 0;
        document.getElementById('v-lic').value = (u.taxi?.license||false).toString();
        document.getElementById('v-car').value = u.taxi?.vehicle || "null";
        
        document.getElementById('p1').value = u.inventory?.part_chip || 0;
        document.getElementById('p2').value = u.inventory?.part_engine || 0;
        document.getElementById('p3').value = u.inventory?.part_alloy || 0;
    }

    // 3. –î–ï–ô–°–¢–í–ò–Ø
    function saveAll() {
        if(!cur) return;
        const u = users[cur];
        const updates = {
            balance: parseFloat(document.getElementById('v-bal').value),
            'stats/rating': parseFloat(document.getElementById('v-rate').value),
            'stats/total_deliveries': parseInt(document.getElementById('v-xp').value),
            'taxi/license': (document.getElementById('v-lic').value === 'true'),
            'taxi/vehicle': document.getElementById('v-car').value === 'null' ? null : 'cyber_taxi',
            'inventory/part_chip': parseInt(document.getElementById('p1').value),
            'inventory/part_engine': parseInt(document.getElementById('p2').value),
            'inventory/part_alloy': parseInt(document.getElementById('p3').value)
        };
        db.ref('users/'+cur).update(updates);
        alert('–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ!');
    }

    function bonus(amt) {
        if(!cur) return;
        const bal = parseFloat(document.getElementById('v-bal').value);
        const newBal = bal + amt;
        
        db.ref('users/'+cur).update({balance: newBal});
        db.ref('history/'+cur).push({
            amount: amt, 
            reason: amt > 0 ? "–ë–æ–Ω—É—Å –æ—Ç –ê–¥–º–∏–Ω–∞" : "–®—Ç—Ä–∞—Ñ –æ—Ç –ê–¥–º–∏–Ω–∞", 
            time: Date.now()
        });
    }

    function setPass() {
        const p = document.getElementById('i-pass').value;
        if(p) {
            db.ref('users/'+cur).update({password: p});
            document.getElementById('i-pass').value = '';
            alert('–ü–∞—Ä–æ–ª—å –∏–∑–º–µ–Ω–µ–Ω');
        }
    }

    function wipe() {
        if(confirm('–£–¥–∞–ª–∏—Ç—å –∏–≥—Ä–æ–∫–∞ –Ω–∞–≤—Å–µ–≥–¥–∞?')) {
            db.ref('users/'+cur).remove();
            db.ref('history/'+cur).remove();
            document.getElementById('panel').style.opacity = '0.2';
            document.getElementById('panel').style.pointerEvents = 'none';
            cur = null;
        }
    }
</script>
</body>
</html>
