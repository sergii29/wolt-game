<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WOLT GOD MODE | Admin Dashboard</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

    <style>
        :root {
            --bg: #121212;
            --panel: #1e1e1e;
            --border: #333;
            --text: #e0e0e0;
            --accent: #00e676;
            --danger: #ff3d00;
            --info: #2979ff;
            --warn: #ffea00;
        }

        body { margin: 0; padding: 0; font-family: 'Segoe UI', sans-serif; background: var(--bg); color: var(--text); height: 100vh; display: flex; overflow: hidden; }
        
        /* SIDEBAR (LIST) */
        .sidebar { width: 350px; background: var(--panel); border-right: 1px solid var(--border); display: flex; flex-direction: column; }
        .sidebar-header { padding: 20px; border-bottom: 1px solid var(--border); font-size: 18px; font-weight: bold; color: var(--accent); display: flex; align-items: center; gap: 10px; }
        .search-box { padding: 10px; border-bottom: 1px solid var(--border); }
        .search-box input { width: 95%; background: #333; border: none; padding: 8px; color: white; border-radius: 4px; }
        .player-list { flex: 1; overflow-y: auto; }
        .player-item { padding: 15px; border-bottom: 1px solid #333; cursor: pointer; display: flex; justify-content: space-between; align-items: center; transition: 0.2s; }
        .player-item:hover { background: #2a2a2a; }
        .player-item.active { background: rgba(0, 230, 118, 0.1); border-left: 3px solid var(--accent); }
        .status-dot { width: 8px; height: 8px; border-radius: 50%; background: #555; }
        .status-dot.online { background: var(--accent); box-shadow: 0 0 5px var(--accent); }

        /* MAIN CONTENT */
        .main { flex: 1; padding: 30px; overflow-y: auto; background: var(--bg); }
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; }
        .nav-btn { background: #333; border: none; color: #aaa; padding: 10px 20px; border-radius: 8px; cursor: pointer; font-weight: bold; margin-right: 10px; }
        .nav-btn.active { background: var(--accent); color: black; }
        
        /* CARDS */
        .card-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 20px; }
        .card { background: var(--panel); border: 1px solid var(--border); border-radius: 12px; padding: 20px; position: relative; }
        .card h3 { margin-top: 0; color: #888; font-size: 14px; text-transform: uppercase; letter-spacing: 1px; }
        .stat-value { font-size: 24px; font-weight: bold; margin: 10px 0; }
        .controls { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 15px; }
        .btn-item { padding: 10px; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; transition: 0.2s; color: white; }
        .btn-item:hover { opacity: 0.8; }
        
        /* LOGS */
        .log-entry { font-family: monospace; padding: 8px; border-bottom: 1px solid #333; display: flex; gap: 15px; font-size: 13px; }
        .log-time { color: #777; }
        .log-user { color: var(--accent); font-weight: bold; }
        
        /* INPUT GROUPS */
        .input-group { margin-bottom: 15px; }
        .input-group label { display: block; color: #888; margin-bottom: 5px; font-size: 12px; }
        .input-group input { width: 100%; background: #252525; border: 1px solid #444; color: white; padding: 8px; border-radius: 4px; }
    </style>
</head>
<body>

<div class="sidebar">
    <div class="sidebar-header"><i class="fas fa-shield-alt"></i> ADMIN PANEL</div>
    <div class="search-box">
        <input type="text" id="search" placeholder="–ü–æ–∏—Å–∫ –∏–≥—Ä–æ–∫–∞..." oninput="filterPlayers()">
    </div>
    <div class="player-list" id="player-list">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
</div>

<div class="main">
    <div class="header">
        <h2>Dashboard</h2>
        <div>
            <button class="nav-btn active" onclick="showView('players', this)">–ò–≥—Ä–æ–∫–∏</button>
            <button class="nav-btn" onclick="showView('config', this)">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</button>
            <button class="nav-btn" onclick="showView('logs', this)">–õ–æ–≥–∏</button>
        </div>
    </div>

    <div id="players-view">
        <div id="player-details" style="display:none;">
            </div>
        <div id="no-selection" style="text-align:center; color:#555; margin-top:100px;">
            <i class="fas fa-user-circle" style="font-size: 64px; margin-bottom:20px;"></i><br>
            –í—ã–±–µ—Ä–∏—Ç–µ –∏–≥—Ä–æ–∫–∞ —Å–ª–µ–≤–∞
        </div>
    </div>

    <div id="config-view" style="display:none;">
        <div class="card" style="max-width: 600px;">
            <h3>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –≠–∫–æ–Ω–æ–º–∏–∫–∏</h3>
            <div id="config-form">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
            <button class="btn-item" style="background:var(--accent); color:black; width:100%; margin-top:20px;" onclick="saveConfig()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</button>
        </div>
    </div>

    <div id="logs-view" style="display:none;">
        <div class="card">
            <h3>–°–∏—Å—Ç–µ–º–Ω—ã–µ –ª–æ–≥–∏</h3>
            <div id="logs-container" style="height: 500px; overflow-y:auto;"></div>
            <button class="btn-item" style="background:#333; width:100%; margin-top:10px;" onclick="loadLogs()">–û–±–Ω–æ–≤–∏—Ç—å</button>
        </div>
    </div>
</div>

<script>
    // 1. CONFIGURATION
    const firebaseConfig = {
      apiKey: "AIzaSyChrQMyO2soPgoEHq_f3aYs5Cs19q3sWEk",
      authDomain: "warszawa-courier.firebaseapp.com",
      databaseURL: "https://warszawa-courier-default-rtdb.europe-west1.firebasedatabase.app",
      projectId: "warszawa-courier",
      storageBucket: "warszawa-courier.firebasestorage.app",
      messagingSenderId: "295860613508",
      appId: "1:295860613508:web:86fe8364377d6875612dd1",
      measurementId: "G-TGSCHBVLX2"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    
    let playersData = {};
    let selectedId = null;

    // 2. INIT
    db.ref('users').on('value', snapshot => {
        playersData = snapshot.val() || {};
        renderList();
        if(selectedId && playersData[selectedId]) {
            renderPlayerDetails(playersData[selectedId], selectedId);
        }
    });

    // 3. RENDER LIST
    function renderList() {
        const filter = document.getElementById('search').value.toLowerCase();
        const container = document.getElementById('player-list');
        container.innerHTML = '';

        Object.entries(playersData).forEach(([id, user]) => {
            const name = user.firstName || 'User ' + id.substr(0,4);
            if(name.toLowerCase().includes(filter) || id.includes(filter)) {
                const div = document.createElement('div');
                div.className = `player-item ${id === selectedId ? 'active' : ''}`;
                div.innerHTML = `
                    <div>
                        <div style="font-weight:bold;">${name}</div>
                        <div style="font-size:11px; color:#666;">ID: ${id}</div>
                    </div>
                    <div class="status-dot ${user.isOnline ? 'online' : ''}"></div>
                `;
                div.onclick = () => selectPlayer(id);
                container.appendChild(div);
            }
        });
    }

    function selectPlayer(id) {
        selectedId = id;
        renderList();
        document.getElementById('no-selection').style.display = 'none';
        document.getElementById('player-details').style.display = 'block';
        renderPlayerDetails(playersData[id], id);
    }

    // 4. RENDER PLAYER DETAILS
    function renderPlayerDetails(data, id) {
        const inv = data.inventory || {};
        let invHtml = '';
        Object.entries(inv).forEach(([k,v]) => {
            if(v > 0) invHtml += `<span style="background:#333; padding:4px 8px; border-radius:4px; font-size:12px; margin:2px;">${k}: ${v}</span>`;
        });

        const taxi = data.taxi || {};
        const isBanned = data.isBanned ? '–î–∞' : '–ù–µ—Ç';

        document.getElementById('player-details').innerHTML = `
            <div class="card-grid">
                <div class="card">
                    <h3>–û—Å–Ω–æ–≤–Ω–æ–µ</h3>
                    <div class="stat-value">${data.firstName || '–ë–µ–∑ –∏–º–µ–Ω–∏'}</div>
                    <div>–ë–∞–ª–∞–Ω—Å: <span style="color:#00e676">${(data.balance||0).toFixed(2)} PLN</span></div>
                    <div>–î–æ—Å—Ç–∞–≤–∫–∏: ${(data.totalDeliveries||0)}</div>
                    <div>–ë–∞–Ω: <span style="color:${data.isBanned?'red':'green'}">${isBanned}</span></div>
                    <div style="margin-top:10px; color:#888; font-size:12px;">TG ID: ${id}</div>
                </div>

                <div class="card" style="border-color: #ff9100;">
                    <h3 style="color:#ff9100">–¢–∞–∫—Å–∏ –°—Ç–∞—Ç—É—Å</h3>
                    <div>–ê–≤—Ç–æ —Å–æ–±—Ä–∞–Ω–æ: <b>${taxi.isCarAssembled ? '–î–ê' : '–ù–ï–¢'}</b></div>
                    <div>–ó–¥–æ—Ä–æ–≤—å–µ: <b>${taxi.health || 0}%</b></div>
                    <div>–¢–æ–ø–ª–∏–≤–æ: <b>${taxi.fuel || 0}%</b></div>
                    <div>–õ–∏—Ü–µ–Ω–∑–∏—è: ${taxi.licenses ? '–ï—Å—Ç—å' : '–ù–µ—Ç'}</div>
                </div>

                <div class="card">
                    <h3>–î–µ–π—Å—Ç–≤–∏—è</h3>
                    <div class="controls">
                        <button class="btn-item" style="background:#ff3d00" onclick="toggleBan('${id}', ${!data.isBanned})">
                            ${data.isBanned ? '–†–∞–∑–±–∞–Ω–∏—Ç—å' : '–ó–ê–ë–ê–ù–ò–¢–¨'}
                        </button>
                        <button class="btn-item" style="background:#2979ff" onclick="addMoney('${id}')">
                            +1000 PLN
                        </button>
                    </div>
                </div>

                <div class="card" style="border-color: #d500f9;">
                    <h3 style="color:#d500f9">üîß –ì–∞—Ä–∞–∂ Cyber X</h3>
                    <div class="controls">
                        <button class="btn-item" style="background:#00e676; color:black" onclick="adminGiveParts()">
                            üéÅ –í—ã–¥–∞—Ç—å –§—É–ª–ª –ö–æ–º–ø–ª–µ–∫—Ç
                        </button>
                        <button class="btn-item" style="background:#ff3d00" onclick="adminResetParts()">
                            üóë –°–±—Ä–æ—Å–∏—Ç—å –º–∞—à–∏–Ω—É
                        </button>
                    </div>
                    <div style="margin-top:5px; font-size:11px; color:#777;">–í–∫–ª—é—á–∞–µ—Ç: –î–µ—Ç–∞–ª–∏, 55 –∑–∞–∫–∞–∑–æ–≤, –±–µ–Ω–∑–∏–Ω</div>
                </div>

                <div class="card" style="grid-column: span 2;">
                    <h3>–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å</h3>
                    <div style="display:flex; flex-wrap:wrap; gap:5px;">${invHtml || '–ü—É—Å—Ç–æ'}</div>
                </div>
            </div>
        `;
    }

    // 5. ACTIONS LOGIC
    function toggleBan(uid, status) {
        if(confirm(status ? '–ó–∞–±–∞–Ω–∏—Ç—å –∏–≥—Ä–æ–∫–∞?' : '–†–∞–∑–±–∞–Ω–∏—Ç—å –∏–≥—Ä–æ–∫–∞?')) {
            db.ref('users/' + uid).update({ isBanned: status });
        }
    }

    function addMoney(uid) {
        const amount = prompt('–°–∫–æ–ª—å–∫–æ –¥–æ–±–∞–≤–∏—Ç—å?', '1000');
        if(amount) {
            db.ref('users/' + uid + '/balance').transaction(val => (val||0) + parseFloat(amount));
        }
    }

    // === NEW FUNCTIONS FOR GARAGE ===
    function adminGiveParts() {
        if (!selectedId) return alert('–í—ã–±–µ—Ä–∏—Ç–µ –∏–≥—Ä–æ–∫–∞!');
        if (!confirm('–í—ã–¥–∞—Ç—å –ø–æ–ª–Ω—ã–π –∫–æ–º–ø–ª–µ–∫—Ç –¥–ª—è Cyber X, –±–µ–Ω–∑–∏–Ω –∏ 55 –∑–∞–∫–∞–∑–æ–≤?')) return;

        db.ref('users/' + selectedId).update({
            // –í—ã–¥–∞–µ–º –¥–µ—Ç–∞–ª–∏
            'inventory/part_engine': 1,
            'inventory/part_chip': 1,
            'inventory/part_alloy': 1,
            'inventory/part_tire': 4,
            'inventory/part_battery': 5,
            'inventory/fuel_canister': 10,
            
            // –û–ø—ã—Ç –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è –ª—É—Ç–∞
            'totalDeliveries': 55,
            
            // –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ —Å–±–æ—Ä–∫–µ
            'taxi/isCarAssembled': false, // –°—Ç–∞–≤–∏–º false, —á—Ç–æ–±—ã –∫–Ω–æ–ø–∫–∞ "–°–æ–±—Ä–∞—Ç—å" —Å—Ç–∞–ª–∞ –∞–∫—Ç–∏–≤–Ω–æ–π
            'taxi/fuel': 100,
            'taxi/health': 100
        }).then(() => {
            alert('‚úÖ –£—Å–ø–µ—à–Ω–æ! –°–∫–∞–∂–∏ –∏–≥—Ä–æ–∫—É –ø–µ—Ä–µ–∑–∞–π—Ç–∏ –≤ –ì–∞—Ä–∞–∂.');
        }).catch(e => alert('–û—à–∏–±–∫–∞: ' + e.message));
    }

    function adminResetParts() {
        if (!selectedId) return alert('–í—ã–±–µ—Ä–∏—Ç–µ –∏–≥—Ä–æ–∫–∞!');
        if (!confirm('–°–±—Ä–æ—Å–∏—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å –º–∞—à–∏–Ω—ã?')) return;

        db.ref('users/' + selectedId).update({
            'inventory/part_engine': 0,
            'inventory/part_chip': 0,
            'inventory/part_alloy': 0,
            'inventory/part_tire': 0,
            'taxi/isCarAssembled': false,
            'taxi/active': false
        }).then(() => {
            alert('‚úÖ –ü—Ä–æ–≥—Ä–µ—Å—Å —Å–±—Ä–æ—à–µ–Ω.');
        });
    }

    // 6. UI HELPERS
    function filterPlayers() { renderList(); }
    
    function showView(viewId, btn) {
        document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
        if(btn) btn.classList.add('active');
        
        document.getElementById('players-view').style.display = 'none';
        document.getElementById('config-view').style.display = 'none';
        document.getElementById('logs-view').style.display = 'none';
        
        document.getElementById(viewId + '-view').style.display = 'block';

        if(viewId === 'config') loadConfig();
        if(viewId === 'logs') loadLogs();
    }

    // 7. CONFIG & LOGS
    function loadConfig() {
        db.ref('config').once('value', snap => {
            const cfg = snap.val() || {};
            let html = '';
            // –ü—Ä–æ—Å—Ç–µ–π—à–∏–π —Ä–µ–Ω–¥–µ—Ä –∫–æ–Ω—Ñ–∏–≥–∞
            const keys = ['basePickupPay','perKmPay','inflationRate','deliveryTime','trafficDuration','tipChance','energyDrain','waterDrain'];
            
            keys.forEach(k => {
                const val = cfg[k] !== undefined ? cfg[k] : 0;
                html += `<div class="input-group"><label>${k}</label><input type="text" id="cfg-${k}" value="${val}"></div>`;
            });
            document.getElementById('config-form').innerHTML = html;
        });
    }

    function saveConfig() {
        const newPrices = {
            // –ó–∞–≥–ª—É—à–∫–∞, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ –ø—Ä–∞–≤–∏—Ç—å —Ü–µ–Ω—ã –ø—Ä–µ–¥–º–µ—Ç–æ–≤, —ç—Ç–æ –Ω—É–∂–Ω–æ —Ä–∞—Å—à–∏—Ä—è—Ç—å
        };
        
        const cfg = {
            basePickupPay: parseFloat(document.getElementById('cfg-basePickupPay').value),
            perKmPay: parseFloat(document.getElementById('cfg-perKmPay').value),
            inflationRate: parseFloat(document.getElementById('cfg-inflationRate').value),
            deliveryTime: parseInt(document.getElementById('cfg-deliveryTime').value),
            trafficDuration: parseInt(document.getElementById('cfg-trafficDuration').value),
            tipChance: parseFloat(document.getElementById('cfg-tipChance').value),
            energyDrain: parseFloat(document.getElementById('cfg-energyDrain').value),
            waterDrain: parseFloat(document.getElementById('cfg-waterDrain').value),
        };
        
        db.ref('config').update(cfg).then(()=>alert('–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ'));
    }

    // === LOGS ===
    function loadLogs() {
        db.ref('logs').limitToLast(50).once('value', snap => {
            const d = snap.val();
            let html = '';
            if(d) {
                Object.values(d).sort((a,b)=>b.timestamp-a.timestamp).forEach(l => {
                    html += `<div class="log-entry"><div class="log-time">${new Date(l.timestamp).toLocaleTimeString()}</div><div class="log-user">${l.playerName}</div><div class="log-msg">${l.message}</div></div>`;
                });
            }
            document.getElementById('logs-container').innerHTML = html || '–ù–µ—Ç –ª–æ–≥–æ–≤';
        });
    }

    showView('players', document.querySelector('.nav-btn'));

</script>

</body>
</html>
