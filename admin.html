<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>–ê–¥–º–∏–Ω–∫–∞ ‚Ä¢ GOD MODE (Warsaw Courier)</title>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
<script src="database.js"></script>

<style>
body{background:#0b0e13;color:#e8ecf1;font-family:Arial;padding:12px}
.section{background:#141922;border-radius:14px;padding:14px;margin-bottom:16px}
h2{margin:0 0 10px}
label{font-size:13px;color:#9aa4b2}
input,select,button{width:100%;padding:10px;margin:6px 0;background:#0f1420;color:#fff;border-radius:10px;border:none}
button{background:#2a7cff;font-weight:bold}
.row{display:flex;gap:10px}
.row>div{flex:1}
.online{color:#3ddc84}
.offline{color:#ff5c5c}
pre{background:#0f1420;padding:10px;border-radius:10px;max-height:200px;overflow:auto}
</style>
</head>

<body>

<!-- –ò–ì–†–û–ö–ò -->
<div class="section">
<h2>üë§ –ò–≥—Ä–æ–∫–∏</h2>
<select id="playerSelect"></select>
<div id="playerStatus"></div>

<label>–ë–∞–ª–∞–Ω—Å</label>
<input id="pBalance" type="number">

<label>–≠–Ω–µ—Ä–≥–∏—è</label>
<input id="pEnergy" type="number">

<label>–ù–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ</label>
<input id="pMood" type="number">

<button onclick="savePlayer()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–≥—Ä–æ–∫–∞</button>
</div>

<!-- –ò–ù–í–ï–ù–¢–ê–†–¨ -->
<div class="section">
<h2>üéí –ò–Ω–≤–µ–Ω—Ç–∞—Ä—å –∏–≥—Ä–æ–∫–∞</h2>

<select id="invItem"></select>
<input id="invQty" type="number" placeholder="–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ">

<button onclick="addItem()">‚ûï –î–æ–±–∞–≤–∏—Ç—å</button>
<button onclick="removeItem()">‚ûñ –£–±—Ä–∞—Ç—å</button>

<pre id="invView"></pre>
</div>

<!-- –≠–ö–û–ù–û–ú–ò–ö–ê / CONFIG -->
<div class="section">
<h2>üåç –≠–∫–æ–Ω–æ–º–∏–∫–∞ (—Ä–µ–∞–ª—å–Ω–∞—è)</h2>

<label>–ë–∞–∑–æ–≤–∞—è –æ–ø–ª–∞—Ç–∞ –¥–æ—Å—Ç–∞–≤–∫–∏</label>
<input id="basePickupPay" type="number" step="0.1">

<label>–û–ø–ª–∞—Ç–∞ –∑–∞ –∫–º</label>
<input id="perKmPay" type="number" step="0.1">

<label>–ò–Ω—Ñ–ª—è—Ü–∏–æ–Ω–Ω—ã–π –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç</label>
<input id="inflationRate" type="number" step="0.01">

<button onclick="saveConfig()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å —ç–∫–æ–Ω–æ–º–∏–∫—É</button>
</div>

<!-- –¶–ï–ù–´ –¢–û–í–ê–†–û–í -->
<div class="section">
<h2>üõí –ú–∞–≥–∞–∑–∏–Ω (—Ä–µ–∞–ª—å–Ω—ã–µ —Ü–µ–Ω—ã)</h2>

<select id="itemKey"></select>
<input id="itemPrice" type="number" step="0.1">

<button onclick="saveItemPrice()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ü–µ–Ω—É</button>
</div>

<script>
let currentPlayer=null;
let currentItem=null;

/* === –ò–ì–†–û–ö–ò === */
db.ref("players").on("value",s=>{
  playerSelect.innerHTML="";
  s.forEach(p=>{
    const o=document.createElement("option");
    o.value=p.key;o.textContent=p.key;
    playerSelect.appendChild(o);
  });
  if(playerSelect.value) loadPlayer();
});
playerSelect.onchange=loadPlayer;

function loadPlayer(){
  currentPlayer=playerSelect.value;
  db.ref("players/"+currentPlayer).once("value").then(s=>{
    const d=s.val()||{};
    pBalance.value=d.balance||0;
    pEnergy.value=d.stats?.energy ?? d.energy ?? 0;
    pMood.value=d.stats?.mood ?? d.mood ?? 0;
    playerStatus.innerHTML=d.online
      ? "<span class='online'>–æ–Ω–ª–∞–π–Ω</span>"
      : "<span class='offline'>–æ—Ñ—Ñ–ª–∞–π–Ω</span>";
    loadInventory();
  });
}
function savePlayer(){
  db.ref("players/"+currentPlayer).update({
    balance:+pBalance.value,
    "stats/energy":+pEnergy.value,
    "stats/mood":+pMood.value
  });
}

/* === –ò–ù–í–ï–ù–¢–ê–†–¨ === */
function loadInventory(){
  db.ref("players/"+currentPlayer+"/inventory").on("value",s=>{
    invView.textContent=JSON.stringify(s.val(),null,2);
  });
}
function addItem(){
  db.ref("players/"+currentPlayer+"/inventory/"+invItem.value)
    .transaction(q=>(q||0)+(+invQty.value));
}
function removeItem(){
  db.ref("players/"+currentPlayer+"/inventory/"+invItem.value)
    .transaction(q=>Math.max(0,(q||0)-(+invQty.value)));
}

/* === CONFIG === */
db.ref("config").on("value",s=>{
  const c=s.val()||{};
  basePickupPay.value=c.basePickupPay ?? 4;
  perKmPay.value=c.perKmPay ?? 1.5;
  inflationRate.value=c.inflationRate ?? 0.1;

  if(c.itemPrices){
    itemKey.innerHTML="";
    Object.keys(c.itemPrices).forEach(k=>{
      const o=document.createElement("option");
      o.value=k;o.textContent=k;
      itemKey.appendChild(o);
    });
    currentItem=itemKey.value;
    itemPrice.value=c.itemPrices[currentItem];
  }
});

itemKey.onchange=()=>{
  currentItem=itemKey.value;
  db.ref("config/itemPrices/"+currentItem).once("value")
    .then(s=>itemPrice.value=s.val());
};

function saveConfig(){
  db.ref("config").update({
    basePickupPay:+basePickupPay.value,
    perKmPay:+perKmPay.value,
    inflationRate:+inflationRate.value
  });
}

function saveItemPrice(){
  db.ref("config/itemPrices/"+currentItem).set(+itemPrice.value);
}
</script>

</body>
</html>
