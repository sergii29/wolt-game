<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wolt Admin üõ°Ô∏è</title>
    <link rel="stylesheet" href="style.css">
    <style>
        .admin-header { display: flex; justify-content: space-between; align-items: center; }
        .online-dot { height: 10px; width: 10px; background-color: #bbb; border-radius: 50%; display: inline-block; margin-right: 5px; }
        .online-dot.active { background-color: #00e676; box-shadow: 0 0 5px #00e676; }
    </style>
</head>
<body class="admin-body">

    <div class="admin-header admin-section">
        <h1>üõ°Ô∏è –¶–µ–Ω—Ç—Ä –£–ø—Ä–∞–≤–ª–µ–Ω–∏—è</h1>
        <div>–û–Ω–ª–∞–π–Ω: <span id="online-count" style="font-weight:bold; color:var(--wolt-blue)">0</span></div>
    </div>

    <div class="admin-section">
        <h3>üåç –ì–ª–æ–±–∞–ª—å–Ω–∞—è –≠–∫–æ–Ω–æ–º–∏–∫–∞</h3>
        <div class="stat-row">
            <span>–ë–∞–∑–æ–≤–∞—è –æ–ø–ª–∞—Ç–∞ (PLN)</span>
            <input type="number" id="conf-pay" class="stat-input" value="12">
        </div>
        <div class="stat-row">
            <span>–ò–Ω—Ñ–ª—è—Ü–∏—è (–∫–æ—ç—Ñ—Ñ 0.05 = 5%)</span>
            <input type="number" id="conf-inf" class="stat-input" value="0.05" step="0.01">
        </div>
        <div class="stat-row">
            <span>–®—Ç—Ä–∞—Ñ –∑–∞ –æ–ø–æ–∑–¥–∞–Ω–∏–µ (PLN)</span>
            <input type="number" id="conf-fine" class="stat-input" value="5.00">
        </div>
        <div class="stat-row">
            <span>–†–∞—Å—Ö–æ–¥ —ç–Ω–µ—Ä–≥–∏–∏ (–∑–∞ –∫–ª–∏–∫)</span>
            <input type="number" id="conf-energy" class="stat-input" value="0.15" step="0.01">
        </div>
        <button class="shop-btn buy" onclick="saveConfig()" style="width:100%; margin-top:10px">–ü–†–ò–ú–ï–ù–ò–¢–¨ –ö–û –í–°–ï–ú</button>
    </div>

    <div class="admin-section">
        <h3>üë• –ò–≥—Ä–æ–∫–∏</h3>
        <div id="users-list">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <script src="database.js"></script>
    <script>
        const dbRef = firebase.database().ref();

        // –ó–∞–≥—Ä—É–∑–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫
        dbRef.child('config').on('value', snap => {
            const c = snap.val();
            if(c) {
                document.getElementById('conf-pay').value = c.basePay || 12;
                document.getElementById('conf-inf').value = c.inflationRate || 0.05;
                document.getElementById('conf-fine').value = c.penaltyLate || 5;
                document.getElementById('conf-energy').value = c.energyCost || 0.15;
            }
        });

        function saveConfig() {
            dbRef.child('config').update({
                basePay: parseFloat(document.getElementById('conf-pay').value),
                inflationRate: parseFloat(document.getElementById('conf-inf').value),
                penaltyLate: parseFloat(document.getElementById('conf-fine').value),
                energyCost: parseFloat(document.getElementById('conf-energy').value)
            });
            alert('–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω—ã!');
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –∏–≥—Ä–æ–∫–æ–≤
        dbRef.child('users').on('value', snap => {
            const list = document.getElementById('users-list');
            list.innerHTML = '';
            let online = 0;

            snap.forEach(child => {
                const uid = child.key;
                const u = child.val();
                
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–Ω–ª–∞–π–Ω–∞ (–µ—Å–ª–∏ –±—ã–ª –∞–∫—Ç–∏–≤–µ–Ω –º–µ–Ω—å—à–µ 60 —Å–µ–∫ –Ω–∞–∑–∞–¥)
                const isOnline = (Date.now() - u.lastActive) < 60000;
                if(isOnline) online++;

                const div = document.createElement('div');
                div.className = 'user-card ' + (isOnline ? 'online' : '') + (u.isBanned ? ' banned' : '');
                
                div.innerHTML = `
                    <div style="display:flex; justify-content:space-between; align-items:center">
                        <div>
                            <span class="online-dot ${isOnline ? 'active' : ''}"></span>
                            <strong>${u.name || '–ì–æ—Å—Ç—å'}</strong>
                            <small style="color:#999; margin-left:5px">${uid}</small>
                        </div>
                        ${u.isBanned ? '<span style="color:red; font-weight:bold">‚õî –ë–ê–ù</span>' : ''}
                    </div>
                    
                    <div class="action-grid">
                        <div style="font-size:12px; color:#555">
                            üí∞ –ë–∞–ª–∞–Ω—Å: <b>${(u.balance||0).toFixed(2)}</b><br>
                            üè¶ –î–æ–ª–≥: ${(u.debt||0).toFixed(2)}
                        </div>
                        <div style="font-size:12px; color:#555">
                            ‚ö° –≠–Ω–µ—Ä–≥–∏—è: ${Math.floor(u.needs?.energy||0)}%<br>
                            üö≤ –ë–∞–π–∫: ${Math.floor(u.items?.bike||0)}%
                        </div>
                    </div>

                    <div style="margin-top:10px; display:flex; gap:5px; flex-wrap:wrap">
                        <button class="btn-mini btn-blue" onclick="editBalance('${uid}')">üíµ –ò–∑–º–µ–Ω–∏—Ç—å $</button>
                        <button class="btn-mini btn-green" onclick="healUser('${uid}')">üöë –ü–æ–ª–µ—á–∏—Ç—å</button>
                        <button class="btn-mini btn-green" onclick="repairUser('${uid}')">üîß –ü–æ—á–∏–Ω–∏—Ç—å</button>
                        <button class="btn-mini btn-dark" onclick="resetUser('${uid}')">‚ôªÔ∏è –°–±—Ä–æ—Å</button>
                        <button class="btn-mini btn-red" onclick="toggleBan('${uid}', ${!u.isBanned})">${u.isBanned ? '–†–∞–∑–±–∞–Ω–∏—Ç—å' : '‚õî –ë–ê–ù'}</button>
                    </div>
                `;
                list.appendChild(div);
            });
            document.getElementById('online-count').textContent = online;
        });

        // –î–µ–π—Å—Ç–≤–∏—è –ê–¥–º–∏–Ω–∞
        function editBalance(uid) {
            let newBal = prompt("–í–≤–µ–¥–∏—Ç–µ –Ω–æ–≤—ã–π –±–∞–ª–∞–Ω—Å:");
            if(newBal !== null) {
                dbRef.child('users/'+uid).update({ balance: parseFloat(newBal), adminEdit: true });
            }
        }
        function healUser(uid) {
            dbRef.child('users/'+uid+'/needs').set({energy:100, water:100, mood:100});
        }
        function repairUser(uid) {
            dbRef.child('users/'+uid+'/items').set({bike:100, bag:100, phone:100, gear:100});
        }
        function resetUser(uid) {
            if(confirm("–°–±—Ä–æ—Å–∏—Ç—å –∏–≥—Ä–æ–∫–∞ –≤ –Ω–∞—á–∞–ª–æ?")) {
                dbRef.child('users/'+uid).update({ 
                    balance: 0, debt: 0, 
                    items: {bike:100,bag:100,phone:100,gear:100},
                    repairs: {bike:0,bag:0,phone:0,gear:0}
                });
            }
        }
        function toggleBan(uid, status) {
            if(confirm(status ? "–ó–∞–±–∞–Ω–∏—Ç—å?" : "–†–∞–∑–±–∞–Ω–∏—Ç—å?")) {
                dbRef.child('users/'+uid+'/isBanned').set(status);
            }
        }
    </script>
</body>
</html>
