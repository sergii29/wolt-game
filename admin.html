<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wolt Admin Panel</title>
    <link rel="stylesheet" href="style.css">
    <style>
        .admin-body { padding: 20px; color: #333; background: #f0f2f5; overflow-y: auto; height: 100vh; }
        .admin-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .admin-section { background: white; padding: 20px; border-radius: 16px; margin-bottom: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        .stat-row { display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px solid #eee; }
        .stat-input { width: 80px; padding: 5px; text-align: center; border: 1px solid #ddd; border-radius: 5px; }
        .user-card { background: #f8f9fa; padding: 15px; margin-bottom: 10px; border-radius: 10px; border-left: 4px solid #ccc; }
        .user-card.online { border-left-color: var(--accent-green); }
        .btn-mini { padding: 5px 10px; font-size: 12px; cursor: pointer; border: none; border-radius: 4px; color: white; margin-left: 5px; }
        .btn-green { background: var(--accent-green); }
        .btn-red { background: var(--accent-red); }
        .btn-blue { background: var(--wolt-blue); }
    </style>
</head>
<body class="admin-body">

    <div class="admin-header">
        <h1>Wolt Admin üõ°Ô∏è</h1>
        <button class="shop-btn" onclick="location.href='index.html'">–í –ò–ì–†–£</button>
    </div>

    <div class="admin-section">
        <h3>üåç –≠–∫–æ–Ω–æ–º–∏–∫–∞ –í–∞—Ä—à–∞–≤—ã</h3>
        <div class="stat-row">
            <span>–ë–∞–∑–æ–≤–∞—è –æ–ø–ª–∞—Ç–∞ (PLN)</span>
            <input type="number" id="conf-pay" class="stat-input" value="12">
        </div>
        <div class="stat-row">
            <span>–ò–Ω—Ñ–ª—è—Ü–∏—è (–∫–æ—ç—Ñ—Ñ)</span>
            <input type="number" id="conf-inf" class="stat-input" value="0.05" step="0.01">
        </div>
        <div class="stat-row">
            <span>–®—Ç—Ä–∞—Ñ –∑–∞ –æ–ø–æ–∑–¥–∞–Ω–∏–µ (PLN)</span>
            <input type="number" id="conf-fine" class="stat-input" value="5.00">
        </div>
        <button class="shop-btn buy" onclick="saveConfig()" style="width:100%; margin-top:10px">–°–û–•–†–ê–ù–ò–¢–¨ –ù–ê–°–¢–†–û–ô–ö–ò</button>
    </div>

    <div class="admin-section">
        <h3>üë• –ö—É—Ä—å–µ—Ä—ã (<span id="user-count">0</span>)</h3>
        <div id="users-list">Loading...</div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <script src="database.js"></script>
    <script>
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ê–¥–º–∏–Ω–∫–∏
        const dbRef = firebase.database().ref();

        // 1. –ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–Ω—Ñ–∏–≥–∞
        dbRef.child('config').on('value', snap => {
            const conf = snap.val();
            if(conf) {
                document.getElementById('conf-pay').value = conf.basePay || 12;
                document.getElementById('conf-inf').value = conf.inflationRate || 0.05;
                document.getElementById('conf-fine').value = conf.penaltyLate || 5;
            }
        });

        function saveConfig() {
            dbRef.child('config').set({
                basePay: parseFloat(document.getElementById('conf-pay').value),
                inflationRate: parseFloat(document.getElementById('conf-inf').value),
                penaltyLate: parseFloat(document.getElementById('conf-fine').value)
            });
            alert('–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –æ–±–Ω–æ–≤–ª–µ–Ω—ã –¥–ª—è –≤—Å–µ—Ö –∏–≥—Ä–æ–∫–æ–≤!');
        }

        // 2. –°–ø–∏—Å–æ–∫ –∏–≥—Ä–æ–∫–æ–≤
        dbRef.child('users').on('value', snap => {
            const list = document.getElementById('users-list');
            list.innerHTML = '';
            let count = 0;
            
            snap.forEach(child => {
                const uid = child.key;
                const u = child.val();
                count++;
                
                const isOnline = (Date.now() - u.lastActive) < 60000; // Online –µ—Å–ª–∏ –±—ã–ª –∞–∫—Ç–∏–≤–µ–Ω –º–∏–Ω—É—Ç—É –Ω–∞–∑–∞–¥
                
                const div = document.createElement('div');
                div.className = 'user-card ' + (isOnline ? 'online' : '');
                div.innerHTML = `
                    <div style="display:flex; justify-content:space-between">
                        <strong>${u.name || 'Unknown'}</strong>
                        <span style="font-size:12px; color:${isOnline?'green':'gray'}">${isOnline?'‚óè ONLINE':'‚óã Offline'}</span>
                    </div>
                    <div style="font-size:12px; margin:5px 0; color:#666">
                        –ë–∞–ª–∞–Ω—Å: <b>${(u.balance||0).toFixed(2)} PLN</b> | –î–æ–ª–≥: ${(u.debt||0).toFixed(2)}
                    </div>
                    <div style="display:flex; justify-content:flex-end">
                        <button class="btn-mini btn-blue" onclick="giftMoney('${uid}', 100)">+100 PLN</button>
                        <button class="btn-mini btn-green" onclick="repairUser('${uid}')">–ü–æ—á–∏–Ω–∏—Ç—å</button>
                        <button class="btn-mini btn-red" onclick="banUser('${uid}')">–ë–ê–ù</button>
                        <button class="btn-mini btn-red" onclick="resetUser('${uid}')">–°–ë–†–û–°</button>
                    </div>
                `;
                list.appendChild(div);
            });
            document.getElementById('user-count').textContent = count;
        });

        // –§—É–Ω–∫—Ü–∏–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
        function giftMoney(uid, amount) {
            dbRef.child('users/'+uid+'/balance').transaction(bal => (bal||0) + amount);
        }
        function repairUser(uid) {
            dbRef.child('users/'+uid+'/items').set({bike:100, bag:100, phone:100, gear:100});
            dbRef.child('users/'+uid+'/needs').set({energy:100, water:100, mood:100});
        }
        function banUser(uid) {
            if(confirm('–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –∏–≥—Ä–æ–∫–∞?')) dbRef.child('users/'+uid+'/isBanned').set(true);
        }
        function resetUser(uid) {
            if(confirm('–û–±–Ω—É–ª–∏—Ç—å –∏–≥—Ä–æ–∫–∞?')) {
                dbRef.child('users/'+uid).update({ balance: 0, debt: 0, repairs: {bike:0,bag:0,phone:0,gear:0} });
            }
        }
    </script>
</body>
</html>
