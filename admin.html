<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wolt Control v3</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body { background: #121212; color: white; font-family: 'Segoe UI', sans-serif; padding: 20px; overflow-y: scroll; }
        
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; border-bottom: 2px solid #333; padding-bottom: 10px; }
        .header h1 { margin: 0; color: #009de0; }

        .dashboard { display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 20px; }

        /* –ö–ê–†–¢–û–ß–ö–ò */
        .panel { background: #1e1e1e; border-radius: 16px; padding: 20px; box-shadow: 0 5px 20px rgba(0,0,0,0.3); border: 1px solid #333; }
        .panel h2 { margin-top: 0; border-bottom: 1px solid #444; padding-bottom: 10px; font-size: 18px; color: #ccc; }

        .setting-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; background: #252525; padding: 10px; border-radius: 8px; }
        .setting-label { font-weight: bold; font-size: 14px; }
        .setting-input { background: #111; border: 1px solid #444; color: #009de0; padding: 8px; border-radius: 6px; width: 80px; text-align: center; font-weight: 800; font-size: 16px; }

        /* –°–ü–ò–°–û–ö –ò–ì–†–û–ö–û–í */
        .user-list { max-height: 500px; overflow-y: auto; }
        .user-card { background: #252525; padding: 15px; margin-bottom: 10px; border-radius: 12px; cursor: pointer; border-left: 5px solid #555; transition: 0.2s; display: flex; justify-content: space-between; align-items: center; }
        .user-card:hover { background: #333; transform: translateX(5px); }
        .user-card.online { border-left-color: #00e676; box-shadow: 0 0 10px rgba(0,230,118,0.1); }
        .user-card.banned { border-left-color: #ff3d00; opacity: 0.5; }

        /* –ú–û–î–ê–õ–ö–ê –£–ü–†–ê–í–õ–ï–ù–ò–Ø –ò–ì–†–û–ö–û–ú */
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85); z-index: 999; display: none; backdrop-filter: blur(5px); }
        .control-modal { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: #1e1e1e; width: 90%; max-width: 450px; border-radius: 20px; padding: 25px; z-index: 1000; display: none; border: 1px solid #444; box-shadow: 0 20px 50px rgba(0,0,0,0.8); }
        
        .big-stat { font-size: 32px; font-weight: 900; color: #009de0; text-align: center; margin: 10px 0; }
        
        .btn-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 20px; }
        .big-btn { border: none; padding: 15px; border-radius: 10px; font-weight: bold; cursor: pointer; color: white; display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 5px; font-size: 12px; }
        .big-btn i { font-size: 20px; margin-bottom: 5px; }
        
        .btn-money { background: #009de0; }
        .btn-fix { background: #00e676; color: #004d40; }
        .btn-ban { background: #d32f2f; }
        .btn-reset { background: #424242; }
        .btn-debt { background: #ff9100; color: black; }
        .shop-btn { padding: 15px; background: #009de0; border: none; width: 100%; color: white; font-weight: bold; border-radius: 8px; cursor: pointer; }

        .close-btn { position: absolute; top: 15px; right: 15px; font-size: 24px; cursor: pointer; color: #666; }
        .history-list { max-height: 100px; overflow-y: auto; background: #111; padding: 10px; border-radius: 8px; font-size: 12px; margin-top: 10px; }
        .h-item { display: flex; justify-content: space-between; border-bottom: 1px solid #333; padding: 5px 0; }
    </style>
</head>
<body>

    <div class="header">
        <h1>üõ†Ô∏è Wolt Admin</h1>
        <div>–û–Ω–ª–∞–π–Ω: <span id="online-counter" style="color:#00e676; font-weight:bold">0</span></div>
    </div>

    <div class="dashboard">
        
        <div class="panel">
            <h2>üåç –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ò–≥—Ä–æ–π</h2>
            
            <div class="setting-row">
                <span class="setting-label">üí∞ –ë–∞–∑–æ–≤–∞—è –ó–∞—Ä–ø–ª–∞—Ç–∞</span>
                <input type="number" id="c-pay" class="setting-input">
            </div>
            
            <div class="setting-row">
                <span class="setting-label">üìâ –ò–Ω—Ñ–ª—è—Ü–∏—è (0.05 = 5%)</span>
                <input type="number" id="c-inf" class="setting-input" step="0.01">
            </div>

            <div class="setting-row">
                <span class="setting-label">üõí –¶–µ–Ω—ã –ú–∞–≥–∞–∑–∏–Ω–∞ (x)</span>
                <input type="number" id="c-shop" class="setting-input" step="0.1" value="1.0">
            </div>

            <div class="setting-row">
                <span class="setting-label">üîß –¶–µ–Ω—ã –†–µ–º–æ–Ω—Ç–∞ (x)</span>
                <input type="number" id="c-repair" class="setting-input" step="0.1" value="1.0">
            </div>

            <div class="setting-row">
                <span class="setting-label">üê¢ –°–∫–æ—Ä–æ—Å—Ç—å (–º–µ–Ω—å—à–µ = –º–µ–¥–ª–µ–Ω–Ω–µ–µ)</span>
                <input type="number" id="c-speed" class="setting-input" step="0.1" value="1.0">
            </div>

            <div class="setting-row">
                <span class="setting-label">üëÆ –®—Ç—Ä–∞—Ñ (–û–ø–æ–∑–¥–∞–Ω–∏–µ)</span>
                <input type="number" id="c-fine" class="setting-input">
            </div>

            <button onclick="saveAllConfigs()" class="shop-btn">–ü–†–ò–ú–ï–ù–ò–¢–¨ –ù–ê–°–¢–†–û–ô–ö–ò</button>
        </div>

        <div class="panel">
            <h2>üë• –°–ø–∏—Å–æ–∫ –ò–≥—Ä–æ–∫–æ–≤</h2>
            <input type="text" id="search" placeholder="–ü–æ–∏—Å–∫ –ø–æ –∏–º–µ–Ω–∏..." style="width:100%; padding:10px; margin-bottom:10px; background:#111; border:1px solid #444; color:white; border-radius:8px; box-sizing: border-box;" onkeyup="renderList()">
            <div id="user-list" class="user-list">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
        </div>

    </div>

    <div class="modal-overlay" id="overlay" onclick="closeModal()"></div>
    <div class="control-modal" id="modal">
        <i class="fa-solid fa-xmark close-btn" onclick="closeModal()"></i>
        <h3 id="m-name" style="margin:0; color:#888">–ò–º—è –ò–≥—Ä–æ–∫–∞</h3>
        <div class="big-stat" id="m-balance">0.00 PLN</div>
        <div style="text-align:center; color:#ff3d00; font-weight:bold" id="m-debt">–î–æ–ª–≥: 0</div>
        
        <div class="history-list" id="m-history"></div>

        <div class="btn-grid">
            <button class="big-btn btn-money" onclick="userAction('balance')">
                <i class="fa-solid fa-wallet"></i>
                –ò–ó–ú–ï–ù–ò–¢–¨ –ë–ê–õ–ê–ù–°
            </button>
            <button class="big-btn btn-fix" onclick="userAction('repair')">
                <i class="fa-solid fa-wrench"></i>
                –ü–û–ß–ò–ù–ò–¢–¨ –í–°–Å
            </button>
            <button class="big-btn btn-debt" onclick="userAction('reset_rating')">
                <i class="fa-solid fa-arrow-down"></i>
                –°–ë–†–û–°–ò–¢–¨ –†–ï–ô–¢–ò–ù–ì
            </button>
            <button class="big-btn btn-money" style="background:#673ab7" onclick="userAction('gift')">
                <i class="fa-solid fa-gift"></i>
                –î–ê–¢–¨ –ï–î–´
            </button>
            <button class="big-btn btn-reset" onclick="userAction('reset_hard')">
                <i class="fa-solid fa-skull"></i>
                –°–ë–†–û–° + –î–û–õ–ì
            </button>
            <button class="big-btn btn-ban" id="btn-ban" onclick="userAction('ban')">
                <i class="fa-solid fa-ban"></i>
                –ó–ê–ë–ê–ù–ò–¢–¨
            </button>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <script src="database.js"></script>
    <script>
        const dbRef = firebase.database().ref();
        let usersData = {};
        let selectedUserId = null;

        // 1. –ó–ê–ì–†–£–ó–ö–ê –ù–ê–°–¢–†–û–ï–ö
        dbRef.child('config').on('value', snap => {
            const c = snap.val() || {};
            document.getElementById('c-pay').value = c.basePay || 12;
            document.getElementById('c-inf').value = c.inflationRate || 0.05;
            document.getElementById('c-fine').value = c.penaltyLate || 5;
            document.getElementById('c-shop').value = c.shopMult || 1.0;
            document.getElementById('c-repair').value = c.repairMult || 1.0;
            document.getElementById('c-speed').value = c.speedMult || 1.0; 
        });

        function saveAllConfigs() {
            dbRef.child('config').update({
                basePay: parseFloat(document.getElementById('c-pay').value),
                inflationRate: parseFloat(document.getElementById('c-inf').value),
                penaltyLate: parseFloat(document.getElementById('c-fine').value),
                shopMult: parseFloat(document.getElementById('c-shop').value),
                repairMult: parseFloat(document.getElementById('c-repair').value),
                speedMult: parseFloat(document.getElementById('c-speed').value)
            });
            alert("‚úÖ –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω—ã!");
        }

        // 2. –ó–ê–ì–†–£–ó–ö–ê –ò–ì–†–û–ö–û–í
        dbRef.child('users').on('value', snap => {
            usersData = snap.val() || {};
            renderList();
        });

        function renderList() {
            const list = document.getElementById('user-list');
            const search = document.getElementById('search').value.toLowerCase();
            list.innerHTML = '';
            let onlineCount = 0;

            Object.entries(usersData).forEach(([uid, user]) => {
                if (search && !user.name.toLowerCase().includes(search)) return;

                const isOnline = (Date.now() - user.lastActive) < 60000;
                if(isOnline) onlineCount++;

                const div = document.createElement('div');
                div.className = `user-card ${isOnline ? 'online' : ''} ${user.isBanned ? 'banned' : ''}`;
                div.onclick = () => openModal(uid);
                
                div.innerHTML = `
                    <div>
                        <div style="font-weight:bold; font-size:16px; color:white">${user.name}</div>
                        <div style="font-size:12px; color:#888">ID: ${uid}</div>
                    </div>
                    <div style="text-align:right">
                        <div style="font-size:18px; font-weight:bold; color:#009de0">${(user.balance||0).toFixed(0)}</div>
                        <div style="font-size:11px; color:#666">${isOnline ? 'üü¢ Online' : '‚ö´ Offline'}</div>
                    </div>
                `;
                list.appendChild(div);
            });
            document.getElementById('online-counter').textContent = onlineCount;
            if (selectedUserId && usersData[selectedUserId]) updateModalUI(usersData[selectedUserId]);
        }

        // 3. –ú–û–î–ê–õ–ö–ê
        function openModal(uid) {
            selectedUserId = uid;
            document.getElementById('overlay').style.display = 'block';
            document.getElementById('modal').style.display = 'block';
            updateModalUI(usersData[uid]);
        }

        function closeModal() {
            selectedUserId = null;
            document.getElementById('overlay').style.display = 'none';
            document.getElementById('modal').style.display = 'none';
        }

        function updateModalUI(user) {
            if(!user) return;
            document.getElementById('m-name').innerText = user.name + (user.isBanned ? " (BANNED)" : "");
            document.getElementById('m-balance').innerText = (user.balance||0).toFixed(2) + " PLN";
            document.getElementById('m-debt').innerText = "–î–æ–ª–≥: " + (user.debt||0).toFixed(2);
            
            // –ò—Å—Ç–æ—Ä–∏—è
            const hList = document.getElementById('m-history');
            hList.innerHTML = user.history ? user.history.slice(-5).reverse().map(h => `<div class="h-item"><span>${h.rest}</span><span style="color:#00e676">+${h.earn}</span></div>`).join('') : '–ù–µ—Ç –∏—Å—Ç–æ—Ä–∏–∏';

            const banBtn = document.getElementById('btn-ban');
            banBtn.innerHTML = user.isBanned ? '<i class="fa-solid fa-lock-open"></i> –†–ê–ó–ë–ê–ù–ò–¢–¨' : '<i class="fa-solid fa-ban"></i> –ó–ê–ë–ê–ù–ò–¢–¨';
            banBtn.style.background = user.isBanned ? '#444' : '#d32f2f';
        }

        function userAction(action) {
            if(!selectedUserId) return;
            const uid = selectedUserId;
            const user = usersData[uid];

            if (action === 'balance') {
                let val = prompt("–í–≤–µ–¥–∏ –Ω–æ–≤—ã–π –±–∞–ª–∞–Ω—Å (—á–∏—Å–ª–æ):", user.balance);
                if (val !== null) dbRef.child('users/'+uid).update({ balance: parseFloat(val), adminEdit: true });
            }
            else if (action === 'repair') {
                if(confirm("–ü–æ—á–∏–Ω–∏—Ç—å –≤—Å—ë?")) {
                    dbRef.child('users/'+uid+'/items').set({bike:100, bag:100, phone:100, gear:100});
                    dbRef.child('users/'+uid+'/needs').set({energy:100, water:100, mood:100});
                    dbRef.child('users/'+uid).update({ adminEdit: true });
                }
            }
            else if (action === 'reset_rating') {
                if(confirm("–°–±—Ä–æ—Å–∏—Ç—å —Ä–µ–π—Ç–∏–Ω–≥ (—Ü–µ–Ω—ã)?")) {
                    dbRef.child('users/'+uid+'/repairs').set({bike:0, bag:0, phone:0, gear:0});
                    dbRef.child('users/'+uid).update({ adminEdit: true });
                }
            }
            else if (action === 'gift') {
                dbRef.child('users/'+uid+'/inventory').transaction(i => {
                    if(!i) i = {water:0, bar:0, energy_drink:0, coffee:0};
                    i.water += 5; i.bar += 5; i.energy_drink += 2;
                    return i;
                });
                alert("–ü–æ–¥–∞—Ä–æ–∫ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω!");
                dbRef.child('users/'+uid).update({ adminEdit: true });
            }
            else if (action === 'reset_hard') {
                if(confirm("–£–¥–∞–ª–∏—Ç—å –≤–µ—Å—å –ø—Ä–æ–≥—Ä–µ—Å—Å –∏ –ø–æ–≤–µ—Å–∏—Ç—å –¥–æ–ª–≥ 7000?")) {
                    dbRef.child('users/'+uid).update({
                        balance: 0, debt: 7000,
                        items: {bike:100, bag:100, phone:100, gear:100},
                        repairs: {bike:0, bag:0, phone:0, gear:0},
                        adminEdit: true
                    });
                }
            }
            else if (action === 'ban') {
                if(confirm(user.isBanned ? "–†–∞–∑–±–∞–Ω–∏—Ç—å?" : "–ó–∞–±–∞–Ω–∏—Ç—å –Ω–∞–≤—Å–µ–≥–¥–∞?")) {
                    dbRef.child('users/'+uid+'/isBanned').set(!user.isBanned);
                }
            }
        }
    </script>
</body>
</html>
