<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–ú–æ–±–∏–ª—å–Ω–∞—è –ê–¥–º–∏–Ω–∫–∞</title>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body { background: #121212; color: #eee; font-family: -apple-system, sans-serif; margin: 0; padding: 15px; padding-bottom: 80px; }
        h1 { margin: 0 0 15px 0; font-size: 20px; color: #00ccff; display: flex; justify-content: space-between; align-items: center; }
        
        /* TABS */
        .bottom-nav { position: fixed; bottom: 0; left: 0; right: 0; background: #1e1e1e; display: flex; justify-content: space-around; padding: 10px; border-top: 1px solid #333; z-index: 100; }
        .nav-item { color: #666; font-size: 10px; text-align: center; flex: 1; cursor: pointer; }
        .nav-item i { font-size: 20px; display: block; margin-bottom: 4px; }
        .nav-item.active { color: #00ccff; }

        .panel { display: none; }
        .panel.active { display: block; }

        /* CARDS */
        .card { background: #1e1e1e; border-radius: 12px; padding: 15px; margin-bottom: 12px; box-shadow: 0 2px 5px rgba(0,0,0,0.2); }
        .card-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; font-weight: bold; }
        .card-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; font-size: 14px; }
        .card-desc { font-size: 11px; color: #888; margin-top: -5px; margin-bottom: 10px; font-style: italic; }

        /* INPUTS */
        input[type="number"], select { background: #2c2c2c; border: 1px solid #444; color: white; padding: 10px; border-radius: 8px; width: 80px; font-weight: bold; text-align: center; }
        input[type="text"] { width: 100%; box-sizing: border-box; }
        input[type="range"] { width: 100%; margin: 10px 0; }
        input[type="checkbox"] { transform: scale(1.5); }

        /* BUTTONS */
        .btn { border: none; padding: 10px 15px; border-radius: 8px; font-weight: bold; cursor: pointer; font-size: 13px; }
        .btn-full { width: 100%; padding: 12px; margin-top: 10px; }
        .btn-blue { background: #009de0; color: white; }
        .btn-green { background: #00e676; color: black; }
        .btn-red { background: #ff3d00; color: white; }
        .btn-yellow { background: #ffcc00; color: black; }

        /* PLAYER LIST */
        .player-item { background: #252525; padding: 15px; border-radius: 10px; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; border-left: 4px solid #555; }
        .player-item.online { border-left-color: #00e676; }
        
        /* MODAL */
        #modal { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.9); z-index: 200; display: none; overflow-y: auto; }
        .modal-content { background: #121212; min-height: 100%; padding: 20px; box-sizing: border-box; }
    </style>
</head>
<body>

    <h1>–ê–î–ú–ò–ù –ë–û–ì <span id="status" style="font-size:10px; color:#666">...</span></h1>

    <div id="tab-players" class="panel active">
        <div id="players-list">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
    </div>

    <div id="tab-economy" class="panel">
        <div class="card">
            <div class="card-header" style="color:#00e676">üí∞ –ó–∞—Ä–ø–ª–∞—Ç–∞ –ö—É—Ä—å–µ—Ä–∞</div>
            
            <div class="card-row">
                <span>–ë–∞–∑–æ–≤–∞—è –ø–æ–¥–∞—á–∞</span>
                <input type="number" id="basePickupPay" placeholder="4.0">
            </div>
            <div class="card-desc">–°–∫–æ–ª—å–∫–æ –ø–ª–∞—Ç—è—Ç –ø—Ä–æ—Å—Ç–æ –∑–∞ –ø—Ä–∏—Ö–æ–¥ –≤ —Ä–µ—Å—Ç–æ—Ä–∞–Ω.</div>

            <div class="card-row">
                <span>–û–ø–ª–∞—Ç–∞ –∑–∞ –ö–ú</span>
                <input type="number" id="perKmPay" placeholder="1.5">
            </div>
            <div class="card-desc">–ë–æ–Ω—É—Å –∑–∞ –∫–∞–∂–¥—ã–π –∫–∏–ª–æ–º–µ—Ç—Ä –ø—É—Ç–∏.</div>

            <div class="card-row">
                <span>–†–∞–∑–±—Ä–æ—Å —Ü–µ–Ω—ã (+/-)</span>
                <input type="number" id="payVariance" placeholder="2.0">
            </div>
            <div class="card-desc">–°–ª—É—á–∞–π–Ω–∞—è –ø—Ä–∏–±–∞–≤–∫–∞ –∫ –∑–∞–∫–∞–∑—É (—á—Ç–æ–±—ã –Ω–µ –±—ã–ª–æ —Å–∫—É—á–Ω–æ).</div>
        </div>

        <div class="card">
            <div class="card-header" style="color:#ffcc00">üçé –¶–µ–Ω—ã –≤ –ú–∞–≥–∞–∑–∏–Ω–µ</div>
            <div class="card-row"><span>–í–æ–¥–∞</span> <input type="number" class="price-input" data-item="water"></div>
            <div class="card-row"><span>–°–Ω–∏–∫–µ—Ä—Å</span> <input type="number" class="price-input" data-item="bar"></div>
            <div class="card-row"><span>–≠–Ω–µ—Ä–≥–µ—Ç–∏–∫</span> <input type="number" class="price-input" data-item="energy_drink"></div>
            <div class="card-row"><span>–ö–æ—Ñ–µ</span> <input type="number" class="price-input" data-item="coffee"></div>
        </div>

        <div class="card">
            <div class="card-header" style="color:#ff3d00">üìà –ò–Ω—Ñ–ª—è—Ü–∏—è</div>
            <div class="card-row">
                <span>–†–æ—Å—Ç —Ü–µ–Ω (%)</span>
                <input type="number" id="inflationRate" placeholder="10">
            </div>
            <div class="card-desc">–ù–∞ —Å–∫–æ–ª—å–∫–æ % –¥–æ—Ä–æ–∂–∞–µ—Ç –µ–¥–∞ —Å –∫–∞–∂–¥—ã–º —É—Ä–æ–≤–Ω–µ–º —Ä–µ–º–æ–Ω—Ç–∞ –∏–≥—Ä–æ–∫–∞.</div>
        </div>

        <button class="btn btn-green btn-full" onclick="saveSettings()">üíæ –°–û–•–†–ê–ù–ò–¢–¨ –≠–ö–û–ù–û–ú–ò–ö–£</button>
    </div>

    <div id="tab-system" class="panel">
        
        <div class="card" style="border: 1px solid #ffcc00">
            <div class="card-header" style="color:#ffcc00">üöñ –¢–∞–∫—Å–∏ –ù–∞—Å—Ç—Ä–æ–π–∫–∏</div>
            <div class="card-row">
                <span>–¶–µ–Ω–∞ –ë–µ–Ω–∑–∏–Ω–∞</span>
                <input type="number" id="fuelPrice" placeholder="5.5">
            </div>
            <div class="card-row">
                <span>–£—Ä–æ–≤–µ–Ω—å –ü–æ–ª–∏—Ü–∏–∏ (0-2)</span>
                <input type="number" id="policeLevel" placeholder="0">
            </div>
            <div class="card-desc">0 = –ù–µ—Ç —à—Ç—Ä–∞—Ñ–æ–≤. 2 = –û–±–ª–∞–≤–∞ (—à—Ç—Ä–∞—Ñ—É—é—Ç —á–∞—Å—Ç–æ).</div>
        </div>

        <div class="card" style="border: 1px solid #ff3d00">
            <div class="card-header" style="color:#ff3d00">üî• –ì–æ—Ä—è—â–∏–µ –ó–∞–∫–∞–∑—ã</div>
            <div class="card-row">
                <span>–í–∫–ª—é—á–∏—Ç—å –±–æ–Ω—É—Å—ã?</span>
                <input type="checkbox" id="surgeEnabled">
            </div>
            <div class="card-row">
                <span>–®–∞–Ω—Å (0.1-1.0)</span>
                <input type="number" id="surgeChance" step="0.1">
            </div>
            <div class="card-desc">–ò–Ω–æ–≥–¥–∞ –¥–æ–±–∞–≤–ª—è–µ—Ç +20% –∫ —Ü–µ–Ω–µ –∑–∞–∫–∞–∑–∞, —á—Ç–æ–±—ã –º–æ—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å.</div>
        </div>

        <div class="card">
            <div class="card-header">‚ö° –°–ª–æ–∂–Ω–æ—Å—Ç—å –∏–≥—Ä—ã</div>
            <div class="card-row"><span>–¢—Ä–∞—Ç–∞ –≠–Ω–µ—Ä–≥–∏–∏</span> <input type="number" id="energyDrain" step="0.01"></div>
            <div class="card-desc">–°–∫–æ–ª—å–∫–æ —Å–∏–ª —É—Ö–æ–¥–∏—Ç –∑–∞ 1 –∫–ª–∏–∫.</div>
            <div class="card-row"><span>–¢—Ä–∞—Ç–∞ –í–æ–¥—ã</span> <input type="number" id="waterDrain" step="0.01"></div>
        </div>

        <button class="btn btn-green btn-full" onclick="saveSettings()">üíæ –°–û–•–†–ê–ù–ò–¢–¨ –ù–ê–°–¢–†–û–ô–ö–ò</button>
    </div>

    <div id="modal">
        <div class="modal-content">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px">
                <h2 id="m-name" style="margin:0">–ò–≥—Ä–æ–∫</h2>
                <button class="btn" onclick="closeModal()">–ó–∞–∫—Ä—ã—Ç—å</button>
            </div>
            <input type="hidden" id="m-id">

            <div class="card">
                <div class="card-header">üí≥ –§–∏–Ω–∞–Ω—Å—ã</div>
                <div class="card-row">
                    <input type="number" id="m-balance" style="width:100%" placeholder="–ë–∞–ª–∞–Ω—Å">
                    <button class="btn btn-blue" onclick="cmd('SET_VAR', {path:'balance', value: parseFloat(val('m-balance'))})">OK</button>
                </div>
                <div style="display:flex; gap:10px; margin-top:10px">
                    <button class="btn btn-blue" style="flex:1" onclick="cmd('SET_VAR', {path:'debt', value:0}); cmd('SET_VAR', {path:'debtOverdue', value:false})">–ü—Ä–æ—Å—Ç–∏—Ç—å –î–æ–ª–≥</button>
                </div>
            </div>

            <div class="card">
                <div class="card-header">üéí –ò–Ω–≤–µ–Ω—Ç–∞—Ä—å</div>
                <div class="card-row">
                    <select id="m-item">
                        <option value="water">–í–æ–¥–∞</option>
                        <option value="bar">–°–Ω–∏–∫–µ—Ä—Å</option>
                        <option value="energy_drink">–≠–Ω–µ—Ä–≥–µ—Ç–∏–∫</option>
                    </select>
                    <input type="number" id="m-qty" value="1" style="width:50px">
                    <button class="btn btn-green" onclick="giveItem(1)">+</button>
                    <button class="btn btn-red" onclick="giveItem(-1)">-</button>
                </div>
            </div>

            <div class="card">
                <div class="card-header">üöñ –¢–∞–∫—Å–∏ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</div>
                <button class="btn btn-yellow btn-full" onclick="cmd('SET_VAR', {path:'taxi.unlocked', value:true})">üîì –û—Ç–∫—Ä—ã—Ç—å –¥–æ—Å—Ç—É–ø (–ú–∞–≥–∞–∑–∏–Ω)</button>
                <div style="margin-top:10px; display:flex; gap:10px">
                    <button class="btn btn-green" style="flex:1" onclick="forceTaxi(true)">–ü–æ—Å–∞–¥–∏—Ç—å –≤ –∞–≤—Ç–æ</button>
                    <button class="btn btn-red" style="flex:1" onclick="forceTaxi(false)">–í–µ—Ä–Ω—É—Ç—å –≤–µ–ª–∏–∫</button>
                </div>
            </div>

            <div class="card">
                <div class="card-header" style="color:red">‚ò†Ô∏è –û–ø–∞—Å–Ω–∞—è –∑–æ–Ω–∞</div>
                <button class="btn btn-red btn-full" onclick="cmd('FULL_RESET', {charge:0})">–°–ë–†–û–°–ò–¢–¨ –ü–†–û–ì–†–ï–°–°</button>
            </div>
        </div>
    </div>

    <div class="bottom-nav">
        <div class="nav-item active" onclick="tab('players', this)"><i class="fa-solid fa-users"></i>–ò–≥—Ä–æ–∫–∏</div>
        <div class="nav-item" onclick="tab('economy', this)"><i class="fa-solid fa-coins"></i>–î–µ–Ω—å–≥–∏</div>
        <div class="nav-item" onclick="tab('system', this)"><i class="fa-solid fa-gears"></i>–°–∏—Å—Ç–µ–º–∞</div>
    </div>

    <script>
        const firebaseConfig = {
          apiKey: "AIzaSyChrQMyO2soPgoEHq_f3aYs5Cs19q3sWEk",
          authDomain: "warszawa-courier.firebaseapp.com",
          databaseURL: "https://warszawa-courier-default-rtdb.europe-west1.firebasedatabase.app",
          projectId: "warszawa-courier",
          storageBucket: "warszawa-courier.firebasestorage.app",
          messagingSenderId: "295860613508",
          appId: "1:295860613508:web:86fe8364377d6875612dd1",
          measurementId: "G-TGSCHBVLX2"
        };

        const DEFAULTS = { basePickupPay: 4.0, perKmPay: 1.5, payVariance: 2.0, inflationRate: 0.1, trafficChance: 0.1, trafficDuration: 3000, energyDrain: 0.15, waterDrain: 0.10, tipChance: 0.5, itemPrices: { water: 2.0, bar: 4.5, energy_drink: 7.0, coffee: 9.0 }, surge: { enabled: false, chance: 0.3 }, taxi: { fuelPrice: 5.5, policeLevel: 0 } };

        let db;
        try { firebase.initializeApp(firebaseConfig); db = firebase.database(); document.getElementById('status').textContent = "ONLINE"; document.getElementById('status').style.color = "#00e676"; init(); } 
        catch(e) { console.error(e); document.getElementById('status').textContent = "ERROR"; }

        function init() {
            // Load Players
            db.ref('players').on('value', snap => {
                const list = document.getElementById('players-list'); list.innerHTML = '';
                const data = snap.val() || {};
                Object.entries(data).forEach(([id, p]) => {
                    const isOnline = (Date.now() - (p.lastSeen || 0)) < 15000;
                    const div = document.createElement('div');
                    div.className = `player-item ${isOnline ? 'online' : ''}`;
                    div.innerHTML = `
                        <div>
                            <div style="font-weight:bold; color:white">${p.name || id}</div>
                            <div style="font-size:12px; color:#aaa">–ë–∞–ª–∞–Ω—Å: <span style="color:#00ccff">${parseFloat(p.balance||0).toFixed(2)}</span></div>
                        </div>
                        <button class="btn btn-blue" onclick="openPlayer('${id}', '${p.name||id}', ${p.balance||0})">Edit</button>
                    `;
                    list.appendChild(div);
                });
            });

            // Load Config
            db.ref('config').on('value', snap => {
                const cfg = snap.val() || DEFAULTS;
                const set = (id, val) => { const el = document.getElementById(id); if(el) el.value = val; };
                
                set('basePickupPay', cfg.basePickupPay);
                set('perKmPay', cfg.perKmPay);
                set('payVariance', cfg.payVariance);
                set('inflationRate', ((cfg.inflationRate||0.1)*100).toFixed(0));
                
                set('fuelPrice', cfg.taxi ? cfg.taxi.fuelPrice : 5.5);
                set('policeLevel', cfg.taxi ? cfg.taxi.policeLevel : 0);
                
                if(cfg.surge) {
                    document.getElementById('surgeEnabled').checked = cfg.surge.enabled;
                    set('surgeChance', cfg.surge.chance);
                }
                
                set('energyDrain', cfg.energyDrain);
                set('waterDrain', cfg.waterDrain);

                const prices = cfg.itemPrices || {};
                document.querySelectorAll('.price-input').forEach(inp => {
                    if(prices[inp.dataset.item]) inp.value = prices[inp.dataset.item];
                });
            });
        }

        // --- UI FUNCTIONS ---
        function tab(name, el) {
            document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
            document.getElementById('tab-'+name).classList.add('active');
            document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
            el.classList.add('active');
        }

        function openPlayer(id, name, balance) {
            document.getElementById('m-id').value = id;
            document.getElementById('m-name').textContent = name;
            document.getElementById('m-balance').value = balance;
            document.getElementById('modal').style.display = 'block';
        }
        function closeModal() { document.getElementById('modal').style.display = 'none'; }
        
        // --- COMMANDS ---
        function cmd(type, payload) {
            const id = document.getElementById('m-id').value;
            db.ref('players/' + id + '/adminInbox').push({ type, ...payload, timestamp: Date.now() });
            alert('–ö–æ–º–∞–Ω–¥–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞!');
        }

        function val(id) { return document.getElementById(id).value; }

        function giveItem(qty) {
            const item = val('m-item');
            const amount = parseInt(val('m-qty')) * qty; // qty is 1 or -1
            cmd('MATH_VAR', { path: 'inventory.' + item, value: amount });
        }

        function forceTaxi(state) {
            cmd('SET_VAR', { path: 'taxi.active', value: state });
            if(state) cmd('MATH_VAR', { path: 'taxi.fuel', value: 50 }); // –î–∞–µ–º –±–µ–Ω–∑–∏–Ω –¥–ª—è —Å—Ç–∞—Ä—Ç–∞
        }

        function saveSettings() {
            const getNum = (id) => parseFloat(document.getElementById(id).value);
            
            const data = {
                basePickupPay: getNum('basePickupPay'),
                perKmPay: getNum('perKmPay'),
                payVariance: getNum('payVariance'),
                inflationRate: getNum('inflationRate') / 100,
                energyDrain: getNum('energyDrain'),
                waterDrain: getNum('waterDrain'),
                taxi: {
                    fuelPrice: getNum('fuelPrice'),
                    policeLevel: getNum('policeLevel')
                },
                surge: {
                    enabled: document.getElementById('surgeEnabled').checked,
                    chance: getNum('surgeChance')
                },
                itemPrices: {}
            };

            document.querySelectorAll('.price-input').forEach(inp => {
                data.itemPrices[inp.dataset.item] = parseFloat(inp.value);
            });

            db.ref('config').update(data).then(() => alert('–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã!'));
        }
    </script>
</body>
</html>
