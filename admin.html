<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WARSAW GOD MODE</title>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root { --primary: #2563eb; --danger: #dc2626; --success: #16a34a; --bg: #f8fafc; --surface: #ffffff; --border: #e2e8f0; }
        body { background: var(--bg); color: #0f172a; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; margin: 0; padding: 0; font-size: 13px; }
        
        /* HEADER */
        .header { background: var(--surface); padding: 15px; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; position: sticky; top: 0; z-index: 100; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        .logo { font-weight: 900; font-size: 16px; letter-spacing: -0.5px; color: #0f172a; display: flex; align-items: center; gap: 8px; }
        .status { font-size: 10px; font-weight: bold; color: var(--success); background: #dcfce7; padding: 4px 8px; border-radius: 12px; }

        /* NAV */
        .nav { display: flex; background: var(--surface); padding: 5px 15px; overflow-x: auto; gap: 5px; border-bottom: 1px solid var(--border); }
        .nav-btn { background: none; border: none; padding: 10px 15px; color: #64748b; font-weight: 600; cursor: pointer; border-radius: 6px; white-space: nowrap; transition: 0.2s; }
        .nav-btn.active { background: #eff6ff; color: var(--primary); }
        .nav-btn:hover { background: #f1f5f9; }

        /* CONTENT */
        .view { display: none; padding: 15px; max-width: 800px; margin: 0 auto; animation: fadeIn 0.2s; }
        .view.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

        /* CARDS & TABLES */
        .card { background: var(--surface); border: 1px solid var(--border); border-radius: 12px; padding: 20px; margin-bottom: 15px; box-shadow: 0 1px 3px rgba(0,0,0,0.05); }
        .card-header { font-size: 14px; font-weight: 700; color: #334155; margin-bottom: 15px; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid var(--border); padding-bottom: 10px; }
        
        .data-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); gap: 10px; }
        .input-group { margin-bottom: 10px; }
        .input-label { display: block; font-size: 11px; color: #64748b; margin-bottom: 4px; font-weight: 600; }
        input, select { width: 100%; padding: 8px; border: 1px solid var(--border); border-radius: 6px; font-size: 13px; background: #fff; box-sizing: border-box; transition: 0.2s; }
        input:focus { border-color: var(--primary); outline: none; }

        /* PLAYER LIST */
        .player-row { display: flex; justify-content: space-between; align-items: center; padding: 12px; border-bottom: 1px solid var(--border); cursor: pointer; transition: 0.1s; }
        .player-row:hover { background: #f8fafc; }
        .p-avatar { width: 32px; height: 32px; background: #e2e8f0; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; color: #64748b; margin-right: 10px; }
        .p-info { flex: 1; }
        .p-name { font-weight: 600; color: #0f172a; }
        .p-meta { font-size: 11px; color: #64748b; }
        .p-badge { font-size: 10px; padding: 2px 6px; border-radius: 4px; font-weight: bold; margin-left: 5px; }
        .badge-online { background: #dcfce7; color: var(--success); }
        .badge-ban { background: #fee2e2; color: var(--danger); }

        /* BUTTONS */
        .btn { width: 100%; padding: 10px; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; transition: 0.2s; display: flex; justify-content: center; align-items: center; gap: 8px; }
        .btn-primary { background: var(--primary); color: white; }
        .btn-danger { background: #fee2e2; color: var(--danger); }
        .btn-ghost { background: transparent; border: 1px solid var(--border); color: #475569; }
        
        /* MODAL */
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; display: none; align-items: center; justify-content: center; backdrop-filter: blur(2px); }
        .modal-window { background: white; width: 95%; max-width: 500px; max-height: 90vh; border-radius: 16px; overflow-y: auto; box-shadow: 0 20px 50px rgba(0,0,0,0.1); display: flex; flex-direction: column; }
        .modal-content { padding: 20px; }
        
        /* BONUS EDITOR */
        .bonus-item { background: #f1f5f9; padding: 10px; border-radius: 8px; margin-bottom: 10px; border: 1px solid var(--border); }
    </style>
</head>
<body>

    <div class="header">
        <div class="logo"><i class="fa-solid fa-user-secret"></i> WARSAW ADMIN <span style="font-size:10px; color:#94a3b8; font-weight:400">v4.0</span></div>
        <div id="connection-status" class="status">OFFLINE</div>
    </div>

    <div class="nav">
        <button class="nav-btn active" onclick="switchTab('tab-players')"><i class="fa-solid fa-users"></i> –ò–≥—Ä–æ–∫–∏</button>
        <button class="nav-btn" onclick="switchTab('tab-economy')"><i class="fa-solid fa-coins"></i> –≠–∫–æ–Ω–æ–º–∏–∫–∞</button>
        <button class="nav-btn" onclick="switchTab('tab-rocket')"><i class="fa-solid fa-rocket"></i> –†–∞–∫–µ—Ç–∞ (–ë–æ–Ω—É—Å—ã)</button>
        <button class="nav-btn" onclick="switchTab('tab-system')"><i class="fa-solid fa-gear"></i> –°–∏—Å—Ç–µ–º–∞</button>
    </div>

    <div id="tab-players" class="view active">
        <input type="text" id="player-search" placeholder="üîç –ü–æ–∏—Å–∫ –ø–æ –∏–º–µ–Ω–∏ –∏–ª–∏ ID..." onkeyup="filterPlayers()" style="padding:12px; margin-bottom:15px; border-color:var(--primary)">
        <div class="card" style="padding:0" id="players-list">
            </div>
    </div>

    <div id="tab-economy" class="view">
        <div class="card">
            <div class="card-header">üè¶ –ú–∏–Ω–∏—Å—Ç–µ—Ä—Å—Ç–≤–æ (–ì–ª–æ–±–∞–ª—å–Ω–æ) <button class="btn-ghost" style="width:auto; padding:4px 10px" onclick="saveConfig()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button></div>
            <div class="data-grid">
                <div><span class="input-label">–ë–∞–∑–æ–≤–∞—è –æ–ø–ª–∞—Ç–∞ (PLN)</span><input type="number" id="cfg-basePickupPay"></div>
                <div><span class="input-label">–û–ø–ª–∞—Ç–∞ –∑–∞ –ö–ú (PLN)</span><input type="number" id="cfg-perKmPay"></div>
                <div><span class="input-label">–ò–Ω—Ñ–ª—è—Ü–∏—è –∑–∞ —É—Ä–æ–≤–µ–Ω—å (%)</span><input type="number" id="cfg-inflationRate"></div>
            </div>
        </div>

        <div class="card">
            <div class="card-header">üí≥ –ë–∞–Ω–∫–æ–≤—Å–∫–∞—è –°–∏—Å—Ç–µ–º–∞</div>
            <div class="data-grid">
                <div><span class="input-label">–ë–∞–∑–æ–≤—ã–π –ö—Ä–µ–¥–∏—Ç (PLN)</span><input type="number" id="cfg-bankLimitBase" placeholder="1000"></div>
                <div><span class="input-label">–ú–Ω–æ–∂–∏—Ç–µ–ª—å –î–æ–≤–µ—Ä–∏—è (–∑–∞ –∑–∞–∫–∞–∑)</span><input type="number" id="cfg-bankLimitMulti" placeholder="50"></div>
            </div>
            <p style="font-size:11px; color:#666; margin-top:10px">–§–æ—Ä–º—É–ª–∞: –ë–∞–∑–∞ + (–í—Å–µ–≥–æ–ó–∞–∫–∞–∑–æ–≤ * –ú–Ω–æ–∂–∏—Ç–µ–ª—å)</p>
        </div>

        <div class="card">
            <div class="card-header">üöñ –¢–∞–∫—Å–∏ & –õ–∏—Ü–µ–Ω–∑–∏–∏</div>
            <div class="data-grid">
                <div><span class="input-label">–õ–∏—Ü–µ–Ω–∑–∏—è (–¶–µ–Ω–∞)</span><input type="number" id="cfg-licPrice"></div>
                <div><span class="input-label">–¢–∞—Ä–∏—Ñ –¢–∞–∫—Å–∏ (–ú–Ω–æ–∂–∏—Ç–µ–ª—å)</span><input type="number" id="cfg-taxiMulti"></div>
            </div>
        </div>

        <div class="card">
            <div class="card-header">üõí –¶–µ–Ω—ã –¢–æ–≤–∞—Ä–æ–≤ (–ú–∞–≥–∞–∑–∏–Ω)</div>
            <div class="data-grid" id="items-price-list">
                </div>
        </div>
    </div>

    <div id="tab-rocket" class="view">
        <div class="card">
            <div class="card-header">üöÄ –ê–∫—Ç–∏–≤–Ω—ã–µ –¶–µ–ª–∏ (–†–∞–∫–µ—Ç–∞) <button class="btn-primary" style="width:auto" onclick="saveBonuses()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –†–∞–∫–µ—Ç—É</button></div>
            <div id="bonus-editor-container">
                </div>
            <button class="btn-ghost" onclick="addBonusSlot()" style="margin-top:10px">+ –î–æ–±–∞–≤–∏—Ç—å —Å–ª–æ—Ç</button>
        </div>
    </div>

    <div id="tab-system" class="view">
        <div class="card">
            <div class="card-header">üìù –õ–æ–≥ –û–ø–µ—Ä–∞—Ü–∏–π</div>
            <div id="system-logs" style="font-family:monospace; font-size:11px; max-height:300px; overflow-y:auto; background:#1e293b; color:#cbd5e1; padding:10px; border-radius:6px">
                –ó–∞–≥—Ä—É–∑–∫–∞ –ª–æ–≥–æ–≤...
            </div>
        </div>
        <div class="card" style="border-color:var(--danger)">
            <div class="card-header" style="color:var(--danger)">‚õî –û–ø–∞—Å–Ω–∞—è –ó–æ–Ω–∞</div>
            <button class="btn-danger" onclick="globalWipe()">‚ò¢Ô∏è –ü–û–õ–ù–´–ô –í–ê–ô–ü (–û–ë–ù–£–õ–ï–ù–ò–ï)</button>
        </div>
    </div>

    <div id="player-modal" class="modal-overlay">
        <div class="modal-window">
            <div style="padding:15px; border-bottom:1px solid #e2e8f0; display:flex; justify-content:space-between; align-items:center; background:#f8fafc">
                <div>
                    <div style="font-weight:900; font-size:18px" id="pm-name">Player</div>
                    <div style="font-size:11px; color:#64748b" id="pm-id">ID</div>
                </div>
                <button onclick="closeModal()" style="background:none; border:none; font-size:20px; cursor:pointer">‚úï</button>
            </div>
            
            <div class="modal-content">
                <div style="display:flex; gap:10px; margin-bottom:20px">
                    <button class="btn btn-primary" onclick="pmSave()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                    <button class="btn btn-danger" onclick="pmBan()" id="pm-ban-btn">üö´ BAN</button>
                    <button class="btn btn-ghost" onclick="pmReset()">‚ôªÔ∏è –°–±—Ä–æ—Å</button>
                </div>

                <div class="input-group">
                    <label class="input-label">üí∞ –ë–∞–ª–∞–Ω—Å / üè¶ –î–æ–ª–≥</label>
                    <div style="display:flex; gap:10px">
                        <input type="number" id="pm-balance" placeholder="–ë–∞–ª–∞–Ω—Å">
                        <input type="number" id="pm-debt" placeholder="–î–æ–ª–≥">
                    </div>
                </div>

                <div class="input-group">
                    <label class="input-label">‚ö° –≠–Ω–µ—Ä–≥–∏—è / üíß –í–æ–¥–∞ / üòé –ù–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ</label>
                    <div style="display:flex; gap:5px">
                        <input type="number" id="pm-energy" placeholder="Eng">
                        <input type="number" id="pm-water" placeholder="H2O">
                        <input type="number" id="pm-mood" placeholder="Mood">
                    </div>
                </div>

                <div class="input-group">
                    <label class="input-label">üì¶ –í—Å–µ–≥–æ –∑–∞–∫–∞–∑–æ–≤ / üîß –£—Ä–æ–≤–µ–Ω—å –ò–Ω—Ñ–ª—è—Ü–∏–∏ (–†–µ–º–æ–Ω—Ç)</label>
                    <div style="display:flex; gap:10px">
                        <input type="number" id="pm-orders">
                        <input type="number" id="pm-repairs">
                    </div>
                </div>

                <div class="input-group">
                    <label class="input-label">üéí –ò–Ω–≤–µ–Ω—Ç–∞—Ä—å (–ö–æ—Ä–∑–∏–Ω–∞)</label>
                    <div class="data-grid">
                        <input type="number" id="pm-inv-water" placeholder="–í–æ–¥–∞">
                        <input type="number" id="pm-inv-bar" placeholder="–°–Ω–∏–∫–µ—Ä—Å">
                        <input type="number" id="pm-inv-energy" placeholder="RedBull">
                        <input type="number" id="pm-inv-coffee" placeholder="–ö–æ—Ñ–µ">
                        <input type="number" id="pm-inv-gas" placeholder="–ë–µ–Ω–∑–∏–Ω">
                    </div>
                </div>

                <div style="margin-top:15px; padding:10px; background:#f0f9ff; border-radius:8px; border:1px solid #bae6fd">
                    <label class="input-label" style="color:#0284c7">üöñ –¢–ê–ö–°–ò –£–ü–†–ê–í–õ–ï–ù–ò–ï</label>
                    <div style="display:flex; gap:10px; align-items:center; margin-top:5px">
                        <select id="pm-taxi-car">
                            <option value="">–ù–µ—Ç –º–∞—à–∏–Ω—ã</option>
                            <option value="skoda">Skoda</option>
                            <option value="toyota">Toyota</option>
                            <option value="tesla">Tesla</option>
                        </select>
                        <button class="btn-ghost" onclick="pmUnlockTaxi()" style="width:auto; white-space:nowrap">–û—Ç–∫—Ä—ã—Ç—å –¥–æ—Å—Ç—É–ø</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // CONFIG
        const firebaseConfig = {
            apiKey: "AIzaSyChrQMyO2soPgoEHq_f3aYs5Cs19q3sWEk",
            authDomain: "warszawa-courier.firebaseapp.com",
            databaseURL: "https://warszawa-courier-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "warszawa-courier",
            storageBucket: "warszawa-courier.firebasestorage.app",
            messagingSenderId: "295860613508",
            appId: "1:295860613508:web:86fe8364377d6875612dd1"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        
        let playersData = {};
        let activePlayerId = null;

        // --- INIT LISTENERS ---
        db.ref('.info/connected').on('value', s => {
            const el = document.getElementById('connection-status');
            el.innerText = s.val() ? "ONLINE" : "DISCONNECTED";
            el.style.background = s.val() ? "#dcfce7" : "#fee2e2";
            el.style.color = s.val() ? "#16a34a" : "#dc2626";
        });

        // 1. PLAYERS SYNC
        db.ref('players').on('value', snap => {
            playersData = snap.val() || {};
            renderPlayerList();
        });

        // 2. CONFIG SYNC
        db.ref('config').on('value', snap => {
            const cfg = snap.val() || {};
            fillInput('cfg-basePickupPay', cfg.basePickupPay);
            fillInput('cfg-perKmPay', cfg.perKmPay);
            fillInput('cfg-inflationRate', (cfg.inflationRate || 0.1) * 100);
            
            // Bank
            fillInput('cfg-bankLimitBase', cfg.bankLimitBase || 1000);
            fillInput('cfg-bankLimitMulti', cfg.bankLimitMulti || 50);

            // Taxi
            fillInput('cfg-licPrice', 5000); // Placeholder if not in config
            fillInput('cfg-taxiMulti', 4.0);

            // Items
            const items = cfg.itemPrices || { water: 2, bar: 4.5, energy_drink: 7 };
            const container = document.getElementById('items-price-list');
            container.innerHTML = '';
            for(let [key, val] of Object.entries(items)) {
                container.innerHTML += `<div><span class="input-label">${key}</span><input type="number" class="item-price-inp" data-key="${key}" value="${val}"></div>`;
            }
        });

        // 3. BONUSES SYNC
        db.ref('bonuses').on('value', snap => {
            const bonuses = snap.val() || { active: [] };
            renderBonusEditor(bonuses.active || []);
        });

        // 4. LOGS
        db.ref('logs').limitToLast(50).on('value', snap => {
            const logs = snap.val();
            const el = document.getElementById('system-logs');
            if(!logs) { el.innerHTML = '–ù–µ—Ç –ª–æ–≥–æ–≤'; return; }
            el.innerHTML = Object.values(logs).reverse().map(l => 
                `<div><span style="color:#64748b">[${new Date(l.timestamp).toLocaleTimeString()}]</span> <strong style="color:#e2e8f0">${l.playerName}</strong>: ${l.message}</div>`
            ).join('');
        });

        // --- UI FUNCTIONS ---
        function switchTab(id) {
            document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            event.target.classList.add('active');
        }

        function renderPlayerList() {
            const term = document.getElementById('player-search').value.toLowerCase();
            const list = document.getElementById('players-list');
            list.innerHTML = '';
            
            Object.entries(playersData).forEach(([id, p]) => {
                if(p.name && (p.name.toLowerCase().includes(term) || id.includes(term))) {
                    const isOnline = (Date.now() - (p.lastSeen||0) < 15000);
                    list.innerHTML += `
                        <div class="player-row" onclick="openPlayer('${id}')">
                            <div class="p-avatar">${p.name.charAt(0).toUpperCase()}</div>
                            <div class="p-info">
                                <div class="p-name">${p.name} 
                                    ${isOnline ? '<span class="p-badge badge-online">ONLINE</span>' : ''}
                                    ${p.isBanned ? '<span class="p-badge badge-ban">BANNED</span>' : ''}
                                </div>
                                <div class="p-meta">ID: ${id} ‚Ä¢ –ë–∞–ª–∞–Ω—Å: ${(p.balance||0).toFixed(2)} PLN</div>
                            </div>
                            <div style="font-weight:bold; color:#64748b">‚úèÔ∏è</div>
                        </div>
                    `;
                }
            });
        }

        function filterPlayers() { renderPlayerList(); }

        function openPlayer(id) {
            activePlayerId = id;
            const p = playersData[id];
            if(!p) return;

            document.getElementById('player-modal').style.display = 'flex';
            document.getElementById('pm-name').innerText = p.name;
            document.getElementById('pm-id').innerText = id;

            fillInput('pm-balance', p.balance);
            fillInput('pm-debt', p.debt);
            
            const s = p.needs || {energy:100, water:100, mood:100};
            fillInput('pm-energy', s.energy);
            fillInput('pm-water', s.water);
            fillInput('pm-mood', s.mood);

            fillInput('pm-orders', (p.career?.totalOrders || 0));
            // Calculate repairs level sum
            const repairs = p.repairs || {};
            const totalRepairs = Object.values(repairs).reduce((a,b)=>a+b,0);
            fillInput('pm-repairs', totalRepairs);

            const inv = p.inventory || {};
            fillInput('pm-inv-water', inv.water);
            fillInput('pm-inv-bar', inv.bar);
            fillInput('pm-inv-energy', inv.energy_drink);
            fillInput('pm-inv-coffee', inv.coffee);
            fillInput('pm-inv-gas', inv.gas);

            document.getElementById('pm-taxi-car').value = p.taxi?.vehicle || "";
            
            const btnBan = document.getElementById('pm-ban-btn');
            btnBan.innerText = p.isBanned ? "–†–ê–ó–ë–ê–ù–ò–¢–¨" : "üö´ BAN";
        }

        function closeModal() {
            document.getElementById('player-modal').style.display = 'none';
            activePlayerId = null;
        }

        // --- ACTIONS ---
        function pmSave() {
            if(!activePlayerId) return;
            const updates = {
                balance: parseFloat(document.getElementById('pm-balance').value),
                debt: parseFloat(document.getElementById('pm-debt').value),
                'needs/energy': parseInt(document.getElementById('pm-energy').value),
                'needs/water': parseInt(document.getElementById('pm-water').value),
                'needs/mood': parseInt(document.getElementById('pm-mood').value),
                'inventory/water': parseInt(document.getElementById('pm-inv-water').value),
                'inventory/bar': parseInt(document.getElementById('pm-inv-bar').value),
                'inventory/energy_drink': parseInt(document.getElementById('pm-inv-energy').value),
                'inventory/coffee': parseInt(document.getElementById('pm-inv-coffee').value),
                'inventory/gas': parseInt(document.getElementById('pm-inv-gas').value),
                'taxi/vehicle': document.getElementById('pm-taxi-car').value,
                'career/totalOrders': parseInt(document.getElementById('pm-orders').value)
            };
            
            // Hacky repair update: if user changed total repairs, just dump into bike for now
            // Or ideally, we shouldn't touch repairs structure unless we list all parts.
            // Leaving repairs alone for simplicity unless requested.
            
            db.ref('players/' + activePlayerId).update(updates).then(() => alert('–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ!'));
        }

        function pmBan() {
            if(!activePlayerId) return;
            const isBanned = playersData[activePlayerId].isBanned;
            db.ref('players/' + activePlayerId).update({ isBanned: !isBanned });
            closeModal();
        }

        function pmReset() {
            if(!activePlayerId) return;
            if(confirm('–û–±–Ω—É–ª–∏—Ç—å –∏–≥—Ä–æ–∫–∞ –ë–ï–°–ü–õ–ê–¢–ù–û?')) {
                db.ref('players/' + activePlayerId + '/adminInbox').push({ type: 'FULL_RESET', charge: 0 });
                alert('–ö–æ–º–∞–Ω–¥–∞ –Ω–∞ —Å–±—Ä–æ—Å –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞.');
                closeModal();
            }
        }
        
        function pmUnlockTaxi() {
             if(!activePlayerId) return;
             db.ref('players/' + activePlayerId + '/taxi').update({ unlocked: true });
             alert('–¢–∞–∫—Å–∏ —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ –¥–ª—è –∏–≥—Ä–æ–∫–∞.');
        }

        function saveConfig() {
            const itemPrices = {};
            document.querySelectorAll('.item-price-inp').forEach(i => {
                itemPrices[i.getAttribute('data-key')] = parseFloat(i.value);
            });

            const updates = {
                basePickupPay: parseFloat(document.getElementById('cfg-basePickupPay').value),
                perKmPay: parseFloat(document.getElementById('cfg-perKmPay').value),
                inflationRate: parseFloat(document.getElementById('cfg-inflationRate').value) / 100,
                bankLimitBase: parseFloat(document.getElementById('cfg-bankLimitBase').value),
                bankLimitMulti: parseFloat(document.getElementById('cfg-bankLimitMulti').value),
                itemPrices: itemPrices
            };
            db.ref('config').update(updates).then(() => alert('–≠–∫–æ–Ω–æ–º–∏–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∞!'));
        }

        // --- BONUS (ROCKET) SYSTEM ---
        function renderBonusEditor(bonuses) {
            const container = document.getElementById('bonus-editor-container');
            container.innerHTML = '';
            bonuses.forEach((b, idx) => {
                container.innerHTML += `
                <div class="bonus-item">
                    <div style="display:flex; justify-content:space-between; margin-bottom:5px">
                        <strong>–°–ª–æ—Ç #${idx+1}</strong>
                        <button class="btn-ghost" style="width:auto; color:red; padding:2px" onclick="removeBonus(${idx})">‚úï</button>
                    </div>
                    <div class="data-grid">
                        <input type="text" class="b-title" value="${b.title}" placeholder="–ó–∞–≥–æ–ª–æ–≤–æ–∫">
                        <input type="number" class="b-reward" value="${b.reward}" placeholder="–ù–∞–≥—Ä–∞–¥–∞ (PLN)">
                        <input type="number" class="b-target" value="${b.target}" placeholder="–¶–µ–ª—å (–∑–∞–∫–∞–∑—ã)">
                        <input type="number" class="b-minutes" value="${b.minutes || 60}" placeholder="–í—Ä–µ–º—è (–º–∏–Ω)">
                    </div>
                </div>`;
            });
        }

        function addBonusSlot() {
            const bonuses = getCurrentBonuses();
            bonuses.push({ title: "–ù–æ–≤–∞—è –¶–µ–ª—å", reward: 100, target: 10, minutes: 60 });
            renderBonusEditor(bonuses);
        }

        function removeBonus(idx) {
            const bonuses = getCurrentBonuses();
            bonuses.splice(idx, 1);
            renderBonusEditor(bonuses);
        }

        function getCurrentBonuses() {
            const items = document.querySelectorAll('.bonus-item');
            const res = [];
            items.forEach(el => {
                res.push({
                    title: el.querySelector('.b-title').value,
                    reward: parseFloat(el.querySelector('.b-reward').value),
                    target: parseInt(el.querySelector('.b-target').value),
                    minutes: parseInt(el.querySelector('.b-minutes').value)
                });
            });
            return res;
        }

        function saveBonuses() {
            const raw = getCurrentBonuses();
            const now = Date.now();
            // Convert simple minutes input to actual timestamps for the game
            const readyBonuses = raw.map((b, i) => ({
                id: i+1,
                title: b.title,
                reward: b.reward,
                target: b.target,
                endTime: now + (b.minutes * 60 * 1000)
            }));
            
            db.ref('bonuses/active').set(readyBonuses).then(() => alert('üöÄ –†–∞–∫–µ—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∞! –ò–≥—Ä–æ–∫–∏ –≤–∏–¥—è—Ç –Ω–æ–≤—ã–µ —Ü–µ–ª–∏.'));
        }

        function globalWipe() {
            if(confirm("–¢–´ –£–í–ï–†–ï–ù?! –≠—Ç–æ —É–¥–∞–ª–∏—Ç –í–°–ï–• –∏–≥—Ä–æ–∫–æ–≤ –∏ –∏—Ö –ø—Ä–æ–≥—Ä–µ—Å—Å. –≠—Ç–æ –Ω–µ–æ–±—Ä–∞—Ç–∏–º–æ.")) {
                if(confirm("–¢–û–ß–ù–û???")) {
                    db.ref('players').remove().then(() => alert('–ú–∏—Ä —É–Ω–∏—á—Ç–æ–∂–µ–Ω.'));
                }
            }
        }

        function fillInput(id, val) {
            const el = document.getElementById(id);
            if(el) el.value = (val !== undefined) ? val : "";
        }
    </script>
</body>
</html>
