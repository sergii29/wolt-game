<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wolt God Mode</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* –°–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è –ê–¥–º–∏–Ω–∫–∏ –ø–æ–≤–µ—Ä—Ö style.css */
        body { background-color: #121212; color: white; overflow-y: auto; padding: 20px; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .panel-card {
            background: #1e1e1e;
            border-radius: 16px;
            padding: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            border: 1px solid #333;
        }

        .panel-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; padding-bottom: 10px; border-bottom: 1px solid #333; }
        .panel-title { font-size: 18px; font-weight: 800; color: var(--wolt-blue); text-transform: uppercase; }
        
        /* –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ */
        .stat-big { font-size: 36px; font-weight: 900; color: white; }
        .stat-label { color: #888; font-size: 12px; text-transform: uppercase; }
        .stat-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }

        /* –ò–≥—Ä–æ–∫–∏ */
        .user-list { display: flex; flex-direction: column; gap: 10px; }
        .user-row { 
            background: #252525; border-radius: 12px; padding: 15px; 
            display: flex; flex-wrap: wrap; justify-content: space-between; align-items: center;
            border-left: 4px solid #555; transition: 0.2s;
        }
        .user-row.online { border-left-color: var(--accent-green); background: rgba(0, 230, 118, 0.05); }
        .user-row.banned { border-left-color: var(--accent-red); opacity: 0.6; }

        .user-info { display: flex; align-items: center; gap: 10px; min-width: 200px; }
        .user-avatar { width: 40px; height: 40px; background: #333; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; color: var(--wolt-blue); }
        
        .user-stats { display: flex; gap: 15px; font-size: 13px; color: #ccc; margin: 10px 0; }
        .stat-pill { background: #333; padding: 4px 8px; border-radius: 6px; }

        .user-actions { display: flex; gap: 8px; }
        .act-btn { 
            border: none; padding: 8px 12px; border-radius: 8px; cursor: pointer; font-weight: bold; font-size: 12px; color: white; transition: 0.2s;
            display: flex; align-items: center; gap: 5px;
        }
        .act-btn:hover { transform: translateY(-2px); }
        
        .btn-edit { background: var(--wolt-blue); }
        .btn-gift { background: var(--accent-purple); }
        .btn-fix { background: var(--accent-green); }
        .btn-ban { background: #444; color: #aaa; }
        .btn-ban.banned { background: var(--accent-red); color: white; }

        /* –ö–æ–Ω—Ñ–∏–≥ –≠–∫–æ–Ω–æ–º–∏–∫–∏ */
        .config-input { 
            background: #333; border: 1px solid #444; color: white; padding: 8px; border-radius: 8px; width: 80px; text-align: center; font-weight: bold; 
        }
        .config-label { color: #ccc; font-size: 14px; }

        /* –ú–æ–¥–∞–ª–∫–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è */
        .edit-modal { 
            position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
            background: #252525; padding: 30px; border-radius: 20px; z-index: 3000;
            box-shadow: 0 10px 40px rgba(0,0,0,0.8); border: 1px solid #444;
            display: none; text-align: center; width: 300px;
        }
        .edit-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 2999; display: none;
        }

    </style>
</head>
<body>

    <h1 style="margin-bottom: 20px; color: white;"><i class="fa-solid fa-user-astronaut"></i> Wolt Admin <span style="font-size:12px; color:#666; vertical-align:middle">v2.0</span></h1>

    <div class="dashboard-grid">
        
        <div class="panel-card">
            <div class="panel-header">
                <span class="panel-title">–°—Ç–∞—Ç—É—Å –°–µ—Ä–≤–µ—Ä–∞</span>
                <i class="fa-solid fa-server" style="color:#666"></i>
            </div>
            <div style="display:flex; justify-content:space-between; text-align:center">
                <div>
                    <div class="stat-big" id="total-users">0</div>
                    <div class="stat-label">–í—Å–µ–≥–æ –∫—É—Ä—å–µ—Ä–æ–≤</div>
                </div>
                <div>
                    <div class="stat-big" id="online-users" style="color:var(--accent-green)">0</div>
                    <div class="stat-label">–°–µ–π—á–∞—Å –û–Ω–ª–∞–π–Ω</div>
                </div>
            </div>
            <button class="shop-btn" onclick="resetAllUsers()" style="background:var(--accent-red); width:100%; margin-top:20px; border:none; color:white">
                <i class="fa-solid fa-skull"></i> –û–ë–ù–£–õ–ò–¢–¨ –í–°–ï–• (WIPE)
            </button>
        </div>

        <div class="panel-card">
            <div class="panel-header">
                <span class="panel-title">–≠–∫–æ–Ω–æ–º–∏–∫–∞ –í–∞—Ä—à–∞–≤—ã</span>
                <i class="fa-solid fa-coins" style="color:#666"></i>
            </div>
            
            <div class="stat-row">
                <span class="config-label">üí∞ –ë–∞–∑–æ–≤–∞—è –æ–ø–ª–∞—Ç–∞ (PLN)</span>
                <input type="number" id="conf-pay" class="config-input" step="1">
            </div>
            <div class="stat-row">
                <span class="config-label">üìà –ò–Ω—Ñ–ª—è—Ü–∏—è (0.05 = 5%)</span>
                <input type="number" id="conf-inf" class="config-input" step="0.01">
            </div>
            <div class="stat-row">
                <span class="config-label">üëÆ –®—Ç—Ä–∞—Ñ (–û–ø–æ–∑–¥–∞–Ω–∏–µ)</span>
                <input type="number" id="conf-fine" class="config-input" step="1">
            </div>
            <div class="stat-row">
                <span class="config-label">‚ö° –†–∞—Å—Ö–æ–¥ —ç–Ω–µ—Ä–≥–∏–∏</span>
                <input type="number" id="conf-energy" class="config-input" step="0.05">
            </div>

            <button class="shop-btn buy" onclick="saveConfig()" style="width:100%; margin-top:10px">
                <i class="fa-solid fa-floppy-disk"></i> –ü–†–ò–ú–ï–ù–ò–¢–¨ –ù–ê–°–¢–†–û–ô–ö–ò
            </button>
        </div>

    </div>

    <div class="panel-card">
        <div class="panel-header">
            <span class="panel-title">–°–ø–∏—Å–æ–∫ –ö—É—Ä—å–µ—Ä–æ–≤</span>
            <input type="text" id="search-box" placeholder="üîç –ü–æ–∏—Å–∫ –ø–æ ID..." style="background:#333; border:none; color:white; padding:5px 10px; border-radius:5px" onkeyup="renderUsers()">
        </div>
        <div id="users-container" class="user-list">
            <div style="text-align:center; color:#666; padding:20px">–ó–∞–≥—Ä—É–∑–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö...</div>
        </div>
    </div>

    <div class="edit-overlay" id="overlay" onclick="closeModal()"></div>
    <div class="edit-modal" id="bal-modal">
        <h3 style="margin-top:0">–ò–∑–º–µ–Ω–∏—Ç—å –ë–∞–ª–∞–Ω—Å</h3>
        <p style="color:#888" id="modal-username">User</p>
        <input type="number" id="new-balance-input" class="bank-input" style="background:#333; color:white; border-color:#555">
        <div style="display:flex; gap:10px; margin-top:15px">
            <button class="shop-btn" onclick="closeModal()" style="background:#444; color:white; border:none">–û—Ç–º–µ–Ω–∞</button>
            <button class="shop-btn buy" onclick="confirmBalance()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <script src="database.js"></script> <script>
        const dbRef = firebase.database().ref();
        let allUsers = {};
        let currentEditId = null;

        // 1. –°–õ–£–®–ê–ï–ú –ö–û–ù–§–ò–ì
        dbRef.child('config').on('value', snap => {
            const c = snap.val() || {};
            document.getElementById('conf-pay').value = c.basePay || 12;
            document.getElementById('conf-inf').value = c.inflationRate || 0.05;
            document.getElementById('conf-fine').value = c.penaltyLate || 5;
            document.getElementById('conf-energy').value = c.energyCost || 0.15;
        });

        // 2. –°–û–•–†–ê–ù–Ø–ï–ú –ö–û–ù–§–ò–ì
        function saveConfig() {
            dbRef.child('config').update({
                basePay: parseFloat(document.getElementById('conf-pay').value),
                inflationRate: parseFloat(document.getElementById('conf-inf').value),
                penaltyLate: parseFloat(document.getElementById('conf-fine').value),
                energyCost: parseFloat(document.getElementById('conf-energy').value)
            });
            alert('‚úÖ –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –æ–±–Ω–æ–≤–ª–µ–Ω—ã —É –≤—Å–µ—Ö –∏–≥—Ä–æ–∫–æ–≤!');
        }

        // 3. –°–õ–£–®–ê–ï–ú –ò–ì–†–û–ö–û–í
        dbRef.child('users').on('value', snap => {
            allUsers = snap.val() || {};
            renderUsers();
        });

        function renderUsers() {
            const container = document.getElementById('users-container');
            const search = document.getElementById('search-box').value.toLowerCase();
            container.innerHTML = '';
            
            let onlineCount = 0;
            let totalCount = 0;

            Object.entries(allUsers).forEach(([uid, u]) => {
                // –§–∏–ª—å—Ç—Ä –ø–æ–∏—Å–∫–∞
                if (search && !uid.toLowerCase().includes(search) && !u.name.toLowerCase().includes(search)) return;

                totalCount++;
                const isOnline = (Date.now() - u.lastActive) < 60000; // 1 –º–∏–Ω—É—Ç–∞ —Ç–∞–π–º–∞—É—Ç
                if (isOnline) onlineCount++;

                const div = document.createElement('div');
                div.className = `user-row ${isOnline ? 'online' : ''} ${u.isBanned ? 'banned' : ''}`;
                
                div.innerHTML = `
                    <div class="user-info">
                        <div class="user-avatar">${u.name.charAt(0).toUpperCase()}</div>
                        <div>
                            <div style="font-weight:bold; color:white">${u.name} ${isOnline ? '<i class="fa-solid fa-circle" style="color:var(--accent-green); font-size:8px"></i>' : ''}</div>
                            <div style="font-size:10px; color:#666">${uid}</div>
                        </div>
                    </div>

                    <div class="user-stats">
                        <div class="stat-pill"><i class="fa-solid fa-wallet" style="color:var(--wolt-blue)"></i> ${u.balance.toFixed(2)}</div>
                        <div class="stat-pill"><i class="fa-solid fa-building-columns" style="color:var(--accent-red)"></i> ${u.debt.toFixed(2)}</div>
                        <div class="stat-pill">üö≤ Lvl ${u.repairs?.bike || 0}</div>
                    </div>

                    <div class="user-actions">
                        <button class="act-btn btn-edit" onclick="openBalanceModal('${uid}', ${u.balance})"><i class="fa-solid fa-pen"></i> –ë–∞–ª–∞–Ω—Å</button>
                        <button class="act-btn btn-gift" onclick="giveGift('${uid}')"><i class="fa-solid fa-gift"></i> –ü–∞—ë–∫</button>
                        <button class="act-btn btn-fix" onclick="repairUser('${uid}')"><i class="fa-solid fa-wrench"></i> –ß–∏–Ω–∫–∞</button>
                        <button class="act-btn btn-ban ${u.isBanned?'banned':''}" onclick="toggleBan('${uid}', ${!u.isBanned})">
                            ${u.isBanned ? '<i class="fa-solid fa-lock-open"></i> –†–∞–∑–±–∞–Ω' : '<i class="fa-solid fa-ban"></i> –ë–ê–ù'}
                        </button>
                    </div>
                `;
                container.appendChild(div);
            });

            document.getElementById('total-users').textContent = totalCount;
            document.getElementById('online-users').textContent = onlineCount;
        }

        // --- –î–ï–ô–°–¢–í–ò–Ø ---

        // –ë–∞–ª–∞–Ω—Å (—á–µ—Ä–µ–∑ –º–æ–¥–∞–ª–∫—É)
        function openBalanceModal(uid, currentBal) {
            currentEditId = uid;
            document.getElementById('modal-username').textContent = `ID: ${uid}`;
            document.getElementById('new-balance-input').value = currentBal;
            document.getElementById('overlay').style.display = 'block';
            document.getElementById('bal-modal').style.display = 'block';
        }
        function closeModal() {
            document.getElementById('overlay').style.display = 'none';
            document.getElementById('bal-modal').style.display = 'none';
        }
        function confirmBalance() {
            const val = parseFloat(document.getElementById('new-balance-input').value);
            if (!isNaN(val) && currentEditId) {
                dbRef.child(`users/${currentEditId}`).update({ balance: val, adminEdit: true });
                closeModal();
            }
        }

        // –ü–æ–¥–∞—Ä–æ–∫ (–ï–¥–∞ + –ù–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ)
        function giveGift(uid) {
            if(!confirm("–í—ã–¥–∞—Ç—å –∏–≥—Ä–æ–∫—É –≥—É–º–∞–Ω–∏—Ç–∞—Ä–Ω—É—é –ø–æ–º–æ—â—å? (–ï–¥–∞ + –í–æ–¥–∞ + –ù–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ)")) return;
            dbRef.child(`users/${uid}/needs`).set({energy: 100, water: 100, mood: 100});
            // –î–æ–±–∞–≤–∏–º –Ω–µ–º–Ω–æ–≥–æ –ø—Ä–µ–¥–º–µ—Ç–æ–≤ –≤ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å
            dbRef.child(`users/${uid}/inventory`).transaction(inv => {
                if(!inv) inv = {water:0, bar:0, energy_drink:0, coffee:0};
                inv.water += 1; inv.bar += 1;
                return inv;
            });
            alert('–ü–æ–¥–∞—Ä–æ–∫ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω!');
        }

        // –†–µ–º–æ–Ω—Ç (–ü–æ–ª–Ω—ã–π)
        function repairUser(uid) {
            if(!confirm("–ü–æ—á–∏–Ω–∏—Ç—å –≤—Å–µ –ø—Ä–µ–¥–º–µ—Ç—ã –∏–≥—Ä–æ–∫–∞ –±–µ—Å–ø–ª–∞—Ç–Ω–æ?")) return;
            dbRef.child(`users/${uid}/items`).set({bike: 100, bag: 100, phone: 100, gear: 100});
            alert('–ü—Ä–µ–¥–º–µ—Ç—ã –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã!');
        }

        // –ë–∞–Ω
        function toggleBan(uid, status) {
            if(confirm(status ? "‚õî –ó–ê–ë–ê–ù–ò–¢–¨ —ç—Ç–æ–≥–æ –∏–≥—Ä–æ–∫–∞? –û–Ω –Ω–µ —Å–º–æ–∂–µ—Ç –≤–æ–π—Ç–∏." : "‚úÖ –†–ê–ó–ë–ê–ù–ò–¢–¨ –∏–≥—Ä–æ–∫–∞?")) {
                dbRef.child(`users/${uid}/isBanned`).set(status);
            }
        }

        // –ì–ª–æ–±–∞–ª—å–Ω—ã–π —Å–±—Ä–æ—Å
        function resetAllUsers() {
            const code = prompt("–í–≤–µ–¥–∏ –∫–æ–¥ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è: WIPE");
            if (code === "WIPE") {
                dbRef.child('users').remove();
                alert("üóëÔ∏è –ë–ê–ó–ê –î–ê–ù–ù–´–• –ò–ì–†–û–ö–û–í –û–ß–ò–©–ï–ù–ê!");
                location.reload();
            }
        }

    </script>
</body>
</html>
