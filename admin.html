<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WARSAW GOD MODE v5.0</title>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        /* –ë–ï–õ–´–ô –ß–ò–°–¢–´–ô –î–ò–ó–ê–ô–ù */
        :root { --bg: #f3f4f6; --card: #ffffff; --text: #1f2937; --blue: #2563eb; --green: #10b981; --red: #ef4444; }
        body { background: var(--bg); color: var(--text); font-family: 'Segoe UI', sans-serif; margin: 0; padding: 20px; font-size: 14px; }
        
        /* –®–ê–ü–ö–ê */
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; background: var(--card); padding: 15px; border-radius: 12px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .status-dot { height: 10px; width: 10px; background: #ccc; border-radius: 50%; display: inline-block; margin-right: 5px; }
        .status-online { background: var(--green); box-shadow: 0 0 10px var(--green); }

        /* –¢–ê–ë–´ (–í–ö–õ–ê–î–ö–ò) */
        .tabs { display: flex; gap: 10px; margin-bottom: 20px; overflow-x: auto; padding-bottom: 5px; }
        .tab-btn { background: var(--card); border: 1px solid #e5e7eb; padding: 12px 20px; border-radius: 8px; cursor: pointer; font-weight: bold; color: #6b7280; flex: 1; min-width: 100px; text-align: center; transition: 0.2s; }
        .tab-btn.active { background: var(--blue); color: white; border-color: var(--blue); box-shadow: 0 4px 6px -1px rgba(37, 99, 235, 0.3); }
        
        .panel { display: none; }
        .panel.active { display: block; animation: fadeIn 0.3s; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

        /* –ö–ê–†–¢–û–ß–ö–ò –ù–ê–°–¢–†–û–ï–ö */
        .section { background: var(--card); border-radius: 12px; padding: 20px; margin-bottom: 20px; box-shadow: 0 1px 3px rgba(0,0,0,0.05); border: 1px solid #e5e7eb; }
        .section h3 { margin: 0 0 15px 0; font-size: 16px; border-bottom: 2px solid #f3f4f6; padding-bottom: 10px; color: var(--blue); text-transform: uppercase; letter-spacing: 1px; }
        
        /* –ü–û–õ–Ø –í–í–û–î–ê */
        .control-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; padding-bottom: 8px; border-bottom: 1px dashed #f0f0f0; }
        .label-box { flex: 1; }
        .lbl-title { font-weight: 600; display: block; }
        .lbl-desc { font-size: 11px; color: #9ca3af; display: block; margin-top: 2px; }
        
        input[type="number"], input[type="text"] { 
            width: 100px; padding: 8px; border: 1px solid #d1d5db; border-radius: 6px; 
            text-align: center; font-weight: bold; font-size: 14px; background: #f9fafb;
        }
        input:focus { outline: 2px solid var(--blue); border-color: transparent; background: white; }

        /* –°–ü–ò–°–û–ö –ò–ì–†–û–ö–û–í */
        .player-row { background: white; padding: 15px; border-radius: 8px; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; border-left: 5px solid #ccc; cursor: pointer; transition: transform 0.1s; box-shadow: 0 1px 2px rgba(0,0,0,0.05); }
        .player-row:hover { transform: scale(1.01); background: #f8fafc; }
        .player-row.online { border-left-color: var(--green); }
        .player-row.banned { border-left-color: var(--red); opacity: 0.7; }
        
        /* –ú–û–î–ê–õ–¨–ù–û–ï –û–ö–ù–û (–†–ï–î–ê–ö–¢–û–† –ò–ì–†–û–ö–ê) */
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 100; display: none; align-items: center; justify-content: center; backdrop-filter: blur(3px); }
        .modal-box { background: white; width: 90%; max-width: 600px; max-height: 90vh; overflow-y: auto; border-radius: 16px; padding: 25px; box-shadow: 0 20px 50px rgba(0,0,0,0.2); }
        
        /* –ö–ù–û–ü–ö–ò */
        .btn { padding: 10px 20px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; color: white; transition: 0.2s; }
        .btn-save { background: var(--green); width: 100%; margin-top: 10px; font-size: 16px; padding: 15px; }
        .btn-save:hover { background: #059669; }
        .btn-ban { background: var(--red); }
        
        /* –†–ê–ö–ï–¢–ê */
        .rocket-list { display: flex; flex-direction: column; gap: 10px; }
        .rocket-item { background: #eff6ff; border: 1px solid #bfdbfe; padding: 10px; border-radius: 8px; display: flex; justify-content: space-between; align-items: center; }
    </style>
</head>
<body>

    <div class="header">
        <div>
            <h2 style="margin:0; color:#111827"><i class="fa-solid fa-user-secret"></i> –ü–ê–ù–ï–õ–¨ –ë–û–ì–ê</h2>
            <small style="color:#6b7280">Warsaw Courier Control System</small>
        </div>
        <div>
            <span id="conn-status"><span class="status-dot"></span>Connecting...</span>
        </div>
    </div>

    <div class="tabs">
        <button class="tab-btn active" onclick="switchTab('tab-players')">üë• –ò–≥—Ä–æ–∫–∏</button>
        <button class="tab-btn" onclick="switchTab('tab-economy')">üí∏ –¢–∞—Ä–∏—Ñ—ã</button>
        <button class="tab-btn" onclick="switchTab('tab-items')">üéí –ú–∞–≥–∞–∑–∏–Ω</button>
        <button class="tab-btn" onclick="switchTab('tab-rocket')">üöÄ –†–∞–∫–µ—Ç–∞</button>
        <button class="tab-btn" onclick="switchTab('tab-system')">‚öôÔ∏è –°–∏—Å—Ç–µ–º–∞</button>
    </div>

    <div id="tab-players" class="panel active">
        <input type="text" id="search-player" placeholder="üîç –ù–∞–π—Ç–∏ –∂–µ—Ä—Ç–≤—É (–∏–º—è –∏–ª–∏ ID)..." onkeyup="renderPlayers()" style="width:100%; padding:15px; box-sizing:border-box; border-radius:8px; border:1px solid #ccc; margin-bottom:15px; font-size:16px;">
        <div id="players-container">
            <div style="text-align:center; padding:20px; color:#999">–ó–∞–≥—Ä—É–∑–∫–∞ —Å–ø–∏—Å–∫–∞ –∏–≥—Ä–æ–∫–æ–≤...</div>
        </div>
    </div>

    <div id="tab-economy" class="panel">
        <div class="section">
            <h3>üöñ –î–æ—Å—Ç–∞–≤–∫–∞ & –¢–∞–∫—Å–∏</h3>
            <div class="control-row">
                <div class="label-box"><span class="lbl-title">–ë–∞–∑–æ–≤–∞—è –ø–æ–¥–∞—á–∞</span><span class="lbl-desc">–°–∫–æ–ª—å–∫–æ –ø–ª–∞—Ç–∏–º –∑–∞ —Å—Ç–∞—Ä—Ç –∑–∞–∫–∞–∑–∞ (PLN)</span></div>
                <input type="number" id="cfg-basePickupPay" step="0.5">
            </div>
            <div class="control-row">
                <div class="label-box"><span class="lbl-title">–û–ø–ª–∞—Ç–∞ –∑–∞ –ö–ú</span><span class="lbl-desc">–¶–µ–Ω–∞ –∑–∞ 1 –∫–∏–ª–æ–º–µ—Ç—Ä –ø—É—Ç–∏</span></div>
                <input type="number" id="cfg-perKmPay" step="0.1">
            </div>
            <div class="control-row">
                <div class="label-box"><span class="lbl-title">–ú–Ω–æ–∂–∏—Ç–µ–ª—å –¢–ê–ö–°–ò</span><span class="lbl-desc">–í–æ —Å–∫–æ–ª—å–∫–æ —Ä–∞–∑ —Ç–∞–∫—Å–∏ –≤—ã–≥–æ–¥–Ω–µ–µ –∫—É—Ä—å–µ—Ä–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä 4.0 = –≤ 4 —Ä–∞–∑–∞)</span></div>
                <input type="number" id="cfg-taxiMulti" step="0.1">
            </div>
        </div>

        <div class="section">
            <h3>üí≥ –ë–∞–Ω–∫ & –ò–Ω—Ñ–ª—è—Ü–∏—è</h3>
            <div class="control-row">
                <div class="label-box"><span class="lbl-title">–ö—Ä–µ–¥–∏—Ç –î–æ–≤–µ—Ä–∏—è (–ë–∞–∑–∞)</span><span class="lbl-desc">–°–∫–æ–ª—å–∫–æ –¥–∞—é—Ç –Ω–æ–≤–∏—á–∫—É (PLN)</span></div>
                <input type="number" id="cfg-bankLimitBase">
            </div>
            <div class="control-row">
                <div class="label-box"><span class="lbl-title">–ú–Ω–æ–∂–∏—Ç–µ–ª—å –î–æ–≤–µ—Ä–∏—è</span><span class="lbl-desc">–°–∫–æ–ª—å–∫–æ –¥–æ–±–∞–≤–ª—è—Ç—å –∫ –ª–∏–º–∏—Ç—É –∑–∞ –∫–∞–∂–¥—ã–π –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–π –∑–∞–∫–∞–∑</span></div>
                <input type="number" id="cfg-bankLimitMulti">
            </div>
            <div class="control-row">
                <div class="label-box"><span class="lbl-title">–ò–Ω—Ñ–ª—è—Ü–∏—è (%)</span><span class="lbl-desc">–ù–∞ —Å–∫–æ–ª—å–∫–æ % –¥–æ—Ä–æ–∂–∞–µ—Ç –º–∞–≥–∞–∑–∏–Ω –∑–∞ –∫–∞–∂–¥—ã–π —É—Ä–æ–≤–µ–Ω—å —Ä–µ–º–æ–Ω—Ç–∞</span></div>
                <input type="number" id="cfg-inflationRate" step="1">
            </div>
        </div>

        <button class="btn btn-save" onclick="saveGlobalConfig()">üíæ –ü–†–ò–ú–ï–ù–ò–¢–¨ –ö–û –í–°–ï–ú –ò–ì–†–û–ö–ê–ú</button>
    </div>

    <div id="tab-items" class="panel">
        <div class="section">
            <h3>üéí –†–∞—Å—Ö–æ–¥–Ω–∏–∫–∏ (–¶–µ–Ω–∞ –≤ PLN)</h3>
            <div class="control-row">
                <div class="label-box"><span class="lbl-title">–í–æ–¥–∞</span><span class="lbl-desc">–í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –≤–æ–¥—É</span></div>
                <input type="number" id="price-water">
            </div>
            <div class="control-row">
                <div class="label-box"><span class="lbl-title">–°–Ω–∏–∫–µ—Ä—Å (Bar)</span><span class="lbl-desc">–ï–¥–∞ + –ù–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ</span></div>
                <input type="number" id="price-bar">
            </div>
            <div class="control-row">
                <div class="label-box"><span class="lbl-title">–≠–Ω–µ—Ä–≥–µ—Ç–∏–∫ (RedBull)</span><span class="lbl-desc">–û—Å—Ç–∞–Ω–æ–≤–∫–∞ —É—Å—Ç–∞–ª–æ—Å—Ç–∏</span></div>
                <input type="number" id="price-energy_drink">
            </div>
            <div class="control-row">
                <div class="label-box"><span class="lbl-title">–ö–æ—Ñ–µ</span><span class="lbl-desc">–î–ª—è –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è</span></div>
                <input type="number" id="price-coffee">
            </div>
            <div class="control-row">
                <div class="label-box"><span class="lbl-title">–ë–µ–Ω–∑–∏–Ω (Gas)</span><span class="lbl-desc">–¢–æ–ª—å–∫–æ –¥–ª—è —Ç–∞–∫—Å–∏</span></div>
                <input type="number" id="price-gas">
            </div>
        </div>

        <div class="section">
            <h3>üõ† –†–µ–º–æ–Ω—Ç (–ë–∞–∑–æ–≤–∞—è —Ü–µ–Ω–∞)</h3>
            <div class="control-row"><div class="label-box"><span class="lbl-title">–í–µ–ª–æ—Å–∏–ø–µ–¥ / –ê–≤—Ç–æ</span></div><input type="number" id="price-repair-bike"></div>
            <div class="control-row"><div class="label-box"><span class="lbl-title">–°—É–º–∫–∞ / –°–∞–ª–æ–Ω</span></div><input type="number" id="price-repair-bag"></div>
            <div class="control-row"><div class="label-box"><span class="lbl-title">–¢–µ–ª–µ—Ñ–æ–Ω</span></div><input type="number" id="price-repair-phone"></div>
            <div class="control-row"><div class="label-box"><span class="lbl-title">–û–¥–µ–∂–¥–∞ / –®–∏–Ω—ã</span></div><input type="number" id="price-repair-gear"></div>
        </div>

        <div class="section">
            <h3>üìÑ –õ–∏—Ü–µ–Ω–∑–∏–∏ (–°—Ç–æ–∏–º–æ—Å—Ç—å)</h3>
            <div class="control-row"><div class="label-box"><span class="lbl-title">–ü—Ä–∞–≤–∞ (Driver)</span></div><input type="number" id="price-lic-driver"></div>
            <div class="control-row"><div class="label-box"><span class="lbl-title">–°—Ç—Ä–∞—Ö–æ–≤–∫–∞ (Insurance)</span></div><input type="number" id="price-lic-insurance"></div>
            <div class="control-row"><div class="label-box"><span class="lbl-title">–õ–∏—Ü–µ–Ω–∑–∏—è –¢–∞–∫—Å–∏</span></div><input type="number" id="price-lic-taxi"></div>
        </div>

        <button class="btn btn-save" onclick="saveGlobalConfig()">üíæ –û–ë–ù–û–í–ò–¢–¨ –¶–ï–ù–ù–ò–ö–ò</button>
    </div>

    <div id="tab-rocket" class="panel">
        <div class="section">
            <h3>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ë–æ–Ω—É—Å–∞–º–∏</h3>
            <p style="font-size:12px; color:#666">–ó–¥–µ—Å—å —Å–æ–∑–¥–∞—é—Ç—Å—è —Ü–µ–ª–∏ –¥–ª—è –∏–≥—Ä–æ–∫–æ–≤. –ò–∑–º–µ–Ω–µ–Ω–∏—è –º–≥–Ω–æ–≤–µ–Ω–Ω—ã.</p>
            
            <div id="rocket-editor"></div>
            
            <button class="btn" style="background:#4b5563; margin-top:10px;" onclick="addBonusSlot()">+ –î–æ–±–∞–≤–∏—Ç—å —Ü–µ–ª—å</button>
        </div>
        <button class="btn btn-save" onclick="pushRocket()">üöÄ –ó–ê–ü–£–°–¢–ò–¢–¨ –†–ê–ö–ï–¢–£ (–û–¢–ü–†–ê–í–ò–¢–¨)</button>
    </div>

    <div id="tab-system" class="panel">
        <div class="section" style="border-color:red">
            <h3 style="color:red">–û–ø–∞—Å–Ω–∞—è –ó–æ–Ω–∞</h3>
            <p>–£–¥–∞–ª–∏—Ç—å –≤—Å–µ—Ö –∏–≥—Ä–æ–∫–æ–≤ –∏ —Å–±—Ä–æ—Å–∏—Ç—å –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö.</p>
            <button class="btn btn-ban" onclick="wipeAll()">‚ò¢Ô∏è –ü–û–õ–ù–´–ô –í–ê–ô–ü (RESET)</button>
        </div>
        <div class="section">
            <h3>–õ–æ–≥–∏ (–ü–æ—Å–ª–µ–¥–Ω–∏–µ 20)</h3>
            <div id="logs-container" style="font-family:monospace; font-size:11px; color:#555"></div>
        </div>
    </div>

    <div id="player-modal" class="modal-overlay">
        <div class="modal-box">
            <div style="display:flex; justify-content:space-between; margin-bottom:20px;">
                <h2 style="margin:0" id="pm-title">–†–µ–¥–∞–∫—Ç–æ—Ä –ò–≥—Ä–æ–∫–∞</h2>
                <button onclick="closeModal()" style="border:none; background:none; font-size:20px; cursor:pointer">‚úï</button>
            </div>

            <div class="section">
                <h3>üí∞ –ö–æ—à–µ–ª–µ–∫</h3>
                <div class="control-row">
                    <span>–ë–∞–ª–∞–Ω—Å (PLN)</span>
                    <input type="number" id="pm-balance">
                </div>
                <div class="control-row">
                    <span>–î–æ–ª–≥ –ë–∞–Ω–∫—É</span>
                    <input type="number" id="pm-debt">
                </div>
            </div>

            <div class="section">
                <h3>üéí –ò–Ω–≤–µ–Ω—Ç–∞—Ä—å (–®—Ç—É–∫)</h3>
                <div style="display:grid; grid-template-columns: 1fr 1fr 1fr; gap:10px">
                    <div><small>–í–æ–¥–∞</small><input type="number" id="pm-inv-water" style="width:100%"></div>
                    <div><small>–°–Ω–∏–∫–µ—Ä—Å</small><input type="number" id="pm-inv-bar" style="width:100%"></div>
                    <div><small>RedBull</small><input type="number" id="pm-inv-energy" style="width:100%"></div>
                    <div><small>–ë–µ–Ω–∑–∏–Ω</small><input type="number" id="pm-inv-gas" style="width:100%"></div>
                    <div><small>–ö–æ—Ñ–µ</small><input type="number" id="pm-inv-coffee" style="width:100%"></div>
                </div>
            </div>

            <div class="section">
                <h3>‚ö° –°–æ—Å—Ç–æ—è–Ω–∏–µ</h3>
                <div class="control-row"><span>–≠–Ω–µ—Ä–≥–∏—è (0-100)</span><input type="number" id="pm-energy"></div>
                <div class="control-row"><span>–í–æ–¥–∞ (0-100)</span><input type="number" id="pm-water"></div>
                <div class="control-row"><span>–ù–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ (0-100)</span><input type="number" id="pm-mood"></div>
            </div>

            <div class="section">
                <h3>üöî –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ü–∏—è</h3>
                <div style="display:flex; gap:10px">
                    <button class="btn btn-ban" onclick="pmBanToggle()" id="pm-ban-btn">–ó–ê–ë–ê–ù–ò–¢–¨</button>
                    <button class="btn" style="background:#f59e0b; color:black; flex:1" onclick="pmGiveFullTaxi()">üöï –ü–û–î–ê–†–ò–¢–¨ –¢–ê–ö–°–ò (–í–°–Å –í–ö–õ)</button>
                </div>
            </div>

            <button class="btn btn-save" onclick="pmSave()">üíæ –°–û–•–†–ê–ù–ò–¢–¨ –ò–ó–ú–ï–ù–ï–ù–ò–Ø</button>
        </div>
    </div>

    <script>
        // --- 1. –ü–û–î–ö–õ–Æ–ß–ï–ù–ò–ï ---
        const firebaseConfig = {
            apiKey: "AIzaSyChrQMyO2soPgoEHq_f3aYs5Cs19q3sWEk",
            authDomain: "warszawa-courier.firebaseapp.com",
            databaseURL: "https://warszawa-courier-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "warszawa-courier",
            storageBucket: "warszawa-courier.firebasestorage.app",
            messagingSenderId: "295860613508",
            appId: "1:295860613508:web:86fe8364377d6875612dd1"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        let allPlayers = {};
        let activePlayerId = null;

        // –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä —Å–≤—è–∑–∏
        db.ref('.info/connected').on('value', s => {
            const el = document.getElementById('conn-status');
            if(s.val()) {
                el.innerHTML = '<span class="status-dot status-online"></span>ONLINE (SYNCED)';
                el.style.color = 'green';
            } else {
                el.innerHTML = '<span class="status-dot"></span>OFFLINE';
                el.style.color = 'red';
            }
        });

        // --- 2. –ó–ê–ì–†–£–ó–ö–ê –ò–ì–†–û–ö–û–í ---
        db.ref('players').on('value', snap => {
            allPlayers = snap.val() || {};
            renderPlayers();
        });

        function renderPlayers() {
            const list = document.getElementById('players-container');
            const search = document.getElementById('search-player').value.toLowerCase();
            list.innerHTML = '';

            const arr = Object.entries(allPlayers).map(([id, p]) => ({id, ...p}));
            
            // –§–∏–ª—å—Ç—Ä
            const filtered = arr.filter(p => {
                const name = (p.name || "Guest").toLowerCase();
                return name.includes(search) || p.id.includes(search);
            });

            if(filtered.length === 0) {
                list.innerHTML = '<div style="padding:20px; text-align:center">–ù–∏–∫–æ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ...</div>';
                return;
            }

            // –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞: –û–Ω–ª–∞–π–Ω –≤—ã—à–µ, –ø–æ—Ç–æ–º –±–æ–≥–∞—Ç—ã–µ
            filtered.sort((a,b) => {
                const aOn = (Date.now() - (a.lastSeen || 0) < 20000);
                const bOn = (Date.now() - (b.lastSeen || 0) < 20000);
                if(aOn && !bOn) return -1;
                if(!aOn && bOn) return 1;
                return (b.balance || 0) - (a.balance || 0);
            });

            filtered.forEach(p => {
                const isOnline = (Date.now() - (p.lastSeen || 0) < 20000);
                const role = p.taxi && p.taxi.active ? 'üöï TAXI' : 'üö≤ COURIER';
                
                let html = `
                <div class="player-row ${isOnline?'online':''} ${p.isBanned?'banned':''}" onclick="openPlayer('${p.id}')">
                    <div>
                        <div style="font-weight:bold; font-size:16px">${p.name || '–ê–Ω–æ–Ω–∏–º'} ${p.isBanned ? '<span style="color:red">[BAN]</span>' : ''}</div>
                        <div style="font-size:11px; color:#666">ID: ${p.id} ‚Ä¢ ${role}</div>
                        <div style="margin-top:5px; font-weight:bold; color:var(--blue)">${(p.balance||0).toFixed(2)} PLN</div>
                    </div>
                    <div style="text-align:right; font-size:12px">
                        <div>${isOnline ? '<span style="color:green">‚óè –í —Å–µ—Ç–∏</span>' : '<span style="color:#999">‚óã –û—Ñ–ª–∞–π–Ω</span>'}</div>
                        <div style="color:#666">–ó–∞–∫–∞–∑–æ–≤: ${p.career?.totalOrders || 0}</div>
                    </div>
                </div>`;
                list.innerHTML += html;
            });
        }

        // --- 3. –ó–ê–ì–†–£–ó–ö–ê –ù–ê–°–¢–†–û–ï–ö (–¶–ï–ù–´) ---
        db.ref('config').on('value', snap => {
            const cfg = snap.val() || {};
            // –≠–∫–æ–Ω–æ–º–∏–∫–∞
            setInput('cfg-basePickupPay', cfg.basePickupPay || 4.0);
            setInput('cfg-perKmPay', cfg.perKmPay || 1.5);
            setInput('cfg-taxiMulti', cfg.taxiMulti || 4.0); // –ù–æ–≤–æ–µ –¥–ª—è —Ç–∞–∫—Å–∏
            setInput('cfg-bankLimitBase', cfg.bankLimitBase || 1000);
            setInput('cfg-bankLimitMulti', cfg.bankLimitMulti || 50);
            setInput('cfg-inflationRate', (cfg.inflationRate || 0.1) * 100);

            // –¶–µ–Ω—ã
            const prices = cfg.itemPrices || {};
            setInput('price-water', prices.water || 2);
            setInput('price-bar', prices.bar || 4.5);
            setInput('price-energy_drink', prices.energy_drink || 7);
            setInput('price-coffee', prices.coffee || 9);
            setInput('price-gas', prices.gas || 12);
            
            // –†–µ–º–æ–Ω—Ç –∏ –õ–∏—Ü–µ–Ω–∑–∏–∏
            setInput('price-repair-bike', prices.repair_bike || 5);
            setInput('price-repair-bag', prices.repair_bag || 2);
            setInput('price-repair-phone', prices.repair_phone || 1);
            setInput('price-repair-gear', prices.repair_gear || 3);
            
            setInput('price-lic-driver', prices.lic_driver || 2500);
            setInput('price-lic-insurance', prices.lic_insurance || 1200);
            setInput('price-lic-taxi', prices.lic_taxi || 5000);
        });

        function setInput(id, val) {
            const el = document.getElementById(id);
            if(el && document.activeElement !== el) el.value = val;
        }

        // --- 4. –†–ê–ö–ï–¢–ê (–ë–û–ù–£–°–´) ---
        let currentBonuses = [];
        db.ref('bonuses/active').on('value', snap => {
            currentBonuses = snap.val() || [];
            renderRocketEditor();
        });

        function renderRocketEditor() {
            const container = document.getElementById('rocket-editor');
            container.innerHTML = '';
            currentBonuses.forEach((b, idx) => {
                container.innerHTML += `
                <div class="rocket-item">
                    <div style="flex:1; display:grid; grid-template-columns: 2fr 1fr 1fr 1fr; gap:10px;">
                        <input type="text" value="${b.title}" class="rk-title" placeholder="–ó–∞–≥–æ–ª–æ–≤–æ–∫">
                        <input type="number" value="${b.reward}" class="rk-reward" placeholder="–ù–∞–≥—Ä–∞–¥–∞">
                        <input type="number" value="${b.target}" class="rk-target" placeholder="–¶–µ–ª—å">
                        <input type="number" value="${Math.floor((b.endTime - Date.now())/60000)}" class="rk-time" placeholder="–ú–∏–Ω">
                    </div>
                    <button onclick="removeRocket(${idx})" style="margin-left:10px; color:red; border:none; background:none; font-weight:bold; cursor:pointer">X</button>
                </div>`;
            });
        }

        function addBonusSlot() {
            currentBonuses.push({ title: "–°—Ä–æ—á–Ω—ã–π –∑–∞–∫–∞–∑!", reward: 100, target: 5, endTime: Date.now() + 3600000 });
            renderRocketEditor(); // –õ–æ–∫–∞–ª—å–Ω—ã–π —Ä–µ–Ω–¥–µ—Ä, —Å–æ—Ö—Ä–∞–Ω–∏–º –∫–Ω–æ–ø–∫–æ–π
        }
        
        function removeRocket(idx) {
            currentBonuses.splice(idx, 1);
            renderRocketEditor();
        }

        function pushRocket() {
            // –°–æ–±–∏—Ä–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ –∏–Ω–ø—É—Ç–æ–≤
            const items = document.querySelectorAll('.rocket-item');
            const newData = [];
            items.forEach((el, i) => {
                const title = el.querySelector('.rk-title').value;
                const reward = parseFloat(el.querySelector('.rk-reward').value);
                const target = parseInt(el.querySelector('.rk-target').value);
                const mins = parseInt(el.querySelector('.rk-time').value);
                
                newData.push({
                    id: i+1,
                    title: title,
                    reward: reward,
                    target: target,
                    endTime: Date.now() + (mins * 60 * 1000)
                });
            });
            
            db.ref('bonuses/active').set(newData)
                .then(() => alert('üöÄ –†–ê–ö–ï–¢–ê –û–¢–ü–†–ê–í–õ–ï–ù–ê! –£ –∏–≥—Ä–æ–∫–æ–≤ –æ–±–Ω–æ–≤–∏–ª–∏—Å—å —Ü–µ–ª–∏.'));
        }

        // --- 5. –§–£–ù–ö–¶–ò–ò –°–û–•–†–ê–ù–ï–ù–ò–Ø ---
        function saveGlobalConfig() {
            const updates = {
                basePickupPay: parseFloat(document.getElementById('cfg-basePickupPay').value),
                perKmPay: parseFloat(document.getElementById('cfg-perKmPay').value),
                taxiMulti: parseFloat(document.getElementById('cfg-taxiMulti').value),
                bankLimitBase: parseFloat(document.getElementById('cfg-bankLimitBase').value),
                bankLimitMulti: parseFloat(document.getElementById('cfg-bankLimitMulti').value),
                inflationRate: parseFloat(document.getElementById('cfg-inflationRate').value) / 100,
                
                itemPrices: {
                    water: parseFloat(document.getElementById('price-water').value),
                    bar: parseFloat(document.getElementById('price-bar').value),
                    energy_drink: parseFloat(document.getElementById('price-energy_drink').value),
                    coffee: parseFloat(document.getElementById('price-coffee').value),
                    gas: parseFloat(document.getElementById('price-gas').value),
                    
                    repair_bike: parseFloat(document.getElementById('price-repair-bike').value),
                    repair_bag: parseFloat(document.getElementById('price-repair-bag').value),
                    repair_phone: parseFloat(document.getElementById('price-repair-phone').value),
                    repair_gear: parseFloat(document.getElementById('price-repair-gear').value),
                    
                    lic_driver: parseFloat(document.getElementById('price-lic-driver').value),
                    lic_insurance: parseFloat(document.getElementById('price-lic-insurance').value),
                    lic_taxi: parseFloat(document.getElementById('price-lic-taxi').value),
                }
            };
            
            db.ref('config').update(updates)
                .then(() => alert('‚úÖ –¶–ï–ù–´ –ò –¢–ê–†–ò–§–´ –û–ë–ù–û–í–õ–ï–ù–´ –ú–ì–ù–û–í–ï–ù–ù–û!'));
        }

        // --- 6. –£–ü–†–ê–í–õ–ï–ù–ò–ï –ò–ì–†–û–ö–û–ú ---
        function openPlayer(id) {
            activePlayerId = id;
            const p = allPlayers[id];
            if(!p) return;

            document.getElementById('player-modal').style.display = 'flex';
            document.getElementById('pm-title').innerText = p.name;
            
            // –§–∏–Ω–∞–Ω—Å—ã
            document.getElementById('pm-balance').value = p.balance || 0;
            document.getElementById('pm-debt').value = p.debt || 0;
            
            // –ò–Ω–≤–µ–Ω—Ç–∞—Ä—å
            const inv = p.inventory || {};
            document.getElementById('pm-inv-water').value = inv.water || 0;
            document.getElementById('pm-inv-bar').value = inv.bar || 0;
            document.getElementById('pm-inv-energy').value = inv.energy_drink || 0;
            document.getElementById('pm-inv-gas').value = inv.gas || 0;
            document.getElementById('pm-inv-coffee').value = inv.coffee || 0;
            
            // –°—Ç–∞—Ç—ã
            const stats = p.needs || { energy:100, water:100, mood:100 };
            document.getElementById('pm-energy').value = Math.floor(stats.energy);
            document.getElementById('pm-water').value = Math.floor(stats.water);
            document.getElementById('pm-mood').value = Math.floor(stats.mood);
            
            // –ö–Ω–æ–ø–∫–∞ –±–∞–Ω–∞
            const btn = document.getElementById('pm-ban-btn');
            if(p.isBanned) {
                btn.innerText = "–†–ê–ó–ë–ê–ù–ò–¢–¨"; btn.style.background = "green";
            } else {
                btn.innerText = "–ó–ê–ë–ê–ù–ò–¢–¨"; btn.style.background = "red";
            }
        }

        function closeModal() {
            document.getElementById('player-modal').style.display = 'none';
            activePlayerId = null;
        }

        function pmSave() {
            if(!activePlayerId) return;
            const updates = {
                balance: parseFloat(document.getElementById('pm-balance').value),
                debt: parseFloat(document.getElementById('pm-debt').value),
                'inventory/water': parseInt(document.getElementById('pm-inv-water').value),
                'inventory/bar': parseInt(document.getElementById('pm-inv-bar').value),
                'inventory/energy_drink': parseInt(document.getElementById('pm-inv-energy').value),
                'inventory/gas': parseInt(document.getElementById('pm-inv-gas').value),
                'inventory/coffee': parseInt(document.getElementById('pm-inv-coffee').value),
                'needs/energy': parseInt(document.getElementById('pm-energy').value),
                'needs/water': parseInt(document.getElementById('pm-water').value),
                'needs/mood': parseInt(document.getElementById('pm-mood').value)
            };
            db.ref('players/' + activePlayerId).update(updates)
                .then(() => { closeModal(); alert('–ò–≥—Ä–æ–∫ –æ–±–Ω–æ–≤–ª–µ–Ω!'); });
        }

        function pmBanToggle() {
            if(!activePlayerId) return;
            const isBanned = allPlayers[activePlayerId].isBanned || false;
            db.ref('players/' + activePlayerId).update({ isBanned: !isBanned });
            closeModal();
        }
        
        // --- 7. –ö–ù–û–ü–ö–ê "–ü–û–î–ê–†–ò–¢–¨ –¢–ê–ö–°–ò" ---
        function pmGiveFullTaxi() {
            if(!activePlayerId) return;
            if(confirm("–í—ã–¥–∞—Ç—å –∏–≥—Ä–æ–∫—É –ü–û–õ–ù–´–ô –ø–∞–∫–µ—Ç —Ç–∞–∫—Å–∏ –±–µ—Å–ø–ª–∞—Ç–Ω–æ?\n(–û—Ç–∫—Ä–æ–µ—Ç –¥–æ—Å—Ç—É–ø, –¥–∞—Å—Ç –º–∞—à–∏–Ω—É Tesla –∏ –≤—Å–µ –ª–∏—Ü–µ–Ω–∑–∏–∏)")) {
                db.ref('players/' + activePlayerId + '/taxi').update({ 
                    unlocked: true,
                    active: false, // –ø—É—Å—Ç—å —Å–∞–º –≤–∫–ª—é—á–∏—Ç
                    vehicle: 'tesla',
                    licenses: {
                        driver: true,
                        insurance: true,
                        taxi: true
                    }
                });
                alert('‚úÖ –¢–∞–∫—Å–∏-–ø–∞–∫–µ—Ç –≤—ã–¥–∞–Ω!');
                closeModal();
            }
        }

        function wipeAll() {
            if(confirm("–¢–´ –¢–û–ß–ù–û –•–û–ß–ï–®–¨ –£–î–ê–õ–ò–¢–¨ –í–°–ï–•? –≠–¢–û –ù–ï–õ–¨–ó–Ø –û–¢–ú–ï–ù–ò–¢–¨.")) {
                db.ref('players').remove();
                alert('–ú–∏—Ä –æ—á–∏—â–µ–Ω.');
            }
        }

        function switchTab(id) {
            document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            event.target.classList.add('active');
        }
        
        // –õ–æ–≥–∏
        db.ref('logs').limitToLast(20).on('value', snap => {
            const c = document.getElementById('logs-container');
            const d = snap.val();
            if(!d) return;
            c.innerHTML = Object.values(d).reverse().map(l => `<div>[${new Date(l.timestamp).toLocaleTimeString()}] <b>${l.playerName}</b>: ${l.message}</div>`).join('');
        });

    </script>
</body>
</html>

